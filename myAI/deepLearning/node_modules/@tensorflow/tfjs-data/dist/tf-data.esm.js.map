{"version":3,"file":"tf-data.esm.js","sources":["../node_modules/seedrandom/lib/alea.js","../node_modules/seedrandom/lib/xor128.js","../node_modules/seedrandom/lib/xorwow.js","../node_modules/seedrandom/lib/xorshift7.js","../node_modules/seedrandom/lib/xor4096.js","../node_modules/seedrandom/lib/tychei.js","../node_modules/seedrandom/seedrandom.js","../node_modules/seedrandom/index.js","../node_modules/@tensorflow/tfjs-core/dist/util.js","../node_modules/@tensorflow/tfjs-core/dist/tensor_format.js","../node_modules/@tensorflow/tfjs-core/dist/tensor.js","../node_modules/@tensorflow/tfjs-core/dist/types.js","../node_modules/@tensorflow/tfjs-core/dist/tensor_util.js","../src/util/deep_map.ts","../src/util/ring_buffer.ts","../src/util/growing_ring_buffer.ts","../src/iterators/lazy_iterator.ts","../src/dataset.ts","../src/datasets/text_line_dataset.ts","../src/datasets/csv_dataset.ts","../src/datasource.ts","../node_modules/utf8/utf8.js","../src/iterators/string_iterator.ts","../src/iterators/byte_chunk_iterator.ts","../src/iterators/file_chunk_iterator.ts","../src/iterators/url_chunk_iterator.ts","../src/sources/url_data_source.ts","../src/readers.ts","../src/sources/file_data_source.ts","../src/version.ts"],"sourcesContent":["// A port of an algorithm by Johannes Baagøe <baagoe@baagoe.com>, 2010\n// http://baagoe.com/en/RandomMusings/javascript/\n// https://github.com/nquinlan/better-random-numbers-for-javascript-mirror\n// Original work is under MIT license -\n\n// Copyright (C) 2010 by Johannes Baagøe <baagoe@baagoe.org>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n// \n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n// \n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n\n\n(function(global, module, define) {\n\nfunction Alea(seed) {\n  var me = this, mash = Mash();\n\n  me.next = function() {\n    var t = 2091639 * me.s0 + me.c * 2.3283064365386963e-10; // 2^-32\n    me.s0 = me.s1;\n    me.s1 = me.s2;\n    return me.s2 = t - (me.c = t | 0);\n  };\n\n  // Apply the seeding algorithm from Baagoe.\n  me.c = 1;\n  me.s0 = mash(' ');\n  me.s1 = mash(' ');\n  me.s2 = mash(' ');\n  me.s0 -= mash(seed);\n  if (me.s0 < 0) { me.s0 += 1; }\n  me.s1 -= mash(seed);\n  if (me.s1 < 0) { me.s1 += 1; }\n  me.s2 -= mash(seed);\n  if (me.s2 < 0) { me.s2 += 1; }\n  mash = null;\n}\n\nfunction copy(f, t) {\n  t.c = f.c;\n  t.s0 = f.s0;\n  t.s1 = f.s1;\n  t.s2 = f.s2;\n  return t;\n}\n\nfunction impl(seed, opts) {\n  var xg = new Alea(seed),\n      state = opts && opts.state,\n      prng = xg.next;\n  prng.int32 = function() { return (xg.next() * 0x100000000) | 0; }\n  prng.double = function() {\n    return prng() + (prng() * 0x200000 | 0) * 1.1102230246251565e-16; // 2^-53\n  };\n  prng.quick = prng;\n  if (state) {\n    if (typeof(state) == 'object') copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nfunction Mash() {\n  var n = 0xefc8249d;\n\n  var mash = function(data) {\n    data = data.toString();\n    for (var i = 0; i < data.length; i++) {\n      n += data.charCodeAt(i);\n      var h = 0.02519603282416938 * n;\n      n = h >>> 0;\n      h -= n;\n      h *= n;\n      n = h >>> 0;\n      h -= n;\n      n += h * 0x100000000; // 2^32\n    }\n    return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\n  };\n\n  return mash;\n}\n\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.alea = impl;\n}\n\n})(\n  this,\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n\n\n","// A Javascript implementaion of the \"xor128\" prng algorithm by\n// George Marsaglia.  See http://www.jstatsoft.org/v08/i14/paper\n\n(function(global, module, define) {\n\nfunction XorGen(seed) {\n  var me = this, strseed = '';\n\n  me.x = 0;\n  me.y = 0;\n  me.z = 0;\n  me.w = 0;\n\n  // Set up generator function.\n  me.next = function() {\n    var t = me.x ^ (me.x << 11);\n    me.x = me.y;\n    me.y = me.z;\n    me.z = me.w;\n    return me.w ^= (me.w >>> 19) ^ t ^ (t >>> 8);\n  };\n\n  if (seed === (seed | 0)) {\n    // Integer seed.\n    me.x = seed;\n  } else {\n    // String seed.\n    strseed += seed;\n  }\n\n  // Mix in string seed, then discard an initial batch of 64 values.\n  for (var k = 0; k < strseed.length + 64; k++) {\n    me.x ^= strseed.charCodeAt(k) | 0;\n    me.next();\n  }\n}\n\nfunction copy(f, t) {\n  t.x = f.x;\n  t.y = f.y;\n  t.z = f.z;\n  t.w = f.w;\n  return t;\n}\n\nfunction impl(seed, opts) {\n  var xg = new XorGen(seed),\n      state = opts && opts.state,\n      prng = function() { return (xg.next() >>> 0) / 0x100000000; };\n  prng.double = function() {\n    do {\n      var top = xg.next() >>> 11,\n          bot = (xg.next() >>> 0) / 0x100000000,\n          result = (top + bot) / (1 << 21);\n    } while (result === 0);\n    return result;\n  };\n  prng.int32 = xg.next;\n  prng.quick = prng;\n  if (state) {\n    if (typeof(state) == 'object') copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.xor128 = impl;\n}\n\n})(\n  this,\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n\n\n","// A Javascript implementaion of the \"xorwow\" prng algorithm by\n// George Marsaglia.  See http://www.jstatsoft.org/v08/i14/paper\n\n(function(global, module, define) {\n\nfunction XorGen(seed) {\n  var me = this, strseed = '';\n\n  // Set up generator function.\n  me.next = function() {\n    var t = (me.x ^ (me.x >>> 2));\n    me.x = me.y; me.y = me.z; me.z = me.w; me.w = me.v;\n    return (me.d = (me.d + 362437 | 0)) +\n       (me.v = (me.v ^ (me.v << 4)) ^ (t ^ (t << 1))) | 0;\n  };\n\n  me.x = 0;\n  me.y = 0;\n  me.z = 0;\n  me.w = 0;\n  me.v = 0;\n\n  if (seed === (seed | 0)) {\n    // Integer seed.\n    me.x = seed;\n  } else {\n    // String seed.\n    strseed += seed;\n  }\n\n  // Mix in string seed, then discard an initial batch of 64 values.\n  for (var k = 0; k < strseed.length + 64; k++) {\n    me.x ^= strseed.charCodeAt(k) | 0;\n    if (k == strseed.length) {\n      me.d = me.x << 10 ^ me.x >>> 4;\n    }\n    me.next();\n  }\n}\n\nfunction copy(f, t) {\n  t.x = f.x;\n  t.y = f.y;\n  t.z = f.z;\n  t.w = f.w;\n  t.v = f.v;\n  t.d = f.d;\n  return t;\n}\n\nfunction impl(seed, opts) {\n  var xg = new XorGen(seed),\n      state = opts && opts.state,\n      prng = function() { return (xg.next() >>> 0) / 0x100000000; };\n  prng.double = function() {\n    do {\n      var top = xg.next() >>> 11,\n          bot = (xg.next() >>> 0) / 0x100000000,\n          result = (top + bot) / (1 << 21);\n    } while (result === 0);\n    return result;\n  };\n  prng.int32 = xg.next;\n  prng.quick = prng;\n  if (state) {\n    if (typeof(state) == 'object') copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.xorwow = impl;\n}\n\n})(\n  this,\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n\n\n","// A Javascript implementaion of the \"xorshift7\" algorithm by\n// François Panneton and Pierre L'ecuyer:\n// \"On the Xorgshift Random Number Generators\"\n// http://saluc.engr.uconn.edu/refs/crypto/rng/panneton05onthexorshift.pdf\n\n(function(global, module, define) {\n\nfunction XorGen(seed) {\n  var me = this;\n\n  // Set up generator function.\n  me.next = function() {\n    // Update xor generator.\n    var X = me.x, i = me.i, t, v, w;\n    t = X[i]; t ^= (t >>> 7); v = t ^ (t << 24);\n    t = X[(i + 1) & 7]; v ^= t ^ (t >>> 10);\n    t = X[(i + 3) & 7]; v ^= t ^ (t >>> 3);\n    t = X[(i + 4) & 7]; v ^= t ^ (t << 7);\n    t = X[(i + 7) & 7]; t = t ^ (t << 13); v ^= t ^ (t << 9);\n    X[i] = v;\n    me.i = (i + 1) & 7;\n    return v;\n  };\n\n  function init(me, seed) {\n    var j, w, X = [];\n\n    if (seed === (seed | 0)) {\n      // Seed state array using a 32-bit integer.\n      w = X[0] = seed;\n    } else {\n      // Seed state using a string.\n      seed = '' + seed;\n      for (j = 0; j < seed.length; ++j) {\n        X[j & 7] = (X[j & 7] << 15) ^\n            (seed.charCodeAt(j) + X[(j + 1) & 7] << 13);\n      }\n    }\n    // Enforce an array length of 8, not all zeroes.\n    while (X.length < 8) X.push(0);\n    for (j = 0; j < 8 && X[j] === 0; ++j);\n    if (j == 8) w = X[7] = -1; else w = X[j];\n\n    me.x = X;\n    me.i = 0;\n\n    // Discard an initial 256 values.\n    for (j = 256; j > 0; --j) {\n      me.next();\n    }\n  }\n\n  init(me, seed);\n}\n\nfunction copy(f, t) {\n  t.x = f.x.slice();\n  t.i = f.i;\n  return t;\n}\n\nfunction impl(seed, opts) {\n  if (seed == null) seed = +(new Date);\n  var xg = new XorGen(seed),\n      state = opts && opts.state,\n      prng = function() { return (xg.next() >>> 0) / 0x100000000; };\n  prng.double = function() {\n    do {\n      var top = xg.next() >>> 11,\n          bot = (xg.next() >>> 0) / 0x100000000,\n          result = (top + bot) / (1 << 21);\n    } while (result === 0);\n    return result;\n  };\n  prng.int32 = xg.next;\n  prng.quick = prng;\n  if (state) {\n    if (state.x) copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.xorshift7 = impl;\n}\n\n})(\n  this,\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n\n","// A Javascript implementaion of Richard Brent's Xorgens xor4096 algorithm.\n//\n// This fast non-cryptographic random number generator is designed for\n// use in Monte-Carlo algorithms. It combines a long-period xorshift\n// generator with a Weyl generator, and it passes all common batteries\n// of stasticial tests for randomness while consuming only a few nanoseconds\n// for each prng generated.  For background on the generator, see Brent's\n// paper: \"Some long-period random number generators using shifts and xors.\"\n// http://arxiv.org/pdf/1004.3115v1.pdf\n//\n// Usage:\n//\n// var xor4096 = require('xor4096');\n// random = xor4096(1);                        // Seed with int32 or string.\n// assert.equal(random(), 0.1520436450538547); // (0, 1) range, 53 bits.\n// assert.equal(random.int32(), 1806534897);   // signed int32, 32 bits.\n//\n// For nonzero numeric keys, this impelementation provides a sequence\n// identical to that by Brent's xorgens 3 implementaion in C.  This\n// implementation also provides for initalizing the generator with\n// string seeds, or for saving and restoring the state of the generator.\n//\n// On Chrome, this prng benchmarks about 2.1 times slower than\n// Javascript's built-in Math.random().\n\n(function(global, module, define) {\n\nfunction XorGen(seed) {\n  var me = this;\n\n  // Set up generator function.\n  me.next = function() {\n    var w = me.w,\n        X = me.X, i = me.i, t, v;\n    // Update Weyl generator.\n    me.w = w = (w + 0x61c88647) | 0;\n    // Update xor generator.\n    v = X[(i + 34) & 127];\n    t = X[i = ((i + 1) & 127)];\n    v ^= v << 13;\n    t ^= t << 17;\n    v ^= v >>> 15;\n    t ^= t >>> 12;\n    // Update Xor generator array state.\n    v = X[i] = v ^ t;\n    me.i = i;\n    // Result is the combination.\n    return (v + (w ^ (w >>> 16))) | 0;\n  };\n\n  function init(me, seed) {\n    var t, v, i, j, w, X = [], limit = 128;\n    if (seed === (seed | 0)) {\n      // Numeric seeds initialize v, which is used to generates X.\n      v = seed;\n      seed = null;\n    } else {\n      // String seeds are mixed into v and X one character at a time.\n      seed = seed + '\\0';\n      v = 0;\n      limit = Math.max(limit, seed.length);\n    }\n    // Initialize circular array and weyl value.\n    for (i = 0, j = -32; j < limit; ++j) {\n      // Put the unicode characters into the array, and shuffle them.\n      if (seed) v ^= seed.charCodeAt((j + 32) % seed.length);\n      // After 32 shuffles, take v as the starting w value.\n      if (j === 0) w = v;\n      v ^= v << 10;\n      v ^= v >>> 15;\n      v ^= v << 4;\n      v ^= v >>> 13;\n      if (j >= 0) {\n        w = (w + 0x61c88647) | 0;     // Weyl.\n        t = (X[j & 127] ^= (v + w));  // Combine xor and weyl to init array.\n        i = (0 == t) ? i + 1 : 0;     // Count zeroes.\n      }\n    }\n    // We have detected all zeroes; make the key nonzero.\n    if (i >= 128) {\n      X[(seed && seed.length || 0) & 127] = -1;\n    }\n    // Run the generator 512 times to further mix the state before using it.\n    // Factoring this as a function slows the main generator, so it is just\n    // unrolled here.  The weyl generator is not advanced while warming up.\n    i = 127;\n    for (j = 4 * 128; j > 0; --j) {\n      v = X[(i + 34) & 127];\n      t = X[i = ((i + 1) & 127)];\n      v ^= v << 13;\n      t ^= t << 17;\n      v ^= v >>> 15;\n      t ^= t >>> 12;\n      X[i] = v ^ t;\n    }\n    // Storing state as object members is faster than using closure variables.\n    me.w = w;\n    me.X = X;\n    me.i = i;\n  }\n\n  init(me, seed);\n}\n\nfunction copy(f, t) {\n  t.i = f.i;\n  t.w = f.w;\n  t.X = f.X.slice();\n  return t;\n};\n\nfunction impl(seed, opts) {\n  if (seed == null) seed = +(new Date);\n  var xg = new XorGen(seed),\n      state = opts && opts.state,\n      prng = function() { return (xg.next() >>> 0) / 0x100000000; };\n  prng.double = function() {\n    do {\n      var top = xg.next() >>> 11,\n          bot = (xg.next() >>> 0) / 0x100000000,\n          result = (top + bot) / (1 << 21);\n    } while (result === 0);\n    return result;\n  };\n  prng.int32 = xg.next;\n  prng.quick = prng;\n  if (state) {\n    if (state.X) copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.xor4096 = impl;\n}\n\n})(\n  this,                                     // window object or global\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n","// A Javascript implementaion of the \"Tyche-i\" prng algorithm by\n// Samuel Neves and Filipe Araujo.\n// See https://eden.dei.uc.pt/~sneves/pubs/2011-snfa2.pdf\n\n(function(global, module, define) {\n\nfunction XorGen(seed) {\n  var me = this, strseed = '';\n\n  // Set up generator function.\n  me.next = function() {\n    var b = me.b, c = me.c, d = me.d, a = me.a;\n    b = (b << 25) ^ (b >>> 7) ^ c;\n    c = (c - d) | 0;\n    d = (d << 24) ^ (d >>> 8) ^ a;\n    a = (a - b) | 0;\n    me.b = b = (b << 20) ^ (b >>> 12) ^ c;\n    me.c = c = (c - d) | 0;\n    me.d = (d << 16) ^ (c >>> 16) ^ a;\n    return me.a = (a - b) | 0;\n  };\n\n  /* The following is non-inverted tyche, which has better internal\n   * bit diffusion, but which is about 25% slower than tyche-i in JS.\n  me.next = function() {\n    var a = me.a, b = me.b, c = me.c, d = me.d;\n    a = (me.a + me.b | 0) >>> 0;\n    d = me.d ^ a; d = d << 16 ^ d >>> 16;\n    c = me.c + d | 0;\n    b = me.b ^ c; b = b << 12 ^ d >>> 20;\n    me.a = a = a + b | 0;\n    d = d ^ a; me.d = d = d << 8 ^ d >>> 24;\n    me.c = c = c + d | 0;\n    b = b ^ c;\n    return me.b = (b << 7 ^ b >>> 25);\n  }\n  */\n\n  me.a = 0;\n  me.b = 0;\n  me.c = 2654435769 | 0;\n  me.d = 1367130551;\n\n  if (seed === Math.floor(seed)) {\n    // Integer seed.\n    me.a = (seed / 0x100000000) | 0;\n    me.b = seed | 0;\n  } else {\n    // String seed.\n    strseed += seed;\n  }\n\n  // Mix in string seed, then discard an initial batch of 64 values.\n  for (var k = 0; k < strseed.length + 20; k++) {\n    me.b ^= strseed.charCodeAt(k) | 0;\n    me.next();\n  }\n}\n\nfunction copy(f, t) {\n  t.a = f.a;\n  t.b = f.b;\n  t.c = f.c;\n  t.d = f.d;\n  return t;\n};\n\nfunction impl(seed, opts) {\n  var xg = new XorGen(seed),\n      state = opts && opts.state,\n      prng = function() { return (xg.next() >>> 0) / 0x100000000; };\n  prng.double = function() {\n    do {\n      var top = xg.next() >>> 11,\n          bot = (xg.next() >>> 0) / 0x100000000,\n          result = (top + bot) / (1 << 21);\n    } while (result === 0);\n    return result;\n  };\n  prng.int32 = xg.next;\n  prng.quick = prng;\n  if (state) {\n    if (typeof(state) == 'object') copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.tychei = impl;\n}\n\n})(\n  this,\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n\n\n","/*\nCopyright 2014 David Bau.\n\nPermission is hereby granted, free of charge, to any person obtaining\na copy of this software and associated documentation files (the\n\"Software\"), to deal in the Software without restriction, including\nwithout limitation the rights to use, copy, modify, merge, publish,\ndistribute, sublicense, and/or sell copies of the Software, and to\npermit persons to whom the Software is furnished to do so, subject to\nthe following conditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\nIN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\nCLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\nTORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\nSOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n*/\n\n(function (pool, math) {\n//\n// The following constants are related to IEEE 754 limits.\n//\n\n// Detect the global object, even if operating in strict mode.\n// http://stackoverflow.com/a/14387057/265298\nvar global = (0, eval)('this'),\n    width = 256,        // each RC4 output is 0 <= x < 256\n    chunks = 6,         // at least six RC4 outputs for each double\n    digits = 52,        // there are 52 significant digits in a double\n    rngname = 'random', // rngname: name for Math.random and Math.seedrandom\n    startdenom = math.pow(width, chunks),\n    significance = math.pow(2, digits),\n    overflow = significance * 2,\n    mask = width - 1,\n    nodecrypto;         // node.js crypto module, initialized at the bottom.\n\n//\n// seedrandom()\n// This is the seedrandom function described above.\n//\nfunction seedrandom(seed, options, callback) {\n  var key = [];\n  options = (options == true) ? { entropy: true } : (options || {});\n\n  // Flatten the seed string or build one from local entropy if needed.\n  var shortseed = mixkey(flatten(\n    options.entropy ? [seed, tostring(pool)] :\n    (seed == null) ? autoseed() : seed, 3), key);\n\n  // Use the seed to initialize an ARC4 generator.\n  var arc4 = new ARC4(key);\n\n  // This function returns a random double in [0, 1) that contains\n  // randomness in every bit of the mantissa of the IEEE 754 value.\n  var prng = function() {\n    var n = arc4.g(chunks),             // Start with a numerator n < 2 ^ 48\n        d = startdenom,                 //   and denominator d = 2 ^ 48.\n        x = 0;                          //   and no 'extra last byte'.\n    while (n < significance) {          // Fill up all significant digits by\n      n = (n + x) * width;              //   shifting numerator and\n      d *= width;                       //   denominator and generating a\n      x = arc4.g(1);                    //   new least-significant-byte.\n    }\n    while (n >= overflow) {             // To avoid rounding up, before adding\n      n /= 2;                           //   last byte, shift everything\n      d /= 2;                           //   right using integer math until\n      x >>>= 1;                         //   we have exactly the desired bits.\n    }\n    return (n + x) / d;                 // Form the number within [0, 1).\n  };\n\n  prng.int32 = function() { return arc4.g(4) | 0; }\n  prng.quick = function() { return arc4.g(4) / 0x100000000; }\n  prng.double = prng;\n\n  // Mix the randomness into accumulated entropy.\n  mixkey(tostring(arc4.S), pool);\n\n  // Calling convention: what to return as a function of prng, seed, is_math.\n  return (options.pass || callback ||\n      function(prng, seed, is_math_call, state) {\n        if (state) {\n          // Load the arc4 state from the given state if it has an S array.\n          if (state.S) { copy(state, arc4); }\n          // Only provide the .state method if requested via options.state.\n          prng.state = function() { return copy(arc4, {}); }\n        }\n\n        // If called as a method of Math (Math.seedrandom()), mutate\n        // Math.random because that is how seedrandom.js has worked since v1.0.\n        if (is_math_call) { math[rngname] = prng; return seed; }\n\n        // Otherwise, it is a newer calling convention, so return the\n        // prng directly.\n        else return prng;\n      })(\n  prng,\n  shortseed,\n  'global' in options ? options.global : (this == math),\n  options.state);\n}\nmath['seed' + rngname] = seedrandom;\n\n//\n// ARC4\n//\n// An ARC4 implementation.  The constructor takes a key in the form of\n// an array of at most (width) integers that should be 0 <= x < (width).\n//\n// The g(count) method returns a pseudorandom integer that concatenates\n// the next (count) outputs from ARC4.  Its return value is a number x\n// that is in the range 0 <= x < (width ^ count).\n//\nfunction ARC4(key) {\n  var t, keylen = key.length,\n      me = this, i = 0, j = me.i = me.j = 0, s = me.S = [];\n\n  // The empty key [] is treated as [0].\n  if (!keylen) { key = [keylen++]; }\n\n  // Set up S using the standard key scheduling algorithm.\n  while (i < width) {\n    s[i] = i++;\n  }\n  for (i = 0; i < width; i++) {\n    s[i] = s[j = mask & (j + key[i % keylen] + (t = s[i]))];\n    s[j] = t;\n  }\n\n  // The \"g\" method returns the next (count) outputs as one number.\n  (me.g = function(count) {\n    // Using instance members instead of closure state nearly doubles speed.\n    var t, r = 0,\n        i = me.i, j = me.j, s = me.S;\n    while (count--) {\n      t = s[i = mask & (i + 1)];\n      r = r * width + s[mask & ((s[i] = s[j = mask & (j + t)]) + (s[j] = t))];\n    }\n    me.i = i; me.j = j;\n    return r;\n    // For robust unpredictability, the function call below automatically\n    // discards an initial batch of values.  This is called RC4-drop[256].\n    // See http://google.com/search?q=rsa+fluhrer+response&btnI\n  })(width);\n}\n\n//\n// copy()\n// Copies internal state of ARC4 to or from a plain object.\n//\nfunction copy(f, t) {\n  t.i = f.i;\n  t.j = f.j;\n  t.S = f.S.slice();\n  return t;\n};\n\n//\n// flatten()\n// Converts an object tree to nested arrays of strings.\n//\nfunction flatten(obj, depth) {\n  var result = [], typ = (typeof obj), prop;\n  if (depth && typ == 'object') {\n    for (prop in obj) {\n      try { result.push(flatten(obj[prop], depth - 1)); } catch (e) {}\n    }\n  }\n  return (result.length ? result : typ == 'string' ? obj : obj + '\\0');\n}\n\n//\n// mixkey()\n// Mixes a string seed into a key that is an array of integers, and\n// returns a shortened string seed that is equivalent to the result key.\n//\nfunction mixkey(seed, key) {\n  var stringseed = seed + '', smear, j = 0;\n  while (j < stringseed.length) {\n    key[mask & j] =\n      mask & ((smear ^= key[mask & j] * 19) + stringseed.charCodeAt(j++));\n  }\n  return tostring(key);\n}\n\n//\n// autoseed()\n// Returns an object for autoseeding, using window.crypto and Node crypto\n// module if available.\n//\nfunction autoseed() {\n  try {\n    var out;\n    if (nodecrypto && (out = nodecrypto.randomBytes)) {\n      // The use of 'out' to remember randomBytes makes tight minified code.\n      out = out(width);\n    } else {\n      out = new Uint8Array(width);\n      (global.crypto || global.msCrypto).getRandomValues(out);\n    }\n    return tostring(out);\n  } catch (e) {\n    var browser = global.navigator,\n        plugins = browser && browser.plugins;\n    return [+new Date, global, plugins, global.screen, tostring(pool)];\n  }\n}\n\n//\n// tostring()\n// Converts an array of charcodes to a string\n//\nfunction tostring(a) {\n  return String.fromCharCode.apply(0, a);\n}\n\n//\n// When seedrandom.js is loaded, we immediately mix a few bits\n// from the built-in RNG into the entropy pool.  Because we do\n// not want to interfere with deterministic PRNG state later,\n// seedrandom will not call math.random on its own again after\n// initialization.\n//\nmixkey(math.random(), pool);\n\n//\n// Nodejs and AMD support: export the implementation as a module using\n// either convention.\n//\nif ((typeof module) == 'object' && module.exports) {\n  module.exports = seedrandom;\n  // When in node.js, try using crypto package for autoseeding.\n  try {\n    nodecrypto = require('crypto');\n  } catch (ex) {}\n} else if ((typeof define) == 'function' && define.amd) {\n  define(function() { return seedrandom; });\n}\n\n// End anonymous scope, and pass initial values.\n})(\n  [],     // pool: entropy pool starts empty\n  Math    // math: package containing random, pow, and seedrandom\n);\n","// A library of seedable RNGs implemented in Javascript.\n//\n// Usage:\n//\n// var seedrandom = require('seedrandom');\n// var random = seedrandom(1); // or any seed.\n// var x = random();       // 0 <= x < 1.  Every bit is random.\n// var x = random.quick(); // 0 <= x < 1.  32 bits of randomness.\n\n// alea, a 53-bit multiply-with-carry generator by Johannes Baagøe.\n// Period: ~2^116\n// Reported to pass all BigCrush tests.\nvar alea = require('./lib/alea');\n\n// xor128, a pure xor-shift generator by George Marsaglia.\n// Period: 2^128-1.\n// Reported to fail: MatrixRank and LinearComp.\nvar xor128 = require('./lib/xor128');\n\n// xorwow, George Marsaglia's 160-bit xor-shift combined plus weyl.\n// Period: 2^192-2^32\n// Reported to fail: CollisionOver, SimpPoker, and LinearComp.\nvar xorwow = require('./lib/xorwow');\n\n// xorshift7, by François Panneton and Pierre L'ecuyer, takes\n// a different approach: it adds robustness by allowing more shifts\n// than Marsaglia's original three.  It is a 7-shift generator\n// with 256 bits, that passes BigCrush with no systmatic failures.\n// Period 2^256-1.\n// No systematic BigCrush failures reported.\nvar xorshift7 = require('./lib/xorshift7');\n\n// xor4096, by Richard Brent, is a 4096-bit xor-shift with a\n// very long period that also adds a Weyl generator. It also passes\n// BigCrush with no systematic failures.  Its long period may\n// be useful if you have many generators and need to avoid\n// collisions.\n// Period: 2^4128-2^32.\n// No systematic BigCrush failures reported.\nvar xor4096 = require('./lib/xor4096');\n\n// Tyche-i, by Samuel Neves and Filipe Araujo, is a bit-shifting random\n// number generator derived from ChaCha, a modern stream cipher.\n// https://eden.dei.uc.pt/~sneves/pubs/2011-snfa2.pdf\n// Period: ~2^127\n// No systematic BigCrush failures reported.\nvar tychei = require('./lib/tychei');\n\n// The original ARC4-based prng included in this library.\n// Period: ~2^1600\nvar sr = require('./seedrandom');\n\nsr.alea = alea;\nsr.xor128 = xor128;\nsr.xorwow = xorwow;\nsr.xorshift7 = xorshift7;\nsr.xor4096 = xor4096;\nsr.tychei = tychei;\n\nmodule.exports = sr;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction shuffle(array) {\n    var counter = array.length;\n    var temp = 0;\n    var index = 0;\n    while (counter > 0) {\n        index = (Math.random() * counter) | 0;\n        counter--;\n        temp = array[counter];\n        array[counter] = array[index];\n        array[index] = temp;\n    }\n}\nexports.shuffle = shuffle;\nfunction clamp(min, x, max) {\n    return Math.max(min, Math.min(x, max));\n}\nexports.clamp = clamp;\nfunction nearestLargerEven(val) {\n    return val % 2 === 0 ? val : val + 1;\n}\nexports.nearestLargerEven = nearestLargerEven;\nfunction sum(arr) {\n    var sum = 0;\n    for (var i = 0; i < arr.length; i++) {\n        sum += arr[i];\n    }\n    return sum;\n}\nexports.sum = sum;\nfunction randUniform(a, b) {\n    var r = Math.random();\n    return (b * r) + (1 - r) * a;\n}\nexports.randUniform = randUniform;\nfunction distSquared(a, b) {\n    var result = 0;\n    for (var i = 0; i < a.length; i++) {\n        var diff = Number(a[i]) - Number(b[i]);\n        result += diff * diff;\n    }\n    return result;\n}\nexports.distSquared = distSquared;\nfunction assert(expr, msg) {\n    if (!expr) {\n        throw new Error(typeof msg === 'string' ? msg : msg());\n    }\n}\nexports.assert = assert;\nfunction assertShapesMatch(shapeA, shapeB, errorMessagePrefix) {\n    if (errorMessagePrefix === void 0) { errorMessagePrefix = ''; }\n    assert(arraysEqual(shapeA, shapeB), errorMessagePrefix + (\" Shapes \" + shapeA + \" and \" + shapeB + \" must match\"));\n}\nexports.assertShapesMatch = assertShapesMatch;\nfunction assertNonNull(a) {\n    assert(a != null, \"The input to the tensor constructor must be a non-null value.\");\n}\nexports.assertNonNull = assertNonNull;\nfunction flatten(arr, ret) {\n    if (ret === void 0) { ret = []; }\n    if (Array.isArray(arr) || isTypedArray(arr)) {\n        for (var i = 0; i < arr.length; ++i) {\n            flatten(arr[i], ret);\n        }\n    }\n    else {\n        ret.push(arr);\n    }\n    return ret;\n}\nexports.flatten = flatten;\nfunction sizeFromShape(shape) {\n    if (shape.length === 0) {\n        return 1;\n    }\n    var size = shape[0];\n    for (var i = 1; i < shape.length; i++) {\n        size *= shape[i];\n    }\n    return size;\n}\nexports.sizeFromShape = sizeFromShape;\nfunction isScalarShape(shape) {\n    return shape.length === 0;\n}\nexports.isScalarShape = isScalarShape;\nfunction arraysEqual(n1, n2) {\n    if (n1 === n2) {\n        return true;\n    }\n    if (n1 == null || n2 == null) {\n        return false;\n    }\n    if (n1.length !== n2.length) {\n        return false;\n    }\n    for (var i = 0; i < n1.length; i++) {\n        if (n1[i] !== n2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\nexports.arraysEqual = arraysEqual;\nfunction isInt(a) {\n    return a % 1 === 0;\n}\nexports.isInt = isInt;\nfunction tanh(x) {\n    if (Math.tanh != null) {\n        return Math.tanh(x);\n    }\n    if (x === Infinity) {\n        return 1;\n    }\n    else if (x === -Infinity) {\n        return -1;\n    }\n    else {\n        var e2x = Math.exp(2 * x);\n        return (e2x - 1) / (e2x + 1);\n    }\n}\nexports.tanh = tanh;\nfunction sizeToSquarishShape(size) {\n    for (var a = Math.floor(Math.sqrt(size)); a > 1; --a) {\n        if (size % a === 0) {\n            return [a, size / a];\n        }\n    }\n    return [1, size];\n}\nexports.sizeToSquarishShape = sizeToSquarishShape;\nfunction createShuffledIndices(n) {\n    var shuffledIndices = new Uint32Array(n);\n    for (var i = 0; i < n; ++i) {\n        shuffledIndices[i] = i;\n    }\n    shuffle(shuffledIndices);\n    return shuffledIndices;\n}\nexports.createShuffledIndices = createShuffledIndices;\nfunction rightPad(a, size) {\n    if (size <= a.length) {\n        return a;\n    }\n    return a + ' '.repeat(size - a.length);\n}\nexports.rightPad = rightPad;\nfunction repeatedTry(checkFn, delayFn, maxCounter) {\n    if (delayFn === void 0) { delayFn = function (counter) { return 0; }; }\n    return new Promise(function (resolve, reject) {\n        var tryCount = 0;\n        var tryFn = function () {\n            if (checkFn()) {\n                resolve();\n                return;\n            }\n            tryCount++;\n            var nextBackoff = delayFn(tryCount);\n            if (maxCounter != null && tryCount >= maxCounter) {\n                reject();\n                return;\n            }\n            setTimeout(tryFn, nextBackoff);\n        };\n        tryFn();\n    });\n}\nexports.repeatedTry = repeatedTry;\nfunction inferFromImplicitShape(shape, size) {\n    var shapeProd = 1;\n    var implicitIdx = -1;\n    for (var i = 0; i < shape.length; ++i) {\n        if (shape[i] >= 0) {\n            shapeProd *= shape[i];\n        }\n        else if (shape[i] === -1) {\n            if (implicitIdx !== -1) {\n                throw Error(\"Shapes can only have 1 implicit size. \" +\n                    (\"Found -1 at dim \" + implicitIdx + \" and dim \" + i));\n            }\n            implicitIdx = i;\n        }\n        else if (shape[i] < 0) {\n            throw Error(\"Shapes can not be < 0. Found \" + shape[i] + \" at dim \" + i);\n        }\n    }\n    if (implicitIdx === -1) {\n        if (size > 0 && size !== shapeProd) {\n            throw Error(\"Size(\" + size + \") must match the product of shape \" + shape);\n        }\n        return shape;\n    }\n    if (shapeProd === 0) {\n        throw Error(\"Cannot infer the missing size in [\" + shape + \"] when \" +\n            \"there are 0 elements\");\n    }\n    if (size % shapeProd !== 0) {\n        throw Error(\"The implicit shape can't be a fractional number. \" +\n            (\"Got \" + size + \" / \" + shapeProd));\n    }\n    var newShape = shape.slice();\n    newShape[implicitIdx] = size / shapeProd;\n    return newShape;\n}\nexports.inferFromImplicitShape = inferFromImplicitShape;\nfunction squeezeShape(shape, axis) {\n    var newShape = [];\n    var keptDims = [];\n    var j = 0;\n    for (var i = 0; i < shape.length; ++i) {\n        if (axis != null) {\n            if (axis[j] === i && shape[i] !== 1) {\n                throw new Error(\"Can't squeeze axis \" + i + \" since its dim '\" + shape[i] + \"' is not 1\");\n            }\n            if ((axis[j] == null || axis[j] > i) && shape[i] === 1) {\n                newShape.push(shape[i]);\n                keptDims.push(i);\n            }\n            if (axis[j] <= i) {\n                j++;\n            }\n        }\n        if (shape[i] !== 1) {\n            newShape.push(shape[i]);\n            keptDims.push(i);\n        }\n    }\n    return { newShape: newShape, keptDims: keptDims };\n}\nexports.squeezeShape = squeezeShape;\nfunction getTypedArrayFromDType(dtype, size) {\n    var values = null;\n    if (dtype == null || dtype === 'float32') {\n        values = new Float32Array(size);\n    }\n    else if (dtype === 'int32') {\n        values = new Int32Array(size);\n    }\n    else if (dtype === 'bool') {\n        values = new Uint8Array(size);\n    }\n    else {\n        throw new Error(\"Unknown data type \" + dtype);\n    }\n    return values;\n}\nexports.getTypedArrayFromDType = getTypedArrayFromDType;\nfunction getArrayFromDType(dtype, size) {\n    var values = null;\n    if (dtype == null || dtype === 'float32') {\n        values = new Float32Array(size);\n    }\n    else if (dtype === 'int32') {\n        values = new Int32Array(size);\n    }\n    else if (dtype === 'bool') {\n        values = new Uint8Array(size);\n    }\n    else if (dtype === 'string') {\n        values = new Array(size);\n    }\n    else {\n        throw new Error(\"Unknown data type \" + dtype);\n    }\n    return values;\n}\nexports.getArrayFromDType = getArrayFromDType;\nfunction checkComputationForNaN(vals, dtype, name) {\n    if (dtype !== 'float32') {\n        return;\n    }\n    for (var i = 0; i < vals.length; i++) {\n        if (isNaN(vals[i])) {\n            throw Error(\"The result of the '\" + name + \"' has NaNs.\");\n        }\n    }\n}\nexports.checkComputationForNaN = checkComputationForNaN;\nfunction checkConversionForNaN(vals, dtype) {\n    if (dtype === 'float32') {\n        return;\n    }\n    for (var i = 0; i < vals.length; i++) {\n        if (isNaN(vals[i])) {\n            throw Error(\"NaN is not a valid value for dtype: '\" + dtype + \"'.\");\n        }\n    }\n}\nexports.checkConversionForNaN = checkConversionForNaN;\nfunction hasEncodingLoss(oldType, newType) {\n    if (newType === 'complex64') {\n        return false;\n    }\n    if (newType === 'float32' && oldType !== 'complex64') {\n        return false;\n    }\n    if (newType === 'int32' && oldType !== 'float32' && oldType !== 'complex64') {\n        return false;\n    }\n    if (newType === 'bool' && oldType === 'bool') {\n        return false;\n    }\n    return true;\n}\nexports.hasEncodingLoss = hasEncodingLoss;\nfunction isTypedArray(a) {\n    return a instanceof Float32Array || a instanceof Int32Array ||\n        a instanceof Uint8Array;\n}\nexports.isTypedArray = isTypedArray;\nfunction bytesPerElement(dtype) {\n    if (dtype === 'float32' || dtype === 'int32') {\n        return 4;\n    }\n    else if (dtype === 'complex64') {\n        return 8;\n    }\n    else if (dtype === 'bool') {\n        return 1;\n    }\n    else {\n        throw new Error(\"Unknown dtype \" + dtype);\n    }\n}\nexports.bytesPerElement = bytesPerElement;\nfunction bytesFromStringArray(arr) {\n    if (arr == null) {\n        return 0;\n    }\n    var bytes = 0;\n    arr.forEach(function (x) { return bytes += x.length * 2; });\n    return bytes;\n}\nexports.bytesFromStringArray = bytesFromStringArray;\nfunction isString(value) {\n    return typeof value === 'string' || value instanceof String;\n}\nexports.isString = isString;\nfunction isBoolean(value) {\n    return typeof value === 'boolean';\n}\nexports.isBoolean = isBoolean;\nfunction isNumber(value) {\n    return typeof value === 'number';\n}\nexports.isNumber = isNumber;\nfunction inferDtype(values) {\n    if (values instanceof Array) {\n        return inferDtype(values[0]);\n    }\n    if (values instanceof Float32Array) {\n        return 'float32';\n    }\n    else if (values instanceof Int32Array || values instanceof Uint8Array) {\n        return 'int32';\n    }\n    else if (isNumber(values)) {\n        return 'float32';\n    }\n    else if (isString(values)) {\n        return 'string';\n    }\n    else if (isBoolean(values)) {\n        return 'bool';\n    }\n    return 'float32';\n}\nexports.inferDtype = inferDtype;\nfunction isFunction(f) {\n    return !!(f && f.constructor && f.call && f.apply);\n}\nexports.isFunction = isFunction;\nfunction nearestDivisor(size, start) {\n    for (var i = start; i < size; ++i) {\n        if (size % i === 0) {\n            return i;\n        }\n    }\n    return size;\n}\nexports.nearestDivisor = nearestDivisor;\nfunction computeStrides(shape) {\n    var rank = shape.length;\n    if (rank < 2) {\n        return [];\n    }\n    var strides = new Array(rank - 1);\n    strides[rank - 2] = shape[rank - 1];\n    for (var i = rank - 3; i >= 0; --i) {\n        strides[i] = strides[i + 1] * shape[i + 1];\n    }\n    return strides;\n}\nexports.computeStrides = computeStrides;\nfunction toTypedArray(a, dtype, debugMode) {\n    if (dtype === 'string') {\n        throw new Error('Cannot convert a string[] to a TypedArray');\n    }\n    if (noConversionNeeded(a, dtype)) {\n        return a;\n    }\n    if (Array.isArray(a)) {\n        a = flatten(a);\n    }\n    if (dtype == null || dtype === 'float32' || dtype === 'complex64') {\n        return new Float32Array(a);\n    }\n    else if (dtype === 'int32') {\n        if (debugMode) {\n            checkConversionForNaN(a, dtype);\n        }\n        return new Int32Array(a);\n    }\n    else if (dtype === 'bool') {\n        var bool = new Uint8Array(a.length);\n        for (var i = 0; i < bool.length; ++i) {\n            if (Math.round(a[i]) !== 0) {\n                bool[i] = 1;\n            }\n        }\n        return bool;\n    }\n    else {\n        throw new Error(\"Unknown data type \" + dtype);\n    }\n}\nexports.toTypedArray = toTypedArray;\nfunction noConversionNeeded(a, dtype) {\n    return (a instanceof Float32Array && dtype === 'float32') ||\n        (a instanceof Int32Array && dtype === 'int32') ||\n        (a instanceof Uint8Array && dtype === 'bool');\n}\nfunction makeOnesTypedArray(size, dtype) {\n    var array = makeZerosTypedArray(size, dtype);\n    for (var i = 0; i < array.length; i++) {\n        array[i] = 1;\n    }\n    return array;\n}\nexports.makeOnesTypedArray = makeOnesTypedArray;\nfunction makeZerosTypedArray(size, dtype) {\n    if (dtype == null || dtype === 'float32' || dtype === 'complex64') {\n        return new Float32Array(size);\n    }\n    else if (dtype === 'int32') {\n        return new Int32Array(size);\n    }\n    else if (dtype === 'bool') {\n        return new Uint8Array(size);\n    }\n    else {\n        throw new Error(\"Unknown data type \" + dtype);\n    }\n}\nexports.makeZerosTypedArray = makeZerosTypedArray;\nfunction now() {\n    if (typeof performance !== 'undefined') {\n        return performance.now();\n    }\n    else if (typeof process !== 'undefined') {\n        var time = process.hrtime();\n        return time[0] * 1000 + time[1] / 1000000;\n    }\n    else {\n        throw new Error('Cannot measure time in this environment. You should run tf.js ' +\n            'in the browser or in Node.js');\n    }\n}\nexports.now = now;\n//# sourceMappingURL=util.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util_1 = require(\"./util\");\nvar FORMAT_LIMIT_NUM_VALS = 20;\nvar FORMAT_NUM_FIRST_LAST_VALS = 3;\nvar FORMAT_NUM_SIG_DIGITS = 7;\nfunction tensorToString(vals, shape, dtype, verbose) {\n    var strides = util_1.computeStrides(shape);\n    var padPerCol = computeMaxSizePerColumn(vals, shape, dtype, strides);\n    var rank = shape.length;\n    var valsLines = subTensorToString(vals, shape, dtype, strides, padPerCol);\n    var lines = ['Tensor'];\n    if (verbose) {\n        lines.push(\"  dtype: \" + dtype);\n        lines.push(\"  rank: \" + rank);\n        lines.push(\"  shape: [\" + shape + \"]\");\n        lines.push(\"  values:\");\n    }\n    lines.push(valsLines.map(function (l) { return '    ' + l; }).join('\\n'));\n    return lines.join('\\n');\n}\nexports.tensorToString = tensorToString;\nfunction computeMaxSizePerColumn(vals, shape, dtype, strides) {\n    var n = util_1.sizeFromShape(shape);\n    var numCols = strides[strides.length - 1];\n    var padPerCol = new Array(numCols).fill(0);\n    var rank = shape.length;\n    var valuesOrTuples = dtype === 'complex64' ? createComplexTuples(vals) : vals;\n    if (rank > 1) {\n        for (var row = 0; row < n / numCols; row++) {\n            var offset = row * numCols;\n            for (var j = 0; j < numCols; j++) {\n                padPerCol[j] = Math.max(padPerCol[j], valToString(valuesOrTuples[offset + j], 0).length);\n            }\n        }\n    }\n    return padPerCol;\n}\nfunction valToString(val, pad) {\n    var valStr;\n    if (Array.isArray(val)) {\n        valStr = parseFloat(val[0].toFixed(FORMAT_NUM_SIG_DIGITS)) + \" + \" +\n            (parseFloat(val[1].toFixed(FORMAT_NUM_SIG_DIGITS)) + \"j\");\n    }\n    else if (util_1.isString(val)) {\n        valStr = \"'\" + val + \"'\";\n    }\n    else {\n        valStr = parseFloat(val.toFixed(FORMAT_NUM_SIG_DIGITS)).toString();\n    }\n    return util_1.rightPad(valStr, pad);\n}\nfunction subTensorToString(vals, shape, dtype, strides, padPerCol, isLast) {\n    if (isLast === void 0) { isLast = true; }\n    var storagePerElement = dtype === 'complex64' ? 2 : 1;\n    var size = shape[0];\n    var rank = shape.length;\n    if (rank === 0) {\n        if (dtype === 'complex64') {\n            var complexTuple = createComplexTuples(vals);\n            return [valToString(complexTuple[0], 0)];\n        }\n        return [vals[0].toString()];\n    }\n    if (rank === 1) {\n        if (size > FORMAT_LIMIT_NUM_VALS) {\n            var firstValsSize = FORMAT_NUM_FIRST_LAST_VALS * storagePerElement;\n            var firstVals = Array.from(vals.slice(0, firstValsSize));\n            var lastVals = Array.from(vals.slice(size - FORMAT_NUM_FIRST_LAST_VALS * storagePerElement, size));\n            if (dtype === 'complex64') {\n                firstVals = createComplexTuples(firstVals);\n                lastVals = createComplexTuples(lastVals);\n            }\n            return [\n                '[' + firstVals.map(function (x, i) { return valToString(x, padPerCol[i]); }).join(', ') +\n                    ', ..., ' +\n                    lastVals\n                        .map(function (x, i) { return valToString(x, padPerCol[size - FORMAT_NUM_FIRST_LAST_VALS + i]); })\n                        .join(', ') +\n                    ']'\n            ];\n        }\n        var displayVals = dtype === 'complex64' ? createComplexTuples(vals) :\n            Array.from(vals);\n        return [\n            '[' + displayVals.map(function (x, i) { return valToString(x, padPerCol[i]); }).join(', ') +\n                ']'\n        ];\n    }\n    var subshape = shape.slice(1);\n    var substrides = strides.slice(1);\n    var stride = strides[0] * storagePerElement;\n    var lines = [];\n    if (size > FORMAT_LIMIT_NUM_VALS) {\n        for (var i = 0; i < FORMAT_NUM_FIRST_LAST_VALS; i++) {\n            var start = i * stride;\n            var end = start + stride;\n            lines.push.apply(lines, subTensorToString(vals.slice(start, end), subshape, dtype, substrides, padPerCol, false));\n        }\n        lines.push('...');\n        for (var i = size - FORMAT_NUM_FIRST_LAST_VALS; i < size; i++) {\n            var start = i * stride;\n            var end = start + stride;\n            lines.push.apply(lines, subTensorToString(vals.slice(start, end), subshape, dtype, substrides, padPerCol, i === size - 1));\n        }\n    }\n    else {\n        for (var i = 0; i < size; i++) {\n            var start = i * stride;\n            var end = start + stride;\n            lines.push.apply(lines, subTensorToString(vals.slice(start, end), subshape, dtype, substrides, padPerCol, i === size - 1));\n        }\n    }\n    var sep = rank === 2 ? ',' : '';\n    lines[0] = '[' + lines[0] + sep;\n    for (var i = 1; i < lines.length - 1; i++) {\n        lines[i] = ' ' + lines[i] + sep;\n    }\n    var newLineSep = ',\\n';\n    for (var i = 2; i < rank; i++) {\n        newLineSep += '\\n';\n    }\n    lines[lines.length - 1] =\n        ' ' + lines[lines.length - 1] + ']' + (isLast ? '' : newLineSep);\n    return lines;\n}\nfunction createComplexTuples(vals) {\n    var complexTuples = [];\n    for (var i = 0; i < vals.length; i += 2) {\n        complexTuples.push([vals[i], vals[i + 1]]);\n    }\n    return complexTuples;\n}\n//# sourceMappingURL=tensor_format.js.map","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tensor_format_1 = require(\"./tensor_format\");\nvar util = require(\"./util\");\nvar util_1 = require(\"./util\");\nvar TensorBuffer = (function () {\n    function TensorBuffer(shape, dtype, values) {\n        this.dtype = dtype;\n        this.shape = shape.slice();\n        this.size = util.sizeFromShape(shape);\n        if (values != null) {\n            var n = values.length;\n            util.assert(n === this.size, \"Length of values '\" + n + \"' does not match the size \" +\n                (\"inferred by the shape '\" + this.size + \"'.\"));\n        }\n        if (dtype === 'complex64') {\n            throw new Error(\"complex64 dtype TensorBuffers are not supported. Please create \" +\n                \"a TensorBuffer for the real and imaginary parts separately and \" +\n                \"call tf.complex(real, imag).\");\n        }\n        this.values =\n            values || util.getArrayFromDType(dtype, util.sizeFromShape(this.shape));\n        this.strides = util_1.computeStrides(shape);\n    }\n    TensorBuffer.prototype.set = function (value) {\n        var locs = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            locs[_i - 1] = arguments[_i];\n        }\n        if (locs.length === 0) {\n            locs = [0];\n        }\n        util.assert(locs.length === this.rank, \"The number of provided coordinates (\" + locs.length + \") must \" +\n            (\"match the rank (\" + this.rank + \")\"));\n        var index = this.locToIndex(locs);\n        this.values[index] = value;\n    };\n    TensorBuffer.prototype.get = function () {\n        var locs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            locs[_i] = arguments[_i];\n        }\n        if (locs.length === 0) {\n            locs = [0];\n        }\n        var index = locs[locs.length - 1];\n        for (var i = 0; i < locs.length - 1; ++i) {\n            index += this.strides[i] * locs[i];\n        }\n        return this.values[index];\n    };\n    TensorBuffer.prototype.locToIndex = function (locs) {\n        if (this.rank === 0) {\n            return 0;\n        }\n        else if (this.rank === 1) {\n            return locs[0];\n        }\n        var index = locs[locs.length - 1];\n        for (var i = 0; i < locs.length - 1; ++i) {\n            index += this.strides[i] * locs[i];\n        }\n        return index;\n    };\n    TensorBuffer.prototype.indexToLoc = function (index) {\n        if (this.rank === 0) {\n            return [];\n        }\n        else if (this.rank === 1) {\n            return [index];\n        }\n        var locs = new Array(this.shape.length);\n        for (var i = 0; i < locs.length - 1; ++i) {\n            locs[i] = Math.floor(index / this.strides[i]);\n            index -= locs[i] * this.strides[i];\n        }\n        locs[locs.length - 1] = index;\n        return locs;\n    };\n    Object.defineProperty(TensorBuffer.prototype, \"rank\", {\n        get: function () {\n            return this.shape.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    TensorBuffer.prototype.toTensor = function () {\n        return Tensor.make(this.shape, { values: this.values }, this.dtype);\n    };\n    return TensorBuffer;\n}());\nexports.TensorBuffer = TensorBuffer;\nvar trackerFn = null;\nvar opHandler = null;\nfunction setTensorTracker(fn) {\n    trackerFn = fn;\n}\nexports.setTensorTracker = setTensorTracker;\nfunction setOpHandler(handler) {\n    opHandler = handler;\n}\nexports.setOpHandler = setOpHandler;\nvar Tensor = (function () {\n    function Tensor(shape, dtype, values, dataId) {\n        this.isDisposedInternal = false;\n        this.shape = shape.slice();\n        this.dtype = dtype || 'float32';\n        this.size = util.sizeFromShape(shape);\n        this.strides = util_1.computeStrides(shape);\n        this.dataId = dataId != null ? dataId : {};\n        this.id = trackerFn().nextTensorId();\n        this.rankType = (this.rank < 5 ? this.rank.toString() : 'higher');\n        trackerFn().registerTensor(this);\n        if (values != null) {\n            trackerFn().write(this.dataId, values);\n        }\n    }\n    Tensor.make = function (shape, data, dtype) {\n        return new Tensor(shape, dtype, data.values, data.dataId);\n    };\n    Tensor.prototype.flatten = function () {\n        this.throwIfDisposed();\n        return this.as1D();\n    };\n    Tensor.prototype.asScalar = function () {\n        this.throwIfDisposed();\n        util.assert(this.size === 1, 'The array must have only 1 element.');\n        return this.reshape([]);\n    };\n    Tensor.prototype.as1D = function () {\n        this.throwIfDisposed();\n        return this.reshape([this.size]);\n    };\n    Tensor.prototype.as2D = function (rows, columns) {\n        this.throwIfDisposed();\n        return this.reshape([rows, columns]);\n    };\n    Tensor.prototype.as3D = function (rows, columns, depth) {\n        this.throwIfDisposed();\n        return this.reshape([rows, columns, depth]);\n    };\n    Tensor.prototype.as4D = function (rows, columns, depth, depth2) {\n        this.throwIfDisposed();\n        return this.reshape([rows, columns, depth, depth2]);\n    };\n    Tensor.prototype.as5D = function (rows, columns, depth, depth2, depth3) {\n        this.throwIfDisposed();\n        return this.reshape([rows, columns, depth, depth2, depth3]);\n    };\n    Tensor.prototype.asType = function (dtype) {\n        this.throwIfDisposed();\n        return opHandler.cast(this, dtype);\n    };\n    Object.defineProperty(Tensor.prototype, \"rank\", {\n        get: function () {\n            return this.shape.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Tensor.prototype.get = function () {\n        var locs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            locs[_i] = arguments[_i];\n        }\n        util.assert(locs.length === this.rank, 'Number of coordinates in get() must match the rank of the tensor');\n        util.assert(this.dtype !== 'complex64', 'Tensor.get() is not supported for complex64 tensors yet.');\n        this.throwIfDisposed();\n        if (locs.length === 0) {\n            locs = [0];\n        }\n        var index = locs[locs.length - 1];\n        for (var i = 0; i < locs.length - 1; ++i) {\n            index += this.strides[i] * locs[i];\n        }\n        return this.dataSync()[index];\n    };\n    Tensor.prototype.buffer = function () {\n        return opHandler.buffer(this.shape, this.dtype, this.dataSync());\n    };\n    Tensor.prototype.data = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                this.throwIfDisposed();\n                return [2, trackerFn().read(this.dataId)];\n            });\n        });\n    };\n    Tensor.prototype.dataSync = function () {\n        this.throwIfDisposed();\n        return trackerFn().readSync(this.dataId);\n    };\n    Tensor.prototype.dispose = function () {\n        if (this.isDisposed) {\n            return;\n        }\n        trackerFn().disposeTensor(this);\n        this.isDisposedInternal = true;\n    };\n    Object.defineProperty(Tensor.prototype, \"isDisposed\", {\n        get: function () {\n            return this.isDisposedInternal;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Tensor.prototype.throwIfDisposed = function () {\n        if (this.isDisposed) {\n            throw new Error(\"Tensor is disposed.\");\n        }\n    };\n    Tensor.prototype.toFloat = function () {\n        return this.asType('float32');\n    };\n    Tensor.prototype.toInt = function () {\n        return this.asType('int32');\n    };\n    Tensor.prototype.toBool = function () {\n        return this.asType('bool');\n    };\n    Tensor.prototype.print = function (verbose) {\n        if (verbose === void 0) { verbose = false; }\n        return opHandler.print(this, verbose);\n    };\n    Tensor.prototype.reshape = function (newShape) {\n        this.throwIfDisposed();\n        return opHandler.reshape(this, newShape);\n    };\n    Tensor.prototype.reshapeAs = function (x) {\n        this.throwIfDisposed();\n        return this.reshape(x.shape);\n    };\n    Tensor.prototype.expandDims = function (axis) {\n        if (axis === void 0) { axis = 0; }\n        return opHandler.expandDims(this, axis);\n    };\n    Tensor.prototype.cumsum = function (axis, exclusive, reverse) {\n        if (axis === void 0) { axis = 0; }\n        if (exclusive === void 0) { exclusive = false; }\n        if (reverse === void 0) { reverse = false; }\n        return opHandler.cumsum(this, axis, exclusive, reverse);\n    };\n    Tensor.prototype.squeeze = function (axis) {\n        this.throwIfDisposed();\n        return opHandler.squeeze(this, axis);\n    };\n    Tensor.prototype.clone = function () {\n        this.throwIfDisposed();\n        return opHandler.clone(this);\n    };\n    Tensor.prototype.toString = function (verbose) {\n        if (verbose === void 0) { verbose = false; }\n        var vals = this.dataSync();\n        return tensor_format_1.tensorToString(vals, this.shape, this.dtype, verbose);\n    };\n    Tensor.prototype.tile = function (reps) {\n        this.throwIfDisposed();\n        return opHandler.tile(this, reps);\n    };\n    Tensor.prototype.gather = function (indices, axis) {\n        if (axis === void 0) { axis = 0; }\n        this.throwIfDisposed();\n        return opHandler.gather(this, indices, axis);\n    };\n    Tensor.prototype.matMul = function (b, transposeA, transposeB) {\n        if (transposeA === void 0) { transposeA = false; }\n        if (transposeB === void 0) { transposeB = false; }\n        this.throwIfDisposed();\n        return opHandler.matMul(this, b, transposeA, transposeB);\n    };\n    Tensor.prototype.dot = function (b) {\n        this.throwIfDisposed();\n        return opHandler.dot(this, b);\n    };\n    Tensor.prototype.norm = function (ord, axis, keepDims) {\n        if (ord === void 0) { ord = 'euclidean'; }\n        if (axis === void 0) { axis = null; }\n        if (keepDims === void 0) { keepDims = false; }\n        this.throwIfDisposed();\n        return opHandler.norm(this, ord, axis, keepDims);\n    };\n    Tensor.prototype.slice = function (begin, size) {\n        this.throwIfDisposed();\n        return opHandler.slice(this, begin, size);\n    };\n    Tensor.prototype.reverse = function (axis) {\n        this.throwIfDisposed();\n        return opHandler.reverse(this, axis);\n    };\n    Tensor.prototype.concat = function (x, axis) {\n        if (axis === void 0) { axis = 0; }\n        this.throwIfDisposed();\n        if (x instanceof Tensor) {\n            x = [x];\n        }\n        return opHandler.concat([this].concat(x), axis);\n    };\n    Tensor.prototype.split = function (numOrSizeSplits, axis) {\n        if (axis === void 0) { axis = 0; }\n        this.throwIfDisposed();\n        return opHandler.split(this, numOrSizeSplits, axis);\n    };\n    Tensor.prototype.stack = function (x, axis) {\n        if (axis === void 0) { axis = 0; }\n        return opHandler.stack([this, x], axis);\n    };\n    Tensor.prototype.unstack = function (x, axis) {\n        if (axis === void 0) { axis = 0; }\n        return opHandler.unstack(this, axis);\n    };\n    Tensor.prototype.pad = function (paddings, constantValue) {\n        if (constantValue === void 0) { constantValue = 0; }\n        return opHandler.pad(this, paddings, constantValue);\n    };\n    Tensor.prototype.batchNormalization = function (mean, variance, varianceEpsilon, scale, offset) {\n        if (varianceEpsilon === void 0) { varianceEpsilon = .001; }\n        this.throwIfDisposed();\n        return opHandler.batchNormalization(this, mean, variance, varianceEpsilon, scale, offset);\n    };\n    Tensor.prototype.all = function (axis, keepDims) {\n        if (axis === void 0) { axis = null; }\n        if (keepDims === void 0) { keepDims = false; }\n        this.throwIfDisposed();\n        return opHandler.all(this, axis, keepDims);\n    };\n    Tensor.prototype.any = function (axis, keepDims) {\n        if (axis === void 0) { axis = null; }\n        if (keepDims === void 0) { keepDims = false; }\n        this.throwIfDisposed();\n        return opHandler.any(this, axis, keepDims);\n    };\n    Tensor.prototype.logSumExp = function (axis, keepDims) {\n        if (axis === void 0) { axis = null; }\n        if (keepDims === void 0) { keepDims = false; }\n        this.throwIfDisposed();\n        return opHandler.logSumExp(this, axis, keepDims);\n    };\n    Tensor.prototype.sum = function (axis, keepDims) {\n        if (axis === void 0) { axis = null; }\n        if (keepDims === void 0) { keepDims = false; }\n        this.throwIfDisposed();\n        return opHandler.sum(this, axis, keepDims);\n    };\n    Tensor.prototype.prod = function (axis, keepDims) {\n        if (axis === void 0) { axis = null; }\n        if (keepDims === void 0) { keepDims = false; }\n        this.throwIfDisposed();\n        return opHandler.prod(this, axis, keepDims);\n    };\n    Tensor.prototype.mean = function (axis, keepDims) {\n        if (axis === void 0) { axis = null; }\n        if (keepDims === void 0) { keepDims = false; }\n        this.throwIfDisposed();\n        return opHandler.mean(this, axis, keepDims);\n    };\n    Tensor.prototype.min = function (axis, keepDims) {\n        if (axis === void 0) { axis = null; }\n        if (keepDims === void 0) { keepDims = false; }\n        this.throwIfDisposed();\n        return opHandler.min(this, axis, keepDims);\n    };\n    Tensor.prototype.max = function (axis, keepDims) {\n        if (axis === void 0) { axis = null; }\n        if (keepDims === void 0) { keepDims = false; }\n        this.throwIfDisposed();\n        return opHandler.max(this, axis, keepDims);\n    };\n    Tensor.prototype.argMin = function (axis) {\n        if (axis === void 0) { axis = null; }\n        this.throwIfDisposed();\n        return opHandler.argMin(this, axis);\n    };\n    Tensor.prototype.argMax = function (axis) {\n        if (axis === void 0) { axis = null; }\n        this.throwIfDisposed();\n        return opHandler.argMax(this, axis);\n    };\n    Tensor.prototype.cast = function (dtype) {\n        this.throwIfDisposed();\n        return opHandler.cast(this, dtype);\n    };\n    Tensor.prototype.add = function (x) {\n        this.throwIfDisposed();\n        return opHandler.add(this, x);\n    };\n    Tensor.prototype.addStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.addStrict(this, x);\n    };\n    Tensor.prototype.atan2 = function (x) {\n        this.throwIfDisposed();\n        return opHandler.atan2(this, x);\n    };\n    Tensor.prototype.sub = function (x) {\n        this.throwIfDisposed();\n        return opHandler.sub(this, x);\n    };\n    Tensor.prototype.subStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.subStrict(this, x);\n    };\n    Tensor.prototype.pow = function (exp) {\n        this.throwIfDisposed();\n        return opHandler.pow(this, exp);\n    };\n    Tensor.prototype.powStrict = function (exp) {\n        this.throwIfDisposed();\n        return opHandler.powStrict(this, exp);\n    };\n    Tensor.prototype.mul = function (x) {\n        this.throwIfDisposed();\n        return opHandler.mul(this, x);\n    };\n    Tensor.prototype.mulStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.mulStrict(this, x);\n    };\n    Tensor.prototype.div = function (x) {\n        this.throwIfDisposed();\n        return opHandler.div(this, x);\n    };\n    Tensor.prototype.floorDiv = function (x) {\n        this.throwIfDisposed();\n        return opHandler.floorDiv(this, x);\n    };\n    Tensor.prototype.divStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.divStrict(this, x);\n    };\n    Tensor.prototype.minimum = function (x) {\n        this.throwIfDisposed();\n        return opHandler.minimum(this, x);\n    };\n    Tensor.prototype.minimumStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.minimumStrict(this, x);\n    };\n    Tensor.prototype.maximum = function (x) {\n        this.throwIfDisposed();\n        return opHandler.maximum(this, x);\n    };\n    Tensor.prototype.maximumStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.maximumStrict(this, x);\n    };\n    Tensor.prototype.mod = function (x) {\n        this.throwIfDisposed();\n        return opHandler.mod(this, x);\n    };\n    Tensor.prototype.modStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.modStrict(this, x);\n    };\n    Tensor.prototype.squaredDifference = function (x) {\n        this.throwIfDisposed();\n        return opHandler.squaredDifference(this, x);\n    };\n    Tensor.prototype.squaredDifferenceStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.squaredDifferenceStrict(this, x);\n    };\n    Tensor.prototype.transpose = function (perm) {\n        this.throwIfDisposed();\n        return opHandler.transpose(this, perm);\n    };\n    Tensor.prototype.notEqual = function (x) {\n        this.throwIfDisposed();\n        return opHandler.notEqual(this, x);\n    };\n    Tensor.prototype.notEqualStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.notEqualStrict(this, x);\n    };\n    Tensor.prototype.less = function (x) {\n        this.throwIfDisposed();\n        return opHandler.less(this, x);\n    };\n    Tensor.prototype.lessStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.lessStrict(this, x);\n    };\n    Tensor.prototype.equal = function (x) {\n        this.throwIfDisposed();\n        return opHandler.equal(this, x);\n    };\n    Tensor.prototype.equalStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.equalStrict(this, x);\n    };\n    Tensor.prototype.lessEqual = function (x) {\n        this.throwIfDisposed();\n        return opHandler.lessEqual(this, x);\n    };\n    Tensor.prototype.lessEqualStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.lessEqualStrict(this, x);\n    };\n    Tensor.prototype.greater = function (x) {\n        this.throwIfDisposed();\n        return opHandler.greater(this, x);\n    };\n    Tensor.prototype.greaterStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.greaterStrict(this, x);\n    };\n    Tensor.prototype.greaterEqual = function (x) {\n        this.throwIfDisposed();\n        return opHandler.greaterEqual(this, x);\n    };\n    Tensor.prototype.greaterEqualStrict = function (x) {\n        this.throwIfDisposed();\n        return opHandler.greaterEqualStrict(this, x);\n    };\n    Tensor.prototype.logicalAnd = function (x) {\n        this.throwIfDisposed();\n        return opHandler.logicalAnd(this, x);\n    };\n    Tensor.prototype.logicalOr = function (x) {\n        this.throwIfDisposed();\n        return opHandler.logicalOr(this, x);\n    };\n    Tensor.prototype.logicalNot = function () {\n        this.throwIfDisposed();\n        return opHandler.logicalNot(this);\n    };\n    Tensor.prototype.logicalXor = function (x) {\n        this.throwIfDisposed();\n        return opHandler.logicalXor(this, x);\n    };\n    Tensor.prototype.where = function (condition, x) {\n        this.throwIfDisposed();\n        return opHandler.where(condition, this, x);\n    };\n    Tensor.prototype.neg = function () {\n        this.throwIfDisposed();\n        return opHandler.neg(this);\n    };\n    Tensor.prototype.ceil = function () {\n        this.throwIfDisposed();\n        return opHandler.ceil(this);\n    };\n    Tensor.prototype.floor = function () {\n        this.throwIfDisposed();\n        return opHandler.floor(this);\n    };\n    Tensor.prototype.sign = function () {\n        this.throwIfDisposed();\n        return opHandler.sign(this);\n    };\n    Tensor.prototype.exp = function () {\n        this.throwIfDisposed();\n        return opHandler.exp(this);\n    };\n    Tensor.prototype.expm1 = function () {\n        this.throwIfDisposed();\n        return opHandler.expm1(this);\n    };\n    Tensor.prototype.log = function () {\n        this.throwIfDisposed();\n        return opHandler.log(this);\n    };\n    Tensor.prototype.log1p = function () {\n        this.throwIfDisposed();\n        return opHandler.log1p(this);\n    };\n    Tensor.prototype.sqrt = function () {\n        this.throwIfDisposed();\n        return opHandler.sqrt(this);\n    };\n    Tensor.prototype.rsqrt = function () {\n        this.throwIfDisposed();\n        return opHandler.rsqrt(this);\n    };\n    Tensor.prototype.square = function () {\n        this.throwIfDisposed();\n        return opHandler.square(this);\n    };\n    Tensor.prototype.reciprocal = function () {\n        this.throwIfDisposed();\n        return opHandler.reciprocal(this);\n    };\n    Tensor.prototype.abs = function () {\n        this.throwIfDisposed();\n        return opHandler.abs(this);\n    };\n    Tensor.prototype.clipByValue = function (min, max) {\n        this.throwIfDisposed();\n        return opHandler.clipByValue(this, min, max);\n    };\n    Tensor.prototype.relu = function () {\n        this.throwIfDisposed();\n        return opHandler.relu(this);\n    };\n    Tensor.prototype.elu = function () {\n        this.throwIfDisposed();\n        return opHandler.elu(this);\n    };\n    Tensor.prototype.selu = function () {\n        this.throwIfDisposed();\n        return opHandler.selu(this);\n    };\n    Tensor.prototype.leakyRelu = function (alpha) {\n        if (alpha === void 0) { alpha = 0.2; }\n        this.throwIfDisposed();\n        return opHandler.leakyRelu(this, alpha);\n    };\n    Tensor.prototype.prelu = function (alpha) {\n        this.throwIfDisposed();\n        return opHandler.prelu(this, alpha);\n    };\n    Tensor.prototype.sigmoid = function () {\n        this.throwIfDisposed();\n        return opHandler.sigmoid(this);\n    };\n    Tensor.prototype.logSigmoid = function () {\n        this.throwIfDisposed();\n        return opHandler.logSigmoid(this);\n    };\n    Tensor.prototype.softplus = function () {\n        this.throwIfDisposed();\n        return opHandler.softplus(this);\n    };\n    Tensor.prototype.zerosLike = function () {\n        this.throwIfDisposed();\n        return opHandler.zerosLike(this);\n    };\n    Tensor.prototype.onesLike = function () {\n        this.throwIfDisposed();\n        return opHandler.onesLike(this);\n    };\n    Tensor.prototype.sin = function () {\n        this.throwIfDisposed();\n        return opHandler.sin(this);\n    };\n    Tensor.prototype.cos = function () {\n        this.throwIfDisposed();\n        return opHandler.cos(this);\n    };\n    Tensor.prototype.tan = function () {\n        this.throwIfDisposed();\n        return opHandler.tan(this);\n    };\n    Tensor.prototype.asin = function () {\n        this.throwIfDisposed();\n        return opHandler.asin(this);\n    };\n    Tensor.prototype.acos = function () {\n        this.throwIfDisposed();\n        return opHandler.acos(this);\n    };\n    Tensor.prototype.atan = function () {\n        this.throwIfDisposed();\n        return opHandler.atan(this);\n    };\n    Tensor.prototype.sinh = function () {\n        this.throwIfDisposed();\n        return opHandler.sinh(this);\n    };\n    Tensor.prototype.cosh = function () {\n        this.throwIfDisposed();\n        return opHandler.cosh(this);\n    };\n    Tensor.prototype.tanh = function () {\n        this.throwIfDisposed();\n        return opHandler.tanh(this);\n    };\n    Tensor.prototype.asinh = function () {\n        this.throwIfDisposed();\n        return opHandler.asinh(this);\n    };\n    Tensor.prototype.acosh = function () {\n        this.throwIfDisposed();\n        return opHandler.acosh(this);\n    };\n    Tensor.prototype.atanh = function () {\n        this.throwIfDisposed();\n        return opHandler.atanh(this);\n    };\n    Tensor.prototype.erf = function () {\n        this.throwIfDisposed();\n        return opHandler.erf(this);\n    };\n    Tensor.prototype.round = function () {\n        this.throwIfDisposed();\n        return opHandler.round(this);\n    };\n    Tensor.prototype.step = function (alpha) {\n        if (alpha === void 0) { alpha = 0.0; }\n        this.throwIfDisposed();\n        return opHandler.step(this, alpha);\n    };\n    Tensor.prototype.softmax = function (dim) {\n        if (dim === void 0) { dim = -1; }\n        this.throwIfDisposed();\n        return opHandler.softmax(this, dim);\n    };\n    Tensor.prototype.logSoftmax = function (axis) {\n        if (axis === void 0) { axis = -1; }\n        this.throwIfDisposed();\n        return opHandler.logSoftmax(this, axis);\n    };\n    Tensor.prototype.resizeBilinear = function (newShape2D, alignCorners) {\n        if (alignCorners === void 0) { alignCorners = false; }\n        this.throwIfDisposed();\n        return opHandler.image.resizeBilinear(this, newShape2D, alignCorners);\n    };\n    Tensor.prototype.resizeNearestNeighbor = function (newShape2D, alignCorners) {\n        if (alignCorners === void 0) { alignCorners = false; }\n        this.throwIfDisposed();\n        return opHandler.image.resizeNearestNeighbor(this, newShape2D, alignCorners);\n    };\n    Tensor.prototype.conv1d = function (filter, stride, pad, dataFormat, dilation, dimRoundingMode) {\n        if (dataFormat === void 0) { dataFormat = 'NWC'; }\n        if (dilation === void 0) { dilation = 1; }\n        this.throwIfDisposed();\n        return opHandler.conv1d(this, filter, stride, pad, dataFormat, dilation, dimRoundingMode);\n    };\n    Tensor.prototype.conv2d = function (filter, strides, pad, dataFormat, dilations, dimRoundingMode) {\n        if (dataFormat === void 0) { dataFormat = 'NHWC'; }\n        if (dilations === void 0) { dilations = [1, 1]; }\n        this.throwIfDisposed();\n        return opHandler.conv2d(this, filter, strides, pad, dataFormat, dilations, dimRoundingMode);\n    };\n    Tensor.prototype.conv2dTranspose = function (filter, outputShape, strides, pad, dimRoundingMode) {\n        this.throwIfDisposed();\n        return opHandler.conv2dTranspose(this, filter, outputShape, strides, pad, dimRoundingMode);\n    };\n    Tensor.prototype.depthwiseConv2D = function (filter, strides, pad, dataFormat, dilations, dimRoundingMode) {\n        if (dataFormat === void 0) { dataFormat = 'NHWC'; }\n        if (dilations === void 0) { dilations = [1, 1]; }\n        this.throwIfDisposed();\n        return opHandler.depthwiseConv2d(this, filter, strides, pad, dataFormat, dilations, dimRoundingMode);\n    };\n    Tensor.prototype.separableConv2d = function (depthwiseFilter, pointwiseFilter, strides, pad, dilation, dataFormat) {\n        if (dilation === void 0) { dilation = [1, 1]; }\n        if (dataFormat === void 0) { dataFormat = 'NHWC'; }\n        this.throwIfDisposed();\n        return opHandler.separableConv2d(this, depthwiseFilter, pointwiseFilter, strides, pad, dilation, dataFormat);\n    };\n    Tensor.prototype.avgPool = function (filterSize, strides, pad, dimRoundingMode) {\n        this.throwIfDisposed();\n        return opHandler.avgPool(this, filterSize, strides, pad, dimRoundingMode);\n    };\n    Tensor.prototype.maxPool = function (filterSize, strides, pad, dimRoundingMode) {\n        this.throwIfDisposed();\n        return opHandler.maxPool(this, filterSize, strides, pad, dimRoundingMode);\n    };\n    Tensor.prototype.localResponseNormalization = function (radius, bias, alpha, beta) {\n        if (radius === void 0) { radius = 5; }\n        if (bias === void 0) { bias = 1; }\n        if (alpha === void 0) { alpha = 1; }\n        if (beta === void 0) { beta = 0.5; }\n        return opHandler.localResponseNormalization(this, radius, bias, alpha, beta);\n    };\n    Tensor.prototype.pool = function (windowShape, poolingType, padding, dilationRate, strides) {\n        this.throwIfDisposed();\n        return opHandler.pool(this, windowShape, poolingType, padding, dilationRate, strides);\n    };\n    Tensor.prototype.variable = function (trainable, name, dtype) {\n        if (trainable === void 0) { trainable = true; }\n        this.throwIfDisposed();\n        return Variable.variable(this, trainable, name, dtype);\n    };\n    Tensor.prototype.unsortedSegmentSum = function (segmentIds, numSegments) {\n        this.throwIfDisposed();\n        return opHandler.unsortedSegmentSum(this, segmentIds, numSegments);\n    };\n    Tensor.prototype.batchToSpaceND = function (blockShape, crops) {\n        this.throwIfDisposed();\n        return opHandler.batchToSpaceND(this, blockShape, crops);\n    };\n    Tensor.prototype.spaceToBatchND = function (blockShape, paddings) {\n        this.throwIfDisposed();\n        return opHandler.spaceToBatchND(this, blockShape, paddings);\n    };\n    Tensor.prototype.topk = function (k, sorted) {\n        if (k === void 0) { k = 1; }\n        if (sorted === void 0) { sorted = true; }\n        this.throwIfDisposed();\n        return opHandler.topk(this, k, sorted);\n    };\n    Tensor.prototype.stridedSlice = function (begin, end, strides, beginMask, endMask) {\n        if (beginMask === void 0) { beginMask = 0; }\n        if (endMask === void 0) { endMask = 0; }\n        this.throwIfDisposed();\n        return opHandler.stridedSlice(this, begin, end, strides, beginMask, endMask);\n    };\n    Tensor.prototype.depthToSpace = function (blockSize, dataFormat) {\n        this.throwIfDisposed();\n        return opHandler.depthToSpace(this, blockSize, dataFormat);\n    };\n    Tensor.prototype.fft = function () {\n        this.throwIfDisposed();\n        return opHandler.spectral.fft(this);\n    };\n    Tensor.prototype.ifft = function () {\n        this.throwIfDisposed();\n        return opHandler.spectral.ifft(this);\n    };\n    return Tensor;\n}());\nexports.Tensor = Tensor;\nObject.defineProperty(Tensor, Symbol.hasInstance, {\n    value: function (instance) {\n        return !!instance && instance.shape != null && instance.dtype != null;\n    }\n});\nvar Variable = (function (_super) {\n    __extends(Variable, _super);\n    function Variable(initialValue, trainable, name) {\n        if (trainable === void 0) { trainable = true; }\n        var _this = _super.call(this, initialValue.shape, initialValue.dtype, null, initialValue.dataId) || this;\n        _this.trainable = trainable;\n        _this.name = name;\n        if (_this.name == null) {\n            _this.name = trackerFn().nextVariableId().toString();\n        }\n        try {\n            trackerFn().registerVariable(_this);\n        }\n        catch (ex) {\n            trackerFn().disposeTensor(_this);\n            throw ex;\n        }\n        return _this;\n    }\n    Variable.variable = function (initialValue, trainable, name, dtype) {\n        if (trainable === void 0) { trainable = true; }\n        if (dtype != null && dtype !== initialValue.dtype) {\n            initialValue = initialValue.asType(dtype);\n        }\n        return new Variable(initialValue, trainable, name);\n    };\n    Variable.prototype.assign = function (newValue) {\n        if (newValue.dtype !== this.dtype) {\n            throw new Error(\"dtype of the new value (\" + newValue.dtype + \") and \" +\n                (\"previous value (\" + this.dtype + \") must match\"));\n        }\n        if (!util.arraysEqual(newValue.shape, this.shape)) {\n            throw new Error(\"shape of the new value (\" + newValue.shape + \") and \" +\n                (\"previous value (\" + this.shape + \") must match\"));\n        }\n        trackerFn().disposeTensor(this);\n        this.dataId = newValue.dataId;\n        trackerFn().registerTensor(this);\n    };\n    return Variable;\n}(Tensor));\nexports.Variable = Variable;\nObject.defineProperty(Variable, Symbol.hasInstance, {\n    value: function (instance) {\n        return instance instanceof Tensor && instance.assign != null &&\n            instance.assign instanceof Function;\n    }\n});\nvar variable = Variable.variable;\nexports.variable = variable;\n//# sourceMappingURL=tensor.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Rank;\n(function (Rank) {\n    Rank[\"R0\"] = \"R0\";\n    Rank[\"R1\"] = \"R1\";\n    Rank[\"R2\"] = \"R2\";\n    Rank[\"R3\"] = \"R3\";\n    Rank[\"R4\"] = \"R4\";\n    Rank[\"R5\"] = \"R5\";\n    Rank[\"R6\"] = \"R6\";\n})(Rank = exports.Rank || (exports.Rank = {}));\nvar UpcastInt32AndMap;\n(function (UpcastInt32AndMap) {\n    UpcastInt32AndMap[\"float32\"] = \"float32\";\n    UpcastInt32AndMap[\"int32\"] = \"int32\";\n    UpcastInt32AndMap[\"bool\"] = \"int32\";\n    UpcastInt32AndMap[\"complex64\"] = \"complex64\";\n})(UpcastInt32AndMap || (UpcastInt32AndMap = {}));\nvar UpcastBoolAndMap;\n(function (UpcastBoolAndMap) {\n    UpcastBoolAndMap[\"float32\"] = \"float32\";\n    UpcastBoolAndMap[\"int32\"] = \"int32\";\n    UpcastBoolAndMap[\"bool\"] = \"bool\";\n    UpcastBoolAndMap[\"complex64\"] = \"complex64\";\n})(UpcastBoolAndMap || (UpcastBoolAndMap = {}));\nvar UpcastFloat32AndMap;\n(function (UpcastFloat32AndMap) {\n    UpcastFloat32AndMap[\"float32\"] = \"float32\";\n    UpcastFloat32AndMap[\"int32\"] = \"float32\";\n    UpcastFloat32AndMap[\"bool\"] = \"float32\";\n    UpcastFloat32AndMap[\"complex64\"] = \"complex64\";\n})(UpcastFloat32AndMap || (UpcastFloat32AndMap = {}));\nvar UpcastComplex64AndMap;\n(function (UpcastComplex64AndMap) {\n    UpcastComplex64AndMap[\"float32\"] = \"complex64\";\n    UpcastComplex64AndMap[\"int32\"] = \"complex64\";\n    UpcastComplex64AndMap[\"bool\"] = \"complex64\";\n    UpcastComplex64AndMap[\"complex64\"] = \"complex64\";\n})(UpcastComplex64AndMap || (UpcastComplex64AndMap = {}));\nvar upcastTypeMap = {\n    'float32': UpcastFloat32AndMap,\n    'int32': UpcastInt32AndMap,\n    'bool': UpcastBoolAndMap,\n    'complex64': UpcastComplex64AndMap\n};\nfunction upcastType(typeA, typeB) {\n    if (typeA === 'string' || typeB === 'string') {\n        if (typeA === 'string' && typeB === 'string') {\n            return 'string';\n        }\n        throw new Error(\"Can not upcast \" + typeA + \" with \" + typeB);\n    }\n    return upcastTypeMap[typeA][typeB];\n}\nexports.upcastType = upcastType;\nfunction sumOutType(type) {\n    return upcastType(type, 'int32');\n}\nexports.sumOutType = sumOutType;\n//# sourceMappingURL=types.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tensor_1 = require(\"./tensor\");\nvar types_1 = require(\"./types\");\nvar util_1 = require(\"./util\");\nfunction makeTypesMatch(a, b) {\n    if (a.dtype === b.dtype) {\n        return [a, b];\n    }\n    var dtype = types_1.upcastType(a.dtype, b.dtype);\n    return [a.cast(dtype), b.cast(dtype)];\n}\nexports.makeTypesMatch = makeTypesMatch;\nfunction assertTypesMatch(a, b) {\n    util_1.assert(a.dtype === b.dtype, \"The dtypes of the first(\" + a.dtype + \") and\" +\n        (\" second(\" + b.dtype + \") input must match\"));\n}\nexports.assertTypesMatch = assertTypesMatch;\nfunction isTensorInList(tensor, tensorList) {\n    for (var i = 0; i < tensorList.length; i++) {\n        if (tensorList[i].id === tensor.id) {\n            return true;\n        }\n    }\n    return false;\n}\nexports.isTensorInList = isTensorInList;\nfunction flattenNameArrayMap(nameArrayMap, keys) {\n    var xs = [];\n    if (nameArrayMap instanceof tensor_1.Tensor) {\n        xs.push(nameArrayMap);\n    }\n    else {\n        var xMap = nameArrayMap;\n        for (var i = 0; i < keys.length; i++) {\n            xs.push(xMap[keys[i]]);\n        }\n    }\n    return xs;\n}\nexports.flattenNameArrayMap = flattenNameArrayMap;\nfunction unflattenToNameArrayMap(keys, flatArrays) {\n    if (keys.length !== flatArrays.length) {\n        throw new Error(\"Cannot unflatten Tensor[], keys and arrays are not of same length.\");\n    }\n    var result = {};\n    for (var i = 0; i < keys.length; i++) {\n        result[keys[i]] = flatArrays[i];\n    }\n    return result;\n}\nexports.unflattenToNameArrayMap = unflattenToNameArrayMap;\nfunction getTensorsInContainer(result) {\n    var list = [];\n    var seen = new Set();\n    walkTensorContainer(result, list, seen);\n    return list;\n}\nexports.getTensorsInContainer = getTensorsInContainer;\nfunction walkTensorContainer(container, list, seen) {\n    if (container == null) {\n        return;\n    }\n    if (container instanceof tensor_1.Tensor) {\n        list.push(container);\n        return;\n    }\n    if (!isIterable(container)) {\n        return;\n    }\n    var iterable = container;\n    for (var k in iterable) {\n        var val = iterable[k];\n        if (!seen.has(val)) {\n            seen.add(val);\n            walkTensorContainer(val, list, seen);\n        }\n    }\n}\nfunction isIterable(obj) {\n    return Array.isArray(obj) || typeof obj === 'object';\n}\n//# sourceMappingURL=tensor_util.js.map","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport * as tf from '@tensorflow/tfjs-core';\n\n// tslint:disable:no-any\n\n/**\n * A return value for a mapping function that can be applied via deepMap.\n *\n * If recurse is true, the value should be empty, and iteration will continue\n * into the object or array.\n */\nexport type DeepMapResult = {\n  value: any,\n  recurse: boolean\n};\n\n/**\n * Apply a mapping function to a nested structure in a recursive manner.\n *\n * The result of the mapping is an object with the same nested structure (i.e.,\n * of arrays and dicts) as the input, except that some subtrees are replaced,\n * according to the results of the mapping function.\n *\n * Mappings are memoized.  Thus, if the nested structure contains the same\n * object in multiple positions, the output will contain the same mapped object\n * in those positions.  Cycles are not supported, however.\n *\n * @param input: The object to which to apply the mapping function.\n * @param mapFn: A function that expects a single node of the object tree, and\n *   returns a `DeepMapResult`.  The `DeepMapResult` either provides a\n *   replacement value for that node (i.e., replacing the subtree), or indicates\n *   that the node should be processed recursively.\n */\nexport function deepMap(input: any, mapFn: (x: any) => DeepMapResult): any|\n    any[] {\n  return deepMapInternal(input, mapFn);\n}\n\n/**\n * @param seen: A Map of known object mappings (i.e., memoized results of\n *   `mapFn()`)\n * @param containedIn: An set containing objects on the reference path currently\n *   being processed (used to detect cycles).\n */\nfunction deepMapInternal(\n    input: any, mapFn: (x: any) => DeepMapResult,\n    seen: Map<any, any> = new Map(), containedIn: Set<{}> = new Set()): any|\n    any[] {\n  if (input == null) {\n    return null;\n  }\n  if (containedIn.has(input)) {\n    throw new Error('Circular references are not supported.');\n  }\n  if (seen.has(input)) {\n    return seen.get(input);\n  }\n  const result = mapFn(input);\n\n  if (result.recurse && result.value !== null) {\n    throw new Error(\n        'A deep map function may not return both a value and recurse=true.');\n  }\n\n  if (!result.recurse) {\n    seen.set(input, result.value);\n    return result.value;\n  } else if (isIterable(input)) {\n    // tslint:disable-next-line:no-any\n    const mappedIterable: any|any[] = Array.isArray(input) ? [] : {};\n    containedIn.add(input);\n    for (const k in input) {\n      const child = input[k];\n      const childResult = deepMapInternal(child, mapFn, seen, containedIn);\n      mappedIterable[k] = childResult;\n    }\n    containedIn.delete(input);\n    return mappedIterable;\n  } else {\n    throw new Error(`Can't recurse into non-iterable type: ${input}`);\n  }\n}\n\n// TODO(soergel, kangyizhang) Reconsider naming of deepZip() to avoid confusion\n// with zip()\n\n/**\n * Zip nested structures together in a recursive manner.\n *\n * This has the effect of transposing or pivoting data, e.g. converting it from\n * a row-major representation to a column-major representation.\n *\n * For example, `deepZip([{a: 1, b: 2}, {a: 3, b: 4}])` returns\n * `{a: [1, 3], b: [2, 4]}`.\n *\n * The inputs should all have the same nested structure (i.e., of arrays and\n * dicts).  The result is a single object with the same nested structure, where\n * the leaves are arrays collecting the values of the inputs at that location\n * (or, optionally, the result of a custom function applied to those arrays).\n *\n * @param inputs: An array of the objects to zip together.\n * @param zipFn: (optional) A function that expects an array of elements at a\n *   single node of the object tree, and returns a `DeepMapResult`.  The\n *   `DeepMapResult` either provides a result value for that node (i.e.,\n *   representing the subtree), or indicates that the node should be processed\n *   recursively.  The default zipFn recurses as far as possible and places\n *   arrays at the leaves.\n */\nexport function deepZip(\n    inputs: any[], zipFn: (xs: any[]) => DeepMapResult = zipToList): any|any[] {\n  return deepZipInternal(inputs, zipFn);\n}\n\n/**\n * @param containedIn: An set containing objects on the reference path currently\n *   being processed (used to detect cycles).\n */\nfunction deepZipInternal(\n    inputs: any[], zipFn: (xs: any[]) => DeepMapResult,\n    containedIn: Set<{}> = new Set()): any|any[] {\n  // The recursion follows the structure of input 0; it's assumed that all the\n  // other inputs have the same structure.\n  const input = inputs[0];\n  if (containedIn.has(input)) {\n    throw new Error('Circular references are not supported.');\n  }\n  const result = zipFn(inputs);\n\n  if (result.recurse && result.value !== null) {\n    throw new Error(\n        'A deep zip function may not return both a value and recurse=true.');\n  }\n\n  if (!result.recurse) {\n    return result.value;\n  } else if (isIterable(input)) {\n    // tslint:disable-next-line:no-any\n    const mappedIterable: any|any[] = Array.isArray(input) ? [] : {};\n    containedIn.add(input);\n    for (const k in input) {\n      const children = inputs.map(x => x[k]);\n      const childResult = deepZipInternal(children, zipFn, containedIn);\n      mappedIterable[k] = childResult;\n    }\n    containedIn.delete(input);\n    return mappedIterable;\n  } else {\n    throw new Error(`Can't recurse into non-iterable type: ${input}`);\n  }\n}\n\n// tslint:disable-next-line:no-any\nexport function zipToList(x: any[]): DeepMapResult {\n  if (x === null) {\n    return null;\n  }\n  // TODO(soergel): validate array type?\n\n  if (isIterable(x[0])) {\n    return {value: null, recurse: true};\n  } else {\n    return {value: x, recurse: false};\n  }\n}\n\n/**\n * A return value for an async map function for use with deepMapAndAwaitAll.\n *\n * If recurse is true, the value should be empty, and iteration will continue\n * into the object or array.\n */\nexport type DeepMapAsyncResult = {\n  value: Promise<any>,\n  recurse: boolean\n};\n\n/**\n * Apply an async mapping function to a nested structure in a recursive manner.\n *\n * This first creates a nested structure of Promises, and then awaits all of\n * those, resulting in a single Promise for a resolved nested structure.\n *\n * The result of the mapping is an object with the same nested structure (i.e.,\n * of arrays and dicts) as the input, except that some subtrees are replaced,\n * according to the results of the mapping function.\n *\n * Mappings are memoized.  Thus, if the nested structure contains the same\n * object in multiple positions, the output will contain the same mapped object\n * in those positions.  Cycles are not supported, however.\n *\n * @param input: The object to which to apply the mapping function.\n * @param mapFn: A function that expects a single node of the object tree, and\n *   returns a `DeepMapAsyncResult`.  The `DeepMapAsyncResult` either provides\n *   a `Promise` for a replacement value for that node (i.e., replacing the\n *   subtree), or indicates that the node should be processed recursively.  Note\n *   that the decision whether or not to recurse must be made immediately; only\n *   the mapped value may be promised.\n */\nexport async function deepMapAndAwaitAll(\n    input: any, mapFn: (x: any) => DeepMapAsyncResult): Promise<any|any[]> {\n  const seen: Map<any, Promise<any>> = new Map();\n\n  // First do a normal deepMap, collecting Promises in 'seen' as a side effect.\n  deepMapInternal(input, mapFn, seen);\n\n  // Replace the Promises in 'seen' in place.\n  // Note TypeScript provides no async map iteration, and regular map iteration\n  // is broken too, so sadly we have to do Array.from() to make it work.\n  // (There's no advantage to Promise.all(), and that would be tricky anyway.)\n  for (const key of Array.from(seen.keys())) {\n    const value = seen.get(key);\n    if (value instanceof Promise) {\n      const mappedValue = await value;\n      seen.set(key, mappedValue);\n    }\n  }\n\n  // Normal deepMap again, this time filling in the resolved values.\n  // It's unfortunate that we have to do two passes.\n  // TODO(soergel): test performance and think harder about a fast solution.\n  const result = deepMapInternal(input, mapFn, seen);\n  return result;\n}\n\n/**\n * Determine whether the argument is iterable.\n *\n * @returns true if the argument is an array or any non-Tensor object.\n */\n// tslint:disable-next-line:no-any\nexport function isIterable(obj: any): boolean {\n  return obj != null &&\n      (Array.isArray(obj) ||\n       (typeof obj === 'object' && !(obj instanceof tf.Tensor)));\n}\n\n/**\n * Determine whether the argument is an array of numbers.\n *\n * @returns true if the argument is an array and all of its children are\n *   numbers; false otherwise.\n */\n// tslint:disable-next-line:no-any\nexport function isNumericArray(obj: any): boolean {\n  if (obj == null) {\n    return false;\n  }\n  if (!Array.isArray(obj)) {\n    return false;\n  }\n  for (const k in obj) {\n    if (typeof obj[k] !== 'number') {\n      return false;\n    }\n  }\n  return true;\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\n/**\n * A ring buffer, providing O(1) FIFO, LIFO, and related operations.\n */\nexport class RingBuffer<T> {\n  // Note we store the indices in the range 0 <= index < 2*capacity.\n  // This allows us to distinguish the full from the empty case.\n  // See https://www.snellman.net/blog/archive/2016-12-13-ring-buffers/\n  protected begin = 0;  // inclusive\n  protected end = 0;    // exclusive\n  protected doubledCapacity: number;\n\n  protected data: T[];\n\n  /**\n   * Constructs a `RingBuffer`.\n   * @param capacity The number of items that the buffer can accomodate.\n   */\n  constructor(public capacity: number) {\n    if (capacity < 1) {\n      throw new RangeError('Can\\'t create ring buffer of capacity < 1.');\n    }\n    this.data = new Array<T>(capacity);\n    this.doubledCapacity = 2 * capacity;\n  }\n\n  /**\n   * Map any index into the range 0 <= index < 2*capacity.\n   */\n  protected wrap(index: number) {\n    // don't trust % on negative numbers\n    while (index < 0) {\n      index += this.doubledCapacity;\n    }\n    return index % this.doubledCapacity;\n  }\n\n  protected get(index: number) {\n    if (index < 0) {\n      throw new RangeError('Can\\'t get item at a negative index.');\n    }\n    return this.data[index % this.capacity];\n  }\n\n  protected set(index: number, value: T) {\n    if (index < 0) {\n      throw new RangeError('Can\\'t set item at a negative index.');\n    }\n    this.data[index % this.capacity] = value;\n  }\n\n  /**\n   * Returns the current number of items in the buffer.\n   */\n  length(): number {\n    let length = this.end - this.begin;\n    if (length < 0) {\n      length = this.doubledCapacity + length;\n    }\n    return length;\n  }\n\n  /**\n   * Reports whether the buffer is full.\n   * @returns true if the number of items in the buffer equals its capacity, and\n   *   false otherwise.\n   */\n  isFull() {\n    return this.length() === this.capacity;\n  }\n\n  /**\n   * Reports whether the buffer is empty.\n   * @returns true if the number of items in the buffer equals zero, and\n   *   false otherwise.\n   */\n  isEmpty() {\n    return this.length() === 0;\n  }\n\n  /**\n   * Adds an item to the end of the buffer.\n   */\n  push(value: T) {\n    if (this.isFull()) {\n      throw new RangeError('Ring buffer is full.');\n    }\n    this.set(this.end, value);\n    this.end = this.wrap(this.end + 1);\n  }\n\n  /**\n   * Adds many items to the end of the buffer, in order.\n   */\n  pushAll(values: T[]) {\n    for (const value of values) {\n      this.push(value);\n    }\n  }\n\n  /**\n   * Removes and returns the last item in the buffer.\n   */\n  pop(): T {\n    if (this.isEmpty()) {\n      throw new RangeError('Ring buffer is empty.');\n    }\n    this.end = this.wrap(this.end - 1);\n    const result = this.get(this.end);\n    this.set(this.end, undefined);\n    return result;\n  }\n\n  /**\n   * Adds an item to the beginning of the buffer.\n   */\n  unshift(value: T) {\n    if (this.isFull()) {\n      throw new RangeError('Ring buffer is full.');\n    }\n    this.begin = this.wrap(this.begin - 1);\n    this.set(this.begin, value);\n  }\n\n  /**\n   * Removes and returns the first item in the buffer.\n   */\n  shift(): T {\n    if (this.isEmpty()) {\n      throw new RangeError('Ring buffer is empty.');\n    }\n    const result = this.get(this.begin);\n    this.set(this.begin, undefined);\n    this.begin = this.wrap(this.begin + 1);\n    return result;\n  }\n\n  /**\n   * Removes and returns a specific item in the buffer, and moves the last item\n   * to the vacated slot.  This is useful for implementing a shuffling stream.\n   * Note that this operation necessarily scrambles the original order.\n   *\n   * @param relativeIndex: the index of the item to remove, relative to the\n   *   first item in the buffer (e.g., hiding the ring nature of the underlying\n   *   storage).\n   */\n  shuffleExcise(relativeIndex: number): T {\n    if (this.isEmpty()) {\n      throw new RangeError('Ring buffer is empty.');\n    }\n    const index = this.wrap(this.begin + relativeIndex);\n    const result = this.get(index);\n    this.set(index, this.pop());\n    return result;\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport {RingBuffer} from './ring_buffer';\n\nexport class GrowingRingBuffer<T> extends RingBuffer<T> {\n  private static INITIAL_CAPACITY = 32;\n\n  /**\n   * Constructs a `GrowingRingBuffer`.\n   */\n  constructor() {\n    super(GrowingRingBuffer.INITIAL_CAPACITY);\n  }\n\n  isFull() {\n    return false;\n  }\n\n  push(value: T) {\n    if (super.isFull()) {\n      this.expand();\n    }\n    super.push(value);\n  }\n\n  unshift(value: T) {\n    if (super.isFull()) {\n      this.expand();\n    }\n    super.unshift(value);\n  }\n\n  /**\n   * Doubles the capacity of the buffer.\n   */\n  private expand() {\n    const newCapacity = this.capacity * 2;\n    const newData = new Array<T>(newCapacity);\n    const len = this.length();\n\n    // Rotate the buffer to start at index 0 again, since we can't just\n    // allocate more space at the end.\n    for (let i = 0; i < len; i++) {\n      newData[i] = this.get(this.wrap(this.begin + i));\n    }\n\n    this.data = newData;\n    this.capacity = newCapacity;\n    this.doubledCapacity = 2 * this.capacity;\n    this.begin = 0;\n    this.end = len;\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport * as tf from '@tensorflow/tfjs-core';\nimport {getTensorsInContainer, isTensorInList} from '@tensorflow/tfjs-core/dist/tensor_util';\nimport * as seedrandom from 'seedrandom';\n\nimport {DataElement, IteratorContainer} from '../types';\nimport {deepMapAndAwaitAll, DeepMapAsyncResult, DeepMapResult, deepZip, zipToList} from '../util/deep_map';\nimport {GrowingRingBuffer} from '../util/growing_ring_buffer';\nimport {RingBuffer} from '../util/ring_buffer';\n\n// Here we implement a simple asynchronous iterator.\n// This lets us avoid using either third-party stream libraries or\n// recent TypeScript language support requiring polyfills.\n\n/**\n * Create a `LazyIterator` from an array of items.\n */\nexport function iteratorFromItems<T>(items: T[]): LazyIterator<T> {\n  return new ArrayIterator(items);\n}\n\n/**\n * Create a `LazyIterator` of incrementing integers.\n */\nexport function iteratorFromIncrementing(start: number): LazyIterator<number> {\n  let i = start;\n  return iteratorFromFunction(() => ({value: i++, done: false}));\n}\n\n/**\n * Create a `LazyIterator` from a function.\n */\nexport function iteratorFromFunction<T>(\n    func: () =>\n        IteratorResult<T>| Promise<IteratorResult<T>>): LazyIterator<T> {\n  return new FunctionCallIterator(func);\n}\n\n/**\n * Create a `LazyIterator` by concatenating underlying streams, which are\n * themselves provided as a stream.\n *\n * This can also be thought of as a \"stream flatten\" operation.\n *\n * @param baseIterators A stream of streams to be concatenated.\n * @param baseErrorHandler An optional function that can intercept `Error`s\n *   raised during a `next()` call on the base stream.  This function can decide\n *   whether the error should be propagated, whether the error should be\n *   ignored, or whether the base stream should be terminated.\n */\nexport function iteratorFromConcatenated<T>(\n    baseIterators: LazyIterator<LazyIterator<T>>,\n    baseErrorHandler?: (e: Error) => boolean): LazyIterator<T> {\n  return new ChainedIterator(baseIterators, baseErrorHandler);\n}\n\n/**\n * Create a `LazyIterator` by concatenating streams produced by calling a\n * stream-generating function a given number of times.\n *\n * Since a `LazyIterator` is read-once, it cannot be repeated, but this\n * function can be used to achieve a similar effect:\n *\n *   LazyIterator.ofConcatenatedFunction(() => new MyIterator(), 6);\n *\n * @param iteratorFunc: A function that produces a new stream on each call.\n * @param count: The number of times to call the function.\n * @param baseErrorHandler An optional function that can intercept `Error`s\n *   raised during a `next()` call on the base stream.  This function can decide\n *   whether the error should be propagated, whether the error should be\n *   ignored, or whether the base stream should be terminated.\n */\nexport function iteratorFromConcatenatedFunction<T>(\n    iteratorFunc: () => IteratorResult<LazyIterator<T>>, count: number,\n    baseErrorHandler?: (e: Error) => boolean): LazyIterator<T> {\n  return iteratorFromConcatenated(\n      iteratorFromFunction(iteratorFunc).take(count), baseErrorHandler);\n}\n\n/**\n * Create a `LazyIterator` by zipping together an array, dict, or nested\n * structure of `LazyIterator`s (and perhaps additional constants).\n *\n * The underlying streams must provide elements in a consistent order such\n * that they correspond.\n *\n * Typically, the underlying streams should have the same number of\n * elements. If they do not, the behavior is determined by the\n * `mismatchMode` argument.\n *\n * The nested structure of the `iterators` argument determines the\n * structure of elements in the resulting iterator.\n *\n * @param iterators: An array or object containing LazyIterators at the\n * leaves.\n * @param mismatchMode: Determines what to do when one underlying iterator\n * is exhausted before the others.  `ZipMismatchMode.FAIL` (the default)\n * causes an error to be thrown in this case.  `ZipMismatchMode.SHORTEST`\n * causes the zipped iterator to terminate with the furst underlying\n * streams, so elements remaining on the longer streams are ignored.\n * `ZipMismatchMode.LONGEST` causes the zipped stream to continue, filling\n * in nulls for the exhausted streams, until all streams are exhausted.\n */\nexport function iteratorFromZipped<O extends DataElement>(\n    iterators: IteratorContainer,\n    mismatchMode: ZipMismatchMode = ZipMismatchMode.FAIL): LazyIterator<O> {\n  return new ZipIterator<O>(iterators, mismatchMode);\n}\n\n/**\n * An asynchronous iterator, providing lazy access to a potentially\n * unbounded stream of elements.\n *\n * Iterator can be obtained from a dataset:\n * `const iter = await dataset.iterator();`\n */\nexport abstract class LazyIterator<T> {\n  // This class implements AsyncIterator<T>, but we have not yet set the\n  // TypeScript --downlevelIteration flag to enable that.\n\n  abstract summary(): string;\n\n  /**\n   * Returns a `Promise` for the next element in the stream.\n   *\n   * When an item can be provided successfully, the return value is\n   * `{value:T, done:false}`.\n   *\n   * Calling next() on a closed stream returns `{value:null, done:true}`.\n   */\n  abstract async next(): Promise<IteratorResult<T>>;\n\n  /**\n   * Collect all remaining elements of a bounded stream into an array.\n   * Obviously this will succeed only for small streams that fit in memory.\n   * Useful for testing.\n   *\n   * @param maxItems the maximum number of items to return.  If the stream\n   *   terminates, fewer items will be returned.  (default 1000)\n   * @param prefetch the size of the prefetch buffer to use when collecting\n   *   items.  Some amount of prefetch is important to test parallel streams,\n   *   i.e. with multiple Promises outstanding.  Without prefetch, this method\n   *   makes purely serial next() calls.\n   *\n   * @returns A Promise for an array of stream elements, which will resolve\n   *   when the stream is exhausted.\n   */\n  async collect(maxItems = 1000, prefetch = 100): Promise<T[]> {\n    const stream = prefetch > 0 ? this.prefetch(prefetch) : this;\n    const result: T[] = [];\n    let count = 0;\n    let x = await stream.next();\n    while (!x.done) {\n      result.push(x.value);\n      count++;\n      if (count >= maxItems) {\n        return result;\n      }\n      x = await stream.next();\n    }\n    return result;\n  }\n\n  /**\n   * Draw items from the stream until it is exhausted.\n   *\n   * This can be useful when the stream has side effects but no output.  In\n   * that case, calling this function guarantees that the stream will be\n   * fully processed.\n   */\n  async resolveFully(): Promise<void> {\n    let x = await this.next();\n    while (!x.done) {\n      x = await this.next();\n    }\n  }\n\n  /**\n   * Draw items from the stream until it is exhausted, or a predicate fails.\n   *\n   * This can be useful when the stream has side effects but no output.  In\n   * that case, calling this function guarantees that the stream will be\n   * fully processed.\n   */\n  async resolveWhile(predicate: (r: T) => boolean): Promise<void> {\n    let x = await this.next();\n    let shouldContinue = predicate(x.value);\n    while ((!x.done) && shouldContinue) {\n      x = await this.next();\n      shouldContinue = predicate(x.value);\n    }\n  }\n\n  /**\n   * Handles errors thrown on this stream using a provided handler function.\n   *\n   * @param handler A function that handles any `Error` thrown during a `next()`\n   *   call and returns true if the stream should continue (dropping the failed\n   *   call) or false if the stream should quietly terminate.  If the handler\n   *   itself throws (or rethrows) an `Error`, that will be propagated.\n   *\n   * @returns A `LazyIterator` of elements passed through from upstream,\n   *   possibly filtering or terminating on upstream `next()` calls that\n   *   throw an `Error`.\n   */\n  handleErrors(handler: (error: Error) => boolean): LazyIterator<T> {\n    return new ErrorHandlingLazyIterator(this, handler);\n  }\n\n  // TODO(soergel): Implement reduce() etc.\n\n  /**\n   * Filters this stream according to `predicate`.\n   *\n   * @param predicate A function mapping a stream element to a boolean or a\n   * `Promise` for one.\n   *\n   * @returns A `LazyIterator` of elements for which the predicate was true.\n   */\n  filter(predicate: (value: T) => boolean): LazyIterator<T> {\n    return new FilterIterator(this, predicate);\n  }\n\n  /**\n   * Maps this stream through a 1-to-1 transform.\n   *\n   * @param transform A function mapping a stream element to a transformed\n   *   element.\n   *\n   * @returns A `LazyIterator` of transformed elements.\n   */\n  map<O>(transform: (value: T) => O): LazyIterator<O> {\n    return new MapIterator(this, transform);\n  }\n\n  /**\n   * Maps this stream through an async 1-to-1 transform.\n   *\n   * @param transform A function mapping a stream element to a `Promise` for a\n   *   transformed stream element.\n   *\n   * @returns A `LazyIterator` of transformed elements.\n   */\n  mapAsync<O>(transform: (value: T) => Promise<O>): LazyIterator<O> {\n    return new AsyncMapIterator(this, transform);\n  }\n\n  /**\n   * Maps this stream through a 1-to-1 transform, forcing serial execution.\n   *\n   * @param transform A function mapping a stream element to a transformed\n   *   element.\n   *\n   * @returns A `LazyIterator` of transformed elements.\n   */\n  serialMapAsync<O>(transform: (value: T) => Promise<O>): LazyIterator<O> {\n    return new AsyncMapIterator(this, transform).serial();\n  }\n\n  /**\n   * Maps this stream through a 1-to-many transform.\n   *\n   * @param transform A function mapping a stream element to an array of\n   *   transformed elements.\n   *\n   * @returns A `DataStream` of transformed elements.\n   */\n  flatmap<O>(transform: (value: T) => O[]): LazyIterator<O> {\n    return new FlatmapIterator(this, transform);\n  }\n\n  /**\n   * Apply a function to every element of the stream.\n   *\n   * @param f A function to apply to each stream element.\n   */\n  async forEach(f: (value: T) => void): Promise<void> {\n    return this.map(f).resolveFully();\n  }\n\n  /**\n   * Apply a function to every element of the stream, forcing serial execution.\n   *\n   * @param f A function to apply to each stream element.  Should return 'true'\n   *   to indicate that the stream should continue, or 'false' to cause it to\n   *   terminate.\n   */\n  async serialForEach(f: (value: T) => Promise<boolean>): Promise<void> {\n    return this.serialMapAsync(f).resolveWhile(x => (x === true));\n  }\n\n  /**\n   * Groups elements into batches, represented as arrays of elements.\n   *\n   * We can think of the elements of this iterator as 'rows' (even if they are\n   * nested structures).  By the same token, consecutive values for a given\n   * key within the elements form a 'column'.  This matches the usual sense of\n   * 'row' and 'column' when processing tabular data (e.g., parsing a CSV).\n   *\n   * Thus, \"Row-major\" means that the resulting batch is simply a collection of\n   * rows: `[row1, row2, row3, ...]`.  This is contrast to the column-major\n   * form, which is needed for vectorized computation.\n   *\n   * @param batchSize The number of elements desired per batch.\n   * @param smallLastBatch Whether to emit the final batch when it has fewer\n   *   than batchSize elements. Default true.\n   * @returns A `LazyIterator` of batches of elements, represented as arrays\n   *   of the original element type.\n   */\n  rowMajorBatch(batchSize: number, smallLastBatch = true): LazyIterator<T[]> {\n    return new RowMajorBatchIterator(this, batchSize, smallLastBatch);\n  }\n\n  /**\n   * Groups elements into batches, represented in column-major form.\n   *\n   * We can think of the elements of this iterator as 'rows' (even if they are\n   * nested structures).  By the same token, consecutive values for a given\n   * key within the elements form a 'column'.  This matches the usual sense of\n   * 'row' and 'column' when processing tabular data (e.g., parsing a CSV).\n   *\n   * Thus, \"column-major\" means that the resulting batch is a (potentially\n   * nested) structure representing the columns.  Each column entry, then,\n   * contains a collection of the values found in that column for a range of\n   * input elements.  This representation allows for vectorized computation, in\n   * contrast to the row-major form.\n   *\n   * The inputs should all have the same nested structure (i.e., of arrays and\n   * dicts).  The result is a single object with the same nested structure,\n   * where the leaves are arrays collecting the values of the inputs at that\n   * location (or, optionally, the result of a custom function applied to those\n   * arrays).\n   *\n   * @param batchSize The number of elements desired per batch.\n   * @param smallLastBatch Whether to emit the final batch when it has fewer\n   *   than batchSize elements. Default true.\n   * @param zipFn: (optional) A function that expects an array of elements at a\n   *   single node of the object tree, and returns a `DeepMapResult`.  The\n   *   `DeepMapResult` either provides a result value for that node (i.e.,\n   *   representing the subtree), or indicates that the node should be processed\n   *   recursively.  The default zipFn recurses as far as possible and places\n   *   arrays at the leaves.\n   * @returns A `LazyIterator` of batches of elements, represented as an object\n   *   with collections at the leaves.\n   */\n  columnMajorBatch(\n      batchSize: number, smallLastBatch = true,\n      // tslint:disable-next-line:no-any\n      zipFn: (xs: any[]) => DeepMapResult = zipToList):\n      LazyIterator<DataElement> {\n    // First collect the desired number of input elements as a row-major batch.\n    const rowBatches = this.rowMajorBatch(batchSize, smallLastBatch);\n    // Now 'rotate' or 'pivot' the data, collecting all values from each column\n    // in the batch (i.e., for each key within the elements) into an array.\n    return rowBatches.map(x => deepZip(x, zipFn));\n  }\n\n  /**\n   * Concatenate this `LazyIterator` with another.\n   *\n   * @param iterator A `LazyIterator` to be concatenated onto this one.\n   * @param baseErrorHandler An optional function that can intercept `Error`s\n   *   raised during a `next()` call on the base stream.  This function can\n   *   decide whether the error should be propagated, whether the error should\n   *   be ignored, or whether the base stream should be terminated.\n   * @returns A `LazyIterator`.\n   */\n  concatenate(\n      iterator: LazyIterator<T>,\n      baseErrorHandler?: (e: Error) => boolean): LazyIterator<T> {\n    return new ChainedIterator(\n        iteratorFromItems([this, iterator]), baseErrorHandler);\n  }\n\n  /**\n   * Limits this stream to return at most `count` items.\n   *\n   * @param count The maximum number of items to provide from the stream. If\n   * a negative or undefined value is given, the entire stream is returned\n   *   unaltered.\n   */\n  take(count: number): LazyIterator<T> {\n    if (count < 0 || count == null) {\n      return this;\n    }\n    return new TakeIterator(this, count);\n  }\n\n  /**\n   * Skips the first `count` items in this stream.\n   *\n   * @param count The number of items to skip.  If a negative or undefined\n   * value is given, the entire stream is returned unaltered.\n   */\n  skip(count: number): LazyIterator<T> {\n    if (count < 0 || count == null) {\n      return this;\n    }\n    return new SkipIterator(this, count);\n  }\n\n  /**\n   * Prefetch the first `bufferSize` items in this stream.\n   *\n   * Note this prefetches Promises, but makes no guarantees about when those\n   * Promises resolve.\n   *\n   * @param bufferSize: An integer specifying the number of elements to be\n   *   prefetched.\n   */\n  prefetch(bufferSize: number): LazyIterator<T> {\n    return new PrefetchIterator(this, bufferSize);\n  }\n\n  // TODO(soergel): deep sharded shuffle, where supported\n\n  /**\n   * Randomly shuffles the elements of this stream.\n   *\n   * @param bufferSize: An integer specifying the number of elements from\n   * this stream from which the new stream will sample.\n   * @param seed: (Optional.) An integer specifying the random seed that\n   * will be used to create the distribution.\n   */\n  shuffle(windowSize: number, seed?: string): LazyIterator<T> {\n    return new ShuffleIterator(this, windowSize, seed);\n  }\n\n  /**\n   * Force an iterator to execute serially: each next() call will await the\n   * prior one, so that they cannot execute concurrently.\n   */\n  serial(): LazyIterator<T> {\n    return new SerialIterator(this);\n  }\n}\n\n// ============================================================================\n// The following private classes serve to implement the chainable methods\n// on LazyIterator.  Unfortunately they can't be placed in separate files,\n// due to resulting trouble with circular imports.\n// ============================================================================\n\n// Iterators that just extend LazyIterator directly\n// ============================================================================\n\nclass ArrayIterator<T> extends LazyIterator<T> {\n  private trav = 0;\n  constructor(protected items: T[]) {\n    super();\n  }\n\n  summary() {\n    return `Array of ${this.items.length} items`;\n  }\n\n  async next(): Promise<IteratorResult<T>> {\n    if (this.trav >= this.items.length) {\n      return {value: null, done: true};\n    }\n    const result = this.items[this.trav];\n    this.trav++;\n    return {value: result, done: false};\n  }\n}\n\nclass FunctionCallIterator<T> extends LazyIterator<T> {\n  constructor(\n      protected nextFn: () => IteratorResult<T>| Promise<IteratorResult<T>>) {\n    super();\n  }\n\n  summary() {\n    return `Function call`;\n  }\n\n  async next(): Promise<IteratorResult<T>> {\n    try {\n      return this.nextFn();\n    } catch (e) {\n      // Modify the error message but leave the stack trace intact\n      e.message =\n          `Error thrown while iterating through a dataset: ${e.message}`;\n      throw e;\n    }\n  }\n}\n\nclass SerialIterator<T> extends LazyIterator<T> {\n  // Strict Promise execution order:\n  // a next() call may not even begin until the previous one completes.\n  private lastRead: Promise<IteratorResult<T>>;\n\n  constructor(protected upstream: LazyIterator<T>) {\n    super();\n    this.lastRead = Promise.resolve({value: null, done: false});\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> Serial`;\n  }\n\n  async next(): Promise<IteratorResult<T>> {\n    // This sets this.lastRead to a new Promise right away, as opposed to\n    // saying `await this.lastRead; this.lastRead = this.serialNext();` which\n    // would not work because this.nextRead would be updated only after the\n    // promise resolves.\n    this.lastRead = this.lastRead.then(() => this.serialNext());\n    return this.lastRead;\n  }\n\n  private async serialNext(): Promise<IteratorResult<T>> {\n    return this.upstream.next();\n  }\n}\n\nclass SkipIterator<T> extends LazyIterator<T> {\n  // Strict Promise execution order:\n  // a next() call may not even begin until the previous one completes.\n  private lastRead: Promise<IteratorResult<T>>;\n\n  // Local state that should not be clobbered by out-of-order execution.\n  count = 0;\n\n  constructor(protected upstream: LazyIterator<T>, protected maxCount: number) {\n    super();\n    this.lastRead = Promise.resolve({value: null, done: false});\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> Skip`;\n  }\n\n  async next(): Promise<IteratorResult<T>> {\n    // This sets this.lastRead to a new Promise right away, as opposed to\n    // saying `await this.lastRead; this.lastRead = this.serialNext();` which\n    // would not work because this.nextRead would be updated only after the\n    // promise resolves.\n    this.lastRead = this.lastRead.then(() => this.serialNext());\n    return this.lastRead;\n  }\n\n  private async serialNext(): Promise<IteratorResult<T>> {\n    // TODO(soergel): consider tradeoffs of reading in parallel, eg.\n    // collecting next() promises in an Array and then waiting for\n    // Promise.all() of those. Benefit: pseudo-parallel execution.  Drawback:\n    // maybe delayed GC.\n    while (this.count++ < this.maxCount) {\n      const skipped = await this.upstream.next();\n      // short-circuit if upstream is already empty\n      if (skipped.done) {\n        return skipped;\n      }\n      tf.dispose(skipped.value as {});\n    }\n    return this.upstream.next();\n  }\n}\n\nclass TakeIterator<T> extends LazyIterator<T> {\n  count = 0;\n  constructor(protected upstream: LazyIterator<T>, protected maxCount: number) {\n    super();\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> Take`;\n  }\n\n  async next(): Promise<IteratorResult<T>> {\n    if (this.count++ >= this.maxCount) {\n      return {value: null, done: true};\n    }\n    return this.upstream.next();\n  }\n}\n\n// Note this batch just groups items into row-wise element arrays.\n// Rotating these to a column-wise representation happens only at the dataset\n// level.\nclass RowMajorBatchIterator<T> extends LazyIterator<T[]> {\n  // Strict Promise execution order:\n  // a next() call may not even begin until the previous one completes.\n  private lastRead: Promise<IteratorResult<T[]>>;\n\n  constructor(\n      protected upstream: LazyIterator<T>, protected batchSize: number,\n      protected enableSmallLastBatch = true) {\n    super();\n    this.lastRead = Promise.resolve({value: null, done: false});\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> RowMajorBatch`;\n  }\n\n  async next(): Promise<IteratorResult<T[]>> {\n    // This sets this.lastRead to a new Promise right away, as opposed to\n    // saying `await this.lastRead; this.lastRead = this.serialNext();` which\n    // would not work because this.nextRead would be updated only after the\n    // promise resolves.\n    this.lastRead = this.lastRead.then(() => this.serialNext());\n    return this.lastRead;\n  }\n\n  private async serialNext(): Promise<IteratorResult<T[]>> {\n    const batch: T[] = [];\n    while (batch.length < this.batchSize) {\n      const item = await this.upstream.next();\n      if (item.done) {\n        if (this.enableSmallLastBatch && batch.length > 0) {\n          return {value: batch, done: false};\n        }\n        return {value: null, done: true};\n      }\n      batch.push(item.value);\n    }\n    return {value: batch, done: false};\n  }\n}\n\nclass FilterIterator<T> extends LazyIterator<T> {\n  // Strict Promise execution order:\n  // a next() call may not even begin until the previous one completes.\n  private lastRead: Promise<IteratorResult<T>>;\n\n  constructor(\n      protected upstream: LazyIterator<T>,\n      protected predicate: (value: T) => boolean) {\n    super();\n    this.lastRead = Promise.resolve({value: null, done: false});\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> Filter`;\n  }\n\n  async next(): Promise<IteratorResult<T>> {\n    // This sets this.lastRead to a new Promise right away, as opposed to\n    // saying `await this.lastRead; this.lastRead = this.serialNext();` which\n    // would not work because this.nextRead would be updated only after the\n    // promise resolves.\n    this.lastRead = this.lastRead.then(() => this.serialNext());\n    return this.lastRead;\n  }\n\n  private async serialNext(): Promise<IteratorResult<T>> {\n    while (true) {\n      const item = await this.upstream.next();\n      if (item.done || this.predicate(item.value)) {\n        return item;\n      }\n      tf.dispose(item.value as {});\n    }\n  }\n}\n\nclass MapIterator<I, O> extends LazyIterator<O> {\n  constructor(\n      protected upstream: LazyIterator<I>,\n      protected transform: (value: I) => O) {\n    super();\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> Map`;\n  }\n\n  async next(): Promise<IteratorResult<O>> {\n    const item = await this.upstream.next();\n    if (item.done) {\n      return {value: null, done: true};\n    }\n    const inputTensors = getTensorsInContainer(item.value as {});\n    // Careful: the transform may mutate the item in place.\n    // That's why we have to remember the input Tensors above, and then\n    // below dispose only those that were not passed through to the output.\n    // Note too that the transform function is responsible for tidying\n    // any intermediate Tensors.  Here we are concerned only about the\n    // inputs.\n    const mapped = this.transform(item.value);\n    const outputTensors = getTensorsInContainer(mapped as {});\n\n    // TODO(soergel) faster intersection\n    // TODO(soergel) move to tf.disposeExcept(in, out)?\n    for (const t of inputTensors) {\n      if (!isTensorInList(t, outputTensors)) {\n        t.dispose();\n      }\n    }\n    return {value: mapped, done: false};\n  }\n}\n\nclass ErrorHandlingLazyIterator<T> extends LazyIterator<T> {\n  count = 0;\n  constructor(\n      protected upstream: LazyIterator<T>,\n      protected handler: (error: Error) => boolean) {\n    super();\n    this.lastRead = Promise.resolve({value: null, done: false});\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> handleErrors`;\n  }\n\n  // Strict Promise execution order:\n  // a next() call may not even begin until the previous one completes.\n  private lastRead: Promise<IteratorResult<T>>;\n\n  async next(): Promise<IteratorResult<T>> {\n    // This sets this.lastRead to a new Promise right away, as opposed to\n    // saying `await this.lastRead; this.lastRead = this.serialNext();` which\n    // would not work because this.nextRead would be updated only after the\n    // promise resolves.\n    this.lastRead = this.lastRead.then(() => this.serialNext());\n    return this.lastRead;\n  }\n\n  async serialNext(): Promise<IteratorResult<T>> {\n    while (true) {\n      try {\n        return await this.upstream.next();\n      } catch (e) {\n        if (!this.handler(e)) {\n          return {value: null, done: true};\n        }\n        // If the handler returns true, loop and fetch the next upstream item.\n\n        // If the upstream iterator throws an endless stream of errors, and if\n        // the handler says to ignore them, then we loop forever here.  That is\n        // the correct behavior-- it's up to the handler to decide when to stop.\n      }\n    }\n  }\n}\n\nclass AsyncMapIterator<I, O> extends LazyIterator<O> {\n  constructor(\n      protected upstream: LazyIterator<I>,\n      protected transform: (value: I) => Promise<O>) {\n    super();\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> AsyncMap`;\n  }\n\n  async next(): Promise<IteratorResult<O>> {\n    const item = await this.upstream.next();\n    if (item.done) {\n      return {value: null, done: true};\n    }\n    const inputTensors = getTensorsInContainer(item.value as {});\n    // Careful: the transform may mutate the item in place.\n    // That's why we have to remember the input Tensors above, and then\n    // below dispose only those that were not passed through to the output.\n    // Note too that the transform function is responsible for tidying\n    // any intermediate Tensors.  Here we are concerned only about the\n    // inputs.\n    const mapped = await this.transform(item.value);\n    const outputTensors = getTensorsInContainer(mapped as {});\n\n    // TODO(soergel) faster intersection\n    // TODO(soergel) move to tf.disposeExcept(in, out)?\n    for (const t of inputTensors) {\n      if (!isTensorInList(t, outputTensors)) {\n        t.dispose();\n      }\n    }\n    return {value: mapped, done: false};\n  }\n}\n\n// Iterators that maintain a queue of pending items\n// ============================================================================\n\n/**\n * A base class for transforming streams that operate by maintaining an\n * output queue of elements that are ready to return via next().  This is\n * commonly required when the transformation is 1-to-many:  A call to next()\n * may trigger a call to the underlying stream, which will produce many\n * mapped elements of this stream-- of which we need to return only one, so\n * we have to queue the rest.\n */\nexport abstract class OneToManyIterator<T> extends LazyIterator<T> {\n  // Strict Promise execution order:\n  // a next() call may not even begin until the previous one completes.\n  private lastRead: Promise<IteratorResult<T>>;\n\n  // Local state that should not be clobbered by out-of-order execution.\n  protected outputQueue: RingBuffer<T>;\n\n  constructor() {\n    super();\n    this.outputQueue = new GrowingRingBuffer<T>();\n    this.lastRead = Promise.resolve({value: null, done: false});\n  }\n\n  async next(): Promise<IteratorResult<T>> {\n    // This sets this.lastRead to a new Promise right away, as opposed to\n    // saying `await this.lastRead; this.lastRead = this.serialNext();` which\n    // would not work because this.nextRead would be updated only after the\n    // promise resolves.\n    this.lastRead = this.lastRead.then(() => this.serialNext());\n    return this.lastRead;\n  }\n\n  /**\n   * Read one or more chunks from upstream and process them, possibly\n   * reading or writing a carryover, and adding processed items to the\n   * output queue.  Note it's possible that no items are added to the queue\n   * on a given pump() call, even if the upstream stream is not closed\n   * (e.g., because items are filtered).\n   *\n   * @return `true` if any action was taken, i.e. fetching items from the\n   *   upstream source OR adding items to the output queue.  `false` if the\n   *   upstream source is exhausted AND nothing was added to the queue\n   * (i.e., any remaining carryover).\n   */\n  protected abstract async pump(): Promise<boolean>;\n\n  async serialNext(): Promise<IteratorResult<T>> {\n    // Fetch so that the queue contains at least one item if possible.\n    // If the upstream source is exhausted, AND there are no items left in\n    // the output queue, then this stream is also exhausted.\n    while (this.outputQueue.length() === 0) {\n      // TODO(soergel): consider parallel reads.\n      if (!await this.pump()) {\n        return {value: null, done: true};\n      }\n    }\n    return {value: this.outputQueue.shift(), done: false};\n  }\n}\nclass FlatmapIterator<I, O> extends OneToManyIterator<O> {\n  constructor(\n      protected upstream: LazyIterator<I>,\n      protected transform: (value: I) => O[]) {\n    super();\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> Flatmap`;\n  }\n\n  async pump(): Promise<boolean> {\n    const item = await this.upstream.next();\n    if (item.done) {\n      return false;\n    }\n    const inputTensors = getTensorsInContainer(item.value as {});\n    // Careful: the transform may mutate the item in place.\n    // that's why we have to remember the input Tensors above, and then\n    // below dispose only those that were not passed through to the output.\n    // Note too that the transform function is responsible for tidying any\n    // intermediate Tensors.  Here we are concerned only about the inputs.\n    const mappedArray = this.transform(item.value);\n    const outputTensors = getTensorsInContainer(mappedArray as {});\n    this.outputQueue.pushAll(mappedArray);\n\n    // TODO(soergel) faster intersection, and deduplicate outputTensors\n    // TODO(soergel) move to tf.disposeExcept(in, out)?\n    for (const t of inputTensors) {\n      if (!isTensorInList(t, outputTensors)) {\n        t.dispose();\n      }\n    }\n\n    return true;\n  }\n}\n\n/**\n * Provides a `LazyIterator` that concatenates a stream of underlying\n * streams.\n *\n * Doing this in a concurrency-safe way requires some trickery.  In\n * particular, we want this stream to return the elements from the\n * underlying streams in the correct order according to when next() was\n * called, even if the resulting Promises resolve in a different order.\n */\nexport class ChainedIterator<T> extends LazyIterator<T> {\n  // Strict Promise execution order:\n  // a next() call may not even begin until the previous one completes.\n  private lastRead: Promise<IteratorResult<T>> = null;\n\n  // Local state that should not be clobbered by out-of-order execution.\n  private iterator: LazyIterator<T> = null;\n  private moreIterators: LazyIterator<LazyIterator<T>>;\n\n  constructor(\n      iterators: LazyIterator<LazyIterator<T>>,\n      private readonly baseErrorHandler?: (e: Error) => boolean) {\n    super();\n    this.moreIterators = iterators;\n  }\n\n  summary() {\n    const upstreamSummaries = 'TODO: fill in upstream of chained summaries';\n    return `${upstreamSummaries} -> Chained`;\n  }\n\n  async next(): Promise<IteratorResult<T>> {\n    this.lastRead = this.readFromChain(this.lastRead);\n    return this.lastRead;\n  }\n\n  private async readFromChain(lastRead: Promise<IteratorResult<T>>):\n      Promise<IteratorResult<T>> {\n    // Must await on the previous read since the previous read may have advanced\n    // the stream of streams, from which we need to read.\n    // This is unfortunate since we can't parallelize reads. Which means\n    // prefetching of chained streams is a no-op.\n    // One solution is to prefetch immediately upstream of this.\n    await lastRead;\n    if (this.iterator == null) {\n      const iteratorResult = await this.moreIterators.next();\n      if (iteratorResult.done) {\n        // No more streams to stream from.\n        return {value: null, done: true};\n      }\n      this.iterator = iteratorResult.value;\n      if (this.baseErrorHandler != null) {\n        this.iterator = this.iterator.handleErrors(this.baseErrorHandler);\n      }\n    }\n    const itemResult = await this.iterator.next();\n    if (itemResult.done) {\n      this.iterator = null;\n      return this.readFromChain(lastRead);\n    }\n    return itemResult;\n  }\n}\n\nexport enum ZipMismatchMode {\n  FAIL,      // require zipped streams to have the same length\n  SHORTEST,  // terminate zip when the first stream is exhausted\n  LONGEST    // use nulls for exhausted streams; use up the longest stream.\n}\n\n/**\n * Provides a `LazyIterator` that zips together an array, dict, or nested\n * structure of `LazyIterator`s (and perhaps additional constants).\n *\n * The underlying streams must provide elements in a consistent order such\n * that they correspond.\n *\n * Typically, the underlying streams should have the same number of\n * elements. If they do not, the behavior is determined by the\n * `mismatchMode` argument.\n *\n * The nested structure of the `iterators` argument determines the\n * structure of elements in the resulting iterator.\n *\n * Doing this in a concurrency-safe way requires some trickery.  In\n * particular, we want this stream to return the elements from the\n * underlying streams in the correct order according to when next() was\n * called, even if the resulting Promises resolve in a different order.\n *\n * @param iterators: An array or object containing LazyIterators at the\n * leaves.\n * @param mismatchMode: Determines what to do when one underlying iterator\n * is exhausted before the others.  `ZipMismatchMode.FAIL` (the default)\n * causes an error to be thrown in this case.  `ZipMismatchMode.SHORTEST`\n * causes the zipped iterator to terminate with the furst underlying\n * streams, so elements remaining on the longer streams are ignored.\n * `ZipMismatchMode.LONGEST` causes the zipped stream to continue, filling\n * in nulls for the exhausted streams, until all streams are exhausted.\n */\nclass ZipIterator<O extends DataElement> extends LazyIterator<O> {\n  private count = 0;\n  private currentPromise: Promise<IteratorResult<O>> = null;\n\n  constructor(\n      protected readonly iterators: IteratorContainer,\n      protected readonly mismatchMode: ZipMismatchMode = ZipMismatchMode.FAIL) {\n    super();\n  }\n\n  summary() {\n    const upstreamSummaries = 'TODO: fill in upstream of zip summaries';\n    return `{${upstreamSummaries}} -> Zip`;\n  }\n\n  private async nextState(afterState: Promise<IteratorResult<O>>):\n      Promise<IteratorResult<O>> {\n    // This chaining ensures that the underlying next() are not even called\n    // before the previous ones have resolved.\n    await afterState;\n\n    // Collect underlying iterator \"done\" signals as a side effect in\n    // getNext()\n    let numIterators = 0;\n    let iteratorsDone = 0;\n\n    function getNext(container: IteratorContainer): DeepMapAsyncResult {\n      if (container instanceof LazyIterator) {\n        const result = container.next();\n        return {\n          value: result.then(x => {\n            numIterators++;\n            if (x.done) {\n              iteratorsDone++;\n            }\n            return x.value;\n          }),\n          recurse: false\n        };\n      } else {\n        return {value: null, recurse: true};\n      }\n    }\n\n    const mapped: O = await deepMapAndAwaitAll(this.iterators, getNext);\n\n    if (numIterators === iteratorsDone) {\n      // The streams have all ended.\n      return {value: null, done: true};\n    }\n    if (iteratorsDone > 0) {\n      switch (this.mismatchMode) {\n        case ZipMismatchMode.FAIL:\n          throw new Error(\n              'Zipped streams should have the same length. ' +\n              `Mismatched at element ${this.count}.`);\n        case ZipMismatchMode.SHORTEST:\n          return {value: null, done: true};\n        case ZipMismatchMode.LONGEST:\n        default:\n          // Continue.  The exhausted streams already produced value: null.\n      }\n    }\n\n    this.count++;\n    return {value: mapped, done: false};\n  }\n\n  async next(): Promise<IteratorResult<O>> {\n    this.currentPromise = this.nextState(this.currentPromise);\n    return (await this.currentPromise);\n  }\n}\n\n// Iterators that maintain a ring buffer of pending promises\n// ============================================================================\n\n/**\n * A stream that prefetches a given number of items from an upstream source,\n * returning them in FIFO order.\n *\n * Note this prefetches Promises, but makes no guarantees about when those\n * Promises resolve.\n */\nexport class PrefetchIterator<T> extends LazyIterator<T> {\n  protected buffer: RingBuffer<Promise<IteratorResult<T>>>;\n\n  constructor(\n      protected upstream: LazyIterator<T>, protected bufferSize: number) {\n    super();\n    this.buffer = new RingBuffer<Promise<IteratorResult<T>>>(bufferSize);\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> Prefetch`;\n  }\n\n  /**\n   * Refill the prefetch buffer.  Returns only after the buffer is full, or\n   * the upstream source is exhausted.\n   */\n  protected refill() {\n    while (!this.buffer.isFull()) {\n      const v = this.upstream.next();\n      this.buffer.push(v);\n    }\n  }\n\n  next(): Promise<IteratorResult<T>> {\n    this.refill();\n    // This shift will never throw an error because the buffer is always\n    // full after a refill. If the stream is exhausted, the buffer will be\n    // full of Promises that will resolve to the end-of-stream signal.\n    return this.buffer.shift();\n  }\n}\n\n/**\n * A stream that performs a sliding-window random shuffle on an upstream\n * source. This is like a `PrefetchIterator` except that the items are\n * returned in randomized order.  Mixing naturally improves as the buffer\n * size increases.\n */\nexport class ShuffleIterator<T> extends PrefetchIterator<T> {\n  private readonly random: seedrandom.prng;\n\n  // Strict Promise execution order:\n  // a next() call may not even begin until the previous one completes.\n  private lastRead: Promise<IteratorResult<T>>;\n\n  // Local state that should not be clobbered by out-of-order execution.\n  private upstreamExhausted = false;\n\n  constructor(\n      protected upstream: LazyIterator<T>, protected windowSize: number,\n      seed?: string) {\n    super(upstream, windowSize);\n    this.random = seedrandom.alea(seed || tf.util.now().toString());\n    this.lastRead = Promise.resolve({value: null, done: false});\n  }\n\n  async next(): Promise<IteratorResult<T>> {\n    // This sets this.lastRead to a new Promise right away, as opposed to\n    // saying `await this.lastRead; this.lastRead = this.serialNext();` which\n    // would not work because this.nextRead would be updated only after the\n    // promise resolves.\n    this.lastRead = this.lastRead.then(() => this.serialNext());\n    return this.lastRead;\n  }\n\n  private randomInt(max: number) {\n    return Math.floor(this.random() * max);\n  }\n\n  protected chooseIndex(): number {\n    return this.randomInt(this.buffer.length());\n  }\n\n  async serialNext(): Promise<IteratorResult<T>> {\n    // TODO(soergel): consider performance\n    if (!this.upstreamExhausted) {\n      this.refill();\n    }\n    while (!this.buffer.isEmpty()) {\n      const chosenIndex = this.chooseIndex();\n      const result = await this.buffer.shuffleExcise(chosenIndex);\n      if (result.done) {\n        this.upstreamExhausted = true;\n      } else {\n        this.refill();\n        return result;\n      }\n    }\n    return {value: null, done: true};\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport * as tf from '@tensorflow/tfjs-core';\nimport * as seedrandom from 'seedrandom';\n\nimport {iteratorFromFunction, iteratorFromZipped, LazyIterator, ZipMismatchMode} from './iterators/lazy_iterator';\nimport {iteratorFromConcatenated} from './iterators/lazy_iterator';\nimport {iteratorFromItems} from './iterators/lazy_iterator';\nimport {DataElement, DatasetContainer} from './types';\nimport {deepMapAndAwaitAll, DeepMapResult, isIterable, isNumericArray} from './util/deep_map';\n\n// TODO(soergel): consider vectorized operations within the pipeline.\n\n/**\n * Represents a potentially large list of independent data elements (typically\n * 'samples' or 'examples').\n *\n * A 'data example' may be a primitive, an array, a map from string keys to\n * values, or any nested structure of these.\n *\n * A `Dataset` represents an ordered collection of elements, together with a\n * chain of transformations to be performed on those elements. Each\n * transformation is a method of `Dataset` that returns another `Dataset`, so\n * these may be chained, e.g.\n * `const processedDataset = rawDataset.filter(...).map(...).batch(...)`.\n *\n * Data loading and transformation is done in a lazy, streaming fashion.  The\n * dataset may be iterated over multiple times; each iteration starts the data\n * loading anew and recapitulates the transformations.\n *\n * A `Dataset` is typically processed as a stream of unbatched examples --i.e.,\n * its transformations are applied one example at a time. Batching produces a\n * new `Dataset` where each element is a batch. Batching should usually come\n * last in a pipeline, because data transformations are easier to express on a\n * per-example basis than on a per-batch basis.\n *\n * The following code examples are calling `await dataset.forEach(...)` to\n * iterate once over the entire dataset in order to print out the data.\n */\n/** @doc {heading: 'Data', subheading: 'Classes', namespace: 'data'} */\nexport abstract class Dataset<T extends DataElement> {\n  /*\n   * Provide a new stream of elements.  Note this will also start new streams\n   * from any underlying `Dataset`s.\n   *\n   * CAUTION: Any Tensors contained within the elements returned from\n   * this stream *must* be manually disposed to avoid a GPU memory leak.\n   * The tf.tidy() approach cannot be used in an asynchronous context.\n   */\n  abstract async iterator(): Promise<LazyIterator<T>>;\n\n  // TODO(soergel): Make Datasets report whether repeated iterator() calls\n  // produce the same result (e.g., reading from a file) or different results\n  // (e.g., from the webcam).  Currently we don't make this distinction but it\n  // could be important for the user to know.\n  // abstract isDeterministic(): boolean;\n\n  /**\n   * Filters this dataset according to `predicate`.\n   *\n   * ```js\n   * const a = tf.data.array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])\n   *   .filter(x => x%2 === 0);\n   * await a.forEach(e => console.log(e));\n   * ```\n   *\n   * @param predicate A function mapping a dataset element to a boolean or a\n   * `Promise` for one.\n   *\n   * @returns A `Dataset` of elements for which the predicate was true.\n   */\n  /** @doc {heading: 'Data', subheading: 'Classes'} */\n  filter(predicate: (value: T) => boolean): Dataset<T> {\n    const base = this;\n    return datasetFromIteratorFn(async () => {\n      return (await base.iterator()).filter(x => tf.tidy(() => predicate(x)));\n    });\n  }\n\n  /**\n   * Maps this dataset through a 1-to-1 transform.\n   *\n   * ```js\n   * const a = tf.data.array([1, 2, 3]).map(x => x*x);\n   * await a.forEach(e => console.log(e));\n   * ```\n   *\n   * @param transform A function mapping a dataset element to a transformed\n   *   dataset element.\n   *\n   * @returns A `Dataset` of transformed elements.\n   */\n  /** @doc {heading: 'Data', subheading: 'Classes'} */\n  map<O extends DataElement>(transform: (value: T) => O): Dataset<O> {\n    const base = this;\n    return datasetFromIteratorFn(async () => {\n      return (await base.iterator()).map(x => tf.tidy(() => transform(x)));\n    });\n  }\n\n  /**\n   * Maps this dataset through an async 1-to-1 transform.\n   *\n   * ```js\n   * const a = tf.data.array([1, 2, 3]).map(x => new Promise(function(resolve){\n   *  resolve(x*x);\n   * }));\n   * await a.forEach(e => e.then(function(value){\n   *  console.log(value);\n   * }));\n   * ```\n   *\n   * @param transform A function mapping a dataset element to a `Promise` for a\n   *   transformed dataset element.  This transform is responsible for disposing\n   *   any intermediate `Tensor`s, i.e. by wrapping its computation in\n   *   `tf.tidy()`; that cannot be automated here (as it is in the synchronous\n   *   `map()` case).\n   *\n   * @returns A `Dataset` of transformed elements.\n   */\n  /** @doc {heading: 'Data', subheading: 'Classes'} */\n  mapAsync<O extends DataElement>(transform: (value: T) => Promise<O>):\n      Dataset<O> {\n    const base = this;\n    return datasetFromIteratorFn(async () => {\n      return (await base.iterator()).mapAsync(transform);\n    });\n  }\n\n  /**\n   * Groups elements into batches and arranges their values in columnar\n   * form.\n   *\n   * It is assumed that each of the incoming dataset elements has the same\n   * set of keys.  For each key, the resulting `Dataset` provides a batched\n   * element collecting all of the incoming values for that key.  Incoming\n   * strings are grouped into a string[].  Incoming Tensors are grouped into a\n   * new Tensor where the 0'th axis is the batch dimension.  These columnar\n   * representations for each key can be zipped together to reconstruct the\n   * original dataset elements.\n   *\n   * Batch a dataset of numbers:\n   * ```js\n   * const a = tf.data.array([1, 2, 3, 4, 5, 6, 7, 8]).batch(4);\n   * await a.forEach(e => e.print());\n   * ```\n   *\n   * Batch a dataset of arrays:\n   * ```js\n   * const b = tf.data.array([[1], [2], [3], [4], [5], [6], [7], [8]]).batch(4);\n   * await b.forEach(e => e.print());\n   * ```\n   *\n   * Batch a dataset of objects:\n   * ```js\n   * const c = tf.data.array([{a: 1, b: 11}, {a: 2, b: 12}, {a: 3, b: 13},\n   *   {a: 4, b: 14}, {a: 5, b: 15}, {a: 6, b: 16}, {a: 7, b: 17},\n   *   {a: 8, b: 18}]).batch(4);\n   * await c.forEach(e => {\n   *   console.log('{');\n   *   for(var key in e) {\n   *     console.log(key+':');\n   *     e[key].print();\n   *   }\n   *   console.log('}');\n   * })\n   * ```\n   *\n   * @param batchSize The number of elements desired per batch.\n   * @param smallLastBatch Whether to emit the final batch when it has fewer\n   *   than batchSize elements. Default true.\n   * @returns A `Dataset`, from which a stream of batches can be obtained.\n   */\n  /** @doc {heading: 'Data', subheading: 'Classes'} */\n  batch(batchSize: number, smallLastBatch = true): Dataset<DataElement> {\n    const base = this;\n    return datasetFromIteratorFn(async () => {\n      return (await base.iterator())\n          .columnMajorBatch(batchSize, smallLastBatch, deepBatchConcat);\n    });\n  }\n\n  /**\n   * Concatenates this `Dataset` with another.\n   *\n   * ```js\n   * const a = tf.data.array([1, 2, 3]);\n   * const b = tf.data.array([4, 5, 6]);\n   * const c = a.concatenate(b);\n   * await c.forEach(e => console.log(e));\n   * ```\n   *\n   * @param dataset A `Dataset` to be concatenated onto this one.\n   * @returns A `Dataset`.\n   */\n  /** @doc {heading: 'Data', subheading: 'Classes'} */\n  concatenate(dataset: Dataset<T>): Dataset<T> {\n    const base = this;\n    return datasetFromIteratorFn(\n        async () =>\n            (await base.iterator()).concatenate(await dataset.iterator()));\n  }\n\n  /**\n   * Repeats this dataset `count` times.\n   *\n   * NOTE: If this dataset is a function of global state (e.g. a random number\n   * generator), then different repetitions may produce different elements.\n   *\n   * ```js\n   * const a = tf.data.array([1, 2, 3]).repeat(3);\n   * await a.forEach(e => console.log(e));\n   * ```\n   *\n   * @param count: (Optional) An integer, representing the number of times\n   *   the dataset should be repeated. The default behavior (if `count` is\n   *   `undefined` or negative) is for the dataset be repeated indefinitely.\n   * @returns A `Dataset`.\n   */\n  /** @doc {heading: 'Data', subheading: 'Classes'} */\n  repeat(count?: number): Dataset<T> {\n    const base = this;\n    return datasetFromIteratorFn(async () => {\n      const iteratorIterator = iteratorFromFunction(\n          async () => ({value: await base.iterator(), done: false}));\n      return iteratorFromConcatenated(iteratorIterator.take(count));\n    });\n  }\n\n  /**\n   * Creates a `Dataset` with at most `count` initial elements from this\n   * dataset.\n   *\n   * ```js\n   * const a = tf.data.array([1, 2, 3, 4, 5, 6]).take(3);\n   * await a.forEach(e => console.log(e));\n   * ```\n   *\n   * @param count: The number of elements of this dataset that should be taken\n   *   to form the new dataset.  If `count` is `undefined` or negative, or if\n   *   `count` is greater than the size of this dataset, the new dataset will\n   *   contain all elements of this dataset.\n   * @returns A `Dataset`.\n   */\n  /** @doc {heading: 'Data', subheading: 'Classes'} */\n  take(count: number): Dataset<T> {\n    const base = this;\n    return datasetFromIteratorFn(\n        async () => (await base.iterator()).take(count));\n  }\n\n  /**\n   * Creates a `Dataset` that skips `count` initial elements from this dataset.\n   *\n   * ```js\n   * const a = tf.data.array([1, 2, 3, 4, 5, 6]).skip(3);\n   * await a.forEach(e => console.log(e));\n   * ```\n   *\n   * @param count: The number of elements of this dataset that should be skipped\n   *   to form the new dataset.  If `count` is greater than the size of this\n   *   dataset, the new dataset will contain no elements.  If `count`\n   *   is `undefined` or negative, skips the entire dataset.\n   *\n   * @returns A `Dataset`.\n   */\n  /** @doc {heading: 'Data', subheading: 'Classes'} */\n  skip(count: number): Dataset<T> {\n    const base = this;\n    return datasetFromIteratorFn(\n        async () => (await base.iterator()).skip(count));\n  }\n\n  // TODO(soergel): deep sharded shuffle, where supported\n\n  /**\n   * Pseudorandomly shuffles the elements of this dataset. This is done in a\n   * streaming manner, by sampling from a given number of prefetched elements.\n   *\n   * ```js\n   * const a = tf.data.array([1, 2, 3, 4, 5, 6]).shuffle(3);\n   * await a.forEach(e => console.log(e));\n   * ```\n   *\n   * @param bufferSize: An integer specifying the number of elements from this\n   *   dataset from which the new dataset will sample.\n   * @param seed: (Optional) An integer specifying the random seed that will\n   *   be used to create the distribution.\n   * @param reshuffleEachIteration: (Optional) A boolean, which if true\n   *   indicates that the dataset should be pseudorandomly reshuffled each time\n   *   it is iterated over. If false, elements will be returned in the same\n   *   shuffled order on each iteration. (Defaults to `true`.)\n   * @returns A `Dataset`.\n   */\n  /** @doc {heading: 'Data', subheading: 'Classes'} */\n  shuffle(bufferSize: number, seed?: string, reshuffleEachIteration = true):\n      Dataset<T> {\n    const base = this;\n    const random = seedrandom.alea(seed || tf.util.now().toString());\n    return datasetFromIteratorFn(async () => {\n      let seed2 = random.int32();\n      if (reshuffleEachIteration) {\n        seed2 += random.int32();\n      }\n      return (await base.iterator()).shuffle(bufferSize, seed2.toString());\n    });\n  }\n\n  /**\n   *  Creates a `Dataset` that prefetches elements from this dataset.\n   *\n   * @param bufferSize: An integer specifying the number of elements to be\n   *   prefetched.\n   * @returns A `Dataset`.\n   */\n  // TODO: Document this function once tfjs-data supports streaming.\n  prefetch(bufferSize: number): Dataset<T> {\n    const base = this;\n    return datasetFromIteratorFn(\n        async () => (await base.iterator()).prefetch(bufferSize));\n  }\n\n  /**\n   * Collect all elements of this dataset into an array.\n   * Obviously this will succeed only for small datasets that fit in memory.\n   * Useful for testing.\n   *\n   * @returns A Promise for an array of elements, which will resolve\n   *   when a new stream has been obtained and fully consumed.\n   */\n  async collectAll() {\n    return (await this.iterator()).collect();\n  }\n\n  /**\n   * Apply a function to every element of the dataset.\n   *\n   * After the function is applied to a dataset element, any Tensors contained\n   * within that element are disposed.\n   *\n   * ```js\n   * const a = tf.data.array([1, 2, 3]);\n   * await a.forEach(e => console.log(e));\n   * ```\n   *\n   * @param f A function to apply to each dataset element.\n   * @returns A `Promise` that resolves after all elements have been processed.\n   */\n  /** @doc {heading: 'Data', subheading: 'Classes'} */\n  async forEach(f: (input: T) => void): Promise<void> {\n    return (await this.iterator()).forEach(f);\n  }\n\n  /* TODO(soergel): for parity with tf.data:\n  Dataset.flat_map()\n  Dataset.dense_to_sparse_batch()\n  Dataset.group_by_window()\n  Dataset.padded_batch()\n  */\n}\n\n/**\n * Create a `Dataset` defined by a provided iterator() function.\n */\nexport function datasetFromIteratorFn<T extends DataElement>(\n    iteratorFn: () => Promise<LazyIterator<T>>): Dataset<T> {\n  return new class extends Dataset<T> {\n    /*\n     * Provide a new stream of elements.  Note this will also start new streams\n     * from any underlying `Dataset`s.\n     */\n    async iterator(): Promise<LazyIterator<T>> {\n      return iteratorFn();\n    }\n  }\n  ();\n}\n\n/**\n * Create a `Dataset` from an array of elements.\n *\n * Create a Dataset from an array of objects:\n * ```js\n * const a = tf.data.array([{'item': 1}, {'item': 2}, {'item': 3}]);\n * await a.forEach(e => console.log(e));\n * ```\n *\n * Create a Dataset from an array of numbers:\n * ```js\n * const a = tf.data.array([4, 5, 6]);\n * await a.forEach(e => console.log(e));\n * ```\n * @param items An array of elements that will be parsed as items in a dataset.\n */\n/** @doc {heading: 'Data', subheading: 'Creation', namespace: 'data'} */\nexport function array<T extends DataElement>(items: T[]): Dataset<T> {\n  return datasetFromIteratorFn(async () => iteratorFromItems(items));\n}\n\n/**\n * Create a `Dataset` by zipping together an array, dict, or nested\n * structure of `Dataset`s (and perhaps additional constants).\n * The underlying datasets must provide elements in a consistent order such that\n * they correspond.\n *\n * The number of elements in the resulting dataset is the same as the size of\n * the smallest dataset in datasets.\n *\n * The nested structure of the `datasets` argument determines the\n * structure of elements in the resulting iterator.\n *\n * Note this means that, given an array of two datasets that produce dict\n * elements, the result is a dataset that produces elements that are arrays\n * of two dicts:\n *\n * Zip an array of datasets:\n * ```js\n * console.log('Zip two datasets of objects:');\n * const ds1 = tf.data.array([{a: 1}, {a: 2}, {a: 3}]);\n * const ds2 = tf.data.array([{b: 4}, {b: 5}, {b: 6}]);\n * const ds3 = tf.data.zip([ds1, ds2]);\n * await ds3.forEach(e => console.log(JSON.stringify(e)));\n *\n * // If the goal is to merge the dicts in order to produce elements like\n * // {a: ..., b: ...}, this requires a second step such as:\n * console.log('Merge the objects:');\n * const ds4 = ds3.map(x => {return {a: x[0].a, b: x[1].b}});\n * await ds4.forEach(e => console.log(e));\n * ```\n *\n * Zip a dict of datasets:\n * ```js\n * const a = tf.data.array([{a: 1}, {a: 2}, {a: 3}]);\n * const b = tf.data.array([{b: 4}, {b: 5}, {b: 6}]);\n * const c = tf.data.zip({c: a, d: b});\n * await c.forEach(e => console.log(JSON.stringify(e)));\n * ```\n */\n/** @doc {heading: 'Data', subheading: 'Operations', namespace: 'data'} */\nexport function zip<O extends DataElement>(datasets: DatasetContainer):\n    Dataset<O> {\n  // manually type-check the argument for JS users\n  if (!isIterable(datasets)) {\n    throw new Error('The argument to zip() must be an object or array.');\n  }\n  return datasetFromIteratorFn<O>(async () => {\n    const streams = await deepMapAndAwaitAll(datasets, d => {\n      if (d instanceof Dataset) {\n        return {value: d.iterator(), recurse: false};\n      } else if (isIterable(d)) {\n        return {value: null, recurse: true};\n      } else {\n        throw new Error(\n            'Leaves of the structure passed to zip() must be Datasets, ' +\n            'not primitives.');\n      }\n    });\n    return iteratorFromZipped<O>(streams, ZipMismatchMode.SHORTEST);\n  });\n}\n\n/**\n * A zip function for use with deepZip, passed via the columnMajorBatch call.\n *\n * Accepts an array of identically-structured nested elements and either batches\n * them (if they are primitives, numeric arrays, or Tensors) or requests\n * recursion (if not).\n */\n// tslint:disable-next-line:no-any\nfunction deepBatchConcat(rows: any[]): DeepMapResult {\n  if (rows === null) {\n    return null;\n  }\n\n  // use the first item to decide whether to recurse or batch here.\n  const exampleRow = rows[0];\n\n  if (typeof (exampleRow) === 'string') {\n    // rows is an array of strings, so it's already 'batched'.\n    // TODO(soergel): clean up the string special case when Tensor supports it.\n    return {value: rows, recurse: false};\n  }\n\n  if (!isIterable(exampleRow)) {\n    // rows is an array of non-string primitives or Tensors, so batch them.\n    const value = batchConcat(rows);\n    return {value, recurse: false};\n  }\n\n  if (isNumericArray(exampleRow)) {\n    // interpret an array of numbers as a leaf, so batching produces a 2d Tensor\n    const value = batchConcat(rows);\n    return {value, recurse: false};\n  }\n\n  // the example row is itself iterable, but not numeric, so recurse into it.\n  return {value: null, recurse: true};\n}\n\n/**\n * Assembles a list of same-shaped numbers, number arrays, or Tensors\n * into a single new Tensor where axis 0 is the batch dimension.\n */\nfunction batchConcat(arrays: Array<number|number[]|tf.Tensor>): tf.Tensor {\n  // Should we use GPU-enabled concat ops in deeplearn's math.ts?\n  // Probably not; the GPU roundtrip is not worth it for a trivial\n  // operation.\n  const [elementShape, ] = shapeAndValues(arrays[0]);\n  const batchShape = [arrays.length].concat(elementShape);\n  const resultVals = new Float32Array(batchShape.reduce((x, y) => x * y));\n\n  let offset = 0;\n  for (const a of arrays) {\n    const [aShape, aVals] = shapeAndValues(a);\n    if (!tf.util.arraysEqual(aShape, elementShape)) {\n      throw new Error('Elements must have the same shape to be batched');\n    }\n    resultVals.set(aVals, offset);\n    offset += aVals.length;\n  }\n  return tf.Tensor.make(batchShape, {values: resultVals});\n}\n\n/**\n * Extracts the shape and values from the argument, whether array or Tensor.\n *\n * If the argument is a Tensor, this performs a 'dataSync()' to obtain the\n * values as a typed Array.\n *\n * @returns a tuple where the first element is a number[] describing the shape\n * and the second is a number[] or a TypedArray containing the values.\n */\nfunction shapeAndValues(array: number|number[]|tf.Tensor):\n    [number[], number[]|Float32Array|Int32Array|Uint8Array] {\n  if (array instanceof tf.Tensor) {\n    return [array.shape, array.dataSync()];\n  } else if (Array.isArray(array)) {\n    return [[array.length], array];\n  } else {\n    return [[], [array]];\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport {Dataset} from '../dataset';\nimport {DataSource} from '../datasource';\nimport {LazyIterator} from '../iterators/lazy_iterator';\n\n/**\n * Represents a potentially large collection of text lines.\n *\n * The results are not batched.\n */\nexport class TextLineDataset extends Dataset<string> {\n  /**\n   * Create a `TextLineDataset`.\n   *\n   * @param input A `DataSource` providing a chunked, UTF8-encoded byte stream.\n   */\n  constructor(protected readonly input: DataSource) {\n    super();\n  }\n\n  async iterator(): Promise<LazyIterator<string>> {\n    const inputIterator = await this.input.iterator();\n    const utf8Iterator = inputIterator.decodeUTF8();\n    const lineIterator = utf8Iterator.split('\\n');\n    return lineIterator;\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport {util} from '@tensorflow/tfjs-core';\n\nimport {Dataset} from '../dataset';\nimport {DataSource} from '../datasource';\nimport {LazyIterator} from '../iterators/lazy_iterator';\nimport {ColumnConfig, CSVConfig, DataElement} from '../types';\n\nimport {TextLineDataset} from './text_line_dataset';\n\nconst CODE_QUOTE = '\"';\nconst STATE_OUT = Symbol('out');\nconst STATE_FIELD = Symbol('field');\nconst STATE_QUOTE = Symbol('quote');\nconst STATE_QUOTE_AFTER_QUOTE = Symbol('quoteafterquote');\nconst STATE_WITHIN_QUOTE_IN_QUOTE = Symbol('quoteinquote');\n\n/**\n * Represents a potentially large collection of delimited text records.\n *\n * The produced `DataElement`s each contain one key-value pair for\n * every column of the table.  When a field is empty in the incoming data, the\n * resulting value is `undefined`, or throw error if it is required.  Values\n * that can be parsed as numbers are emitted as type `number`, other values\n * are parsed as `string`.\n *\n * The results are not batched.\n */\nexport class CSVDataset extends Dataset<DataElement> {\n  base: TextLineDataset;\n  private hasHeader = true;\n  private fullColumnNames: string[] = null;\n  private columnNamesValidated = false;\n  private columnConfigs: {[key: string]: ColumnConfig} = null;\n  private configuredColumnsOnly = false;\n  private delimiter = ',';\n\n  async columnNames() {\n    if (!this.columnNamesValidated) {\n      await this.setColumnNames();\n    }\n    return this.configuredColumnsOnly ? Object.keys(this.columnConfigs) :\n                                        this.fullColumnNames;\n  }\n\n  /* 1) If `columnNames` is provided as string[], use this string[] as output\n   * keys in corresponding order. The length must match the number of inferred\n   * columns if `hasHeader` is true .\n   * 2) If `columnNames` is not provided, parse header line as `columnNames` if\n   * hasHeader is true. If `hasHeader` is false, throw an error.\n   * 3) If `columnConfigs` is provided, all the keys in `columnConfigs` must\n   * exist in parsed `columnNames`.\n   */\n  private async setColumnNames() {\n    const columnNamesFromFile = await this.maybeReadHeaderLine();\n    if (!this.fullColumnNames && !columnNamesFromFile) {\n      // Throw an error if columnNames is not provided and no header line.\n      throw new Error(\n          'Column names must be provided if there is no header line.');\n    } else if (this.fullColumnNames && columnNamesFromFile) {\n      // Check provided columnNames match header line.\n      util.assert(\n          columnNamesFromFile.length === this.fullColumnNames.length,\n          'The length of provided columnNames (' +\n              this.fullColumnNames.length.toString() +\n              ') does not match the length of the header line read from ' +\n              'file (' + columnNamesFromFile.length.toString() + ').');\n    }\n    if (!this.fullColumnNames) {\n      this.fullColumnNames = columnNamesFromFile;\n    }\n    // Check if there are duplicate column names.\n    const counts: {[key: string]: number} = this.fullColumnNames.reduce(\n        (countAcc: {[key: string]: number}, name) => {\n          countAcc[name] = (countAcc[name] + 1) || 1;\n          return countAcc;\n        },\n        {});\n    const duplicateNames =\n        Object.keys(counts).filter((name) => (counts[name] > 1));\n    util.assert(\n        duplicateNames.length === 0,\n        'Duplicate column names found: ' + duplicateNames.toString());\n    // Check if keys in columnConfigs match columnNames.\n    if (this.columnConfigs) {\n      for (const key of Object.keys(this.columnConfigs)) {\n        const index = this.fullColumnNames.indexOf(key);\n        if (index === -1) {\n          throw new Error(\n              'The key \"' + key +\n              '\" provided in columnConfigs does not match any of the column ' +\n              'names (' + this.fullColumnNames.toString() + ').');\n        }\n      }\n    }\n    this.columnNamesValidated = true;\n  }\n\n  private async maybeReadHeaderLine() {\n    if (this.hasHeader) {\n      const iter = await this.base.iterator();\n      const firstElement = await iter.next();\n      if (firstElement.done) {\n        throw new Error('No data was found for CSV parsing.');\n      }\n      const firstLine: string = firstElement.value;\n      return firstLine.split(this.delimiter);\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Create a `CSVDataset`.\n   *\n   * @param input A `DataSource` providing a chunked, UTF8-encoded byte stream.\n   * @param csvConfig (Optional) A CSVConfig object that contains configurations\n   *     of reading and decoding from CSV file(s).\n   *\n   *     hasHeader: (Optional) A boolean value that indicates whether the first\n   *     row of provided CSV file is a header line with column names, and should\n   *     not be included in the data. Defaults to `true`.\n   *\n   *     columnNames: (Optional) A list of strings that corresponds to\n   *     the CSV column names, in order. If provided, it ignores the column\n   *     names inferred from the header row. If not provided, infers the column\n   *     names from the first row of the records. If hasHeader is false and\n   *     columnNames is not provided, this method throws an error.\n   *\n   *     columnConfigs: (Optional) A dictionary whose key is column names, value\n   *     is an object stating if this column is required, column's data type,\n   *     default value, and if this column is label. If provided, keys must\n   *     correspond to names provided in columnNames or inferred from the file\n   *     header lines. If isLabel is true any column, returns an array of two\n   *     items: the first item is a dict of features key/value pairs, the second\n   *     item is a dict of labels key/value pairs. If no feature is marked as\n   *     label, returns a dict of features only.\n   *\n   *     configuredColumnsOnly (Optional) If true, only columns provided in\n   *     columnConfigs will be parsed and provided during iteration.\n   *\n   *     delimiter (Optional) The string used to parse each line of the input\n   *     file. Defaults to `,`.\n   */\n  constructor(protected readonly input: DataSource, csvConfig?: CSVConfig) {\n    super();\n    this.base = new TextLineDataset(input);\n    if (!csvConfig) {\n      csvConfig = {};\n    }\n    this.hasHeader = csvConfig.hasHeader === false ? false : true;\n    this.fullColumnNames = csvConfig.columnNames;\n    this.columnConfigs = csvConfig.columnConfigs;\n    this.configuredColumnsOnly = csvConfig.configuredColumnsOnly;\n    this.delimiter = csvConfig.delimiter ? csvConfig.delimiter : ',';\n  }\n\n  async iterator(): Promise<LazyIterator<DataElement>> {\n    if (!this.columnNamesValidated) {\n      await this.setColumnNames();\n    }\n    let lines = await this.base.iterator();\n    if (this.hasHeader) {\n      // We previously read the first line to get the columnNames.\n      // Now that we're providing data, skip it.\n      lines = lines.skip(1);\n    }\n    return lines.map(x => this.makeDataElement(x));\n  }\n\n  makeDataElement(line: string): DataElement {\n    const values = this.parseRow(line);\n    const features: {[key: string]: DataElement} = {};\n    const labels: {[key: string]: DataElement} = {};\n\n    for (let i = 0; i < this.fullColumnNames.length; i++) {\n      const key = this.fullColumnNames[i];\n      const config = this.columnConfigs ? this.columnConfigs[key] : null;\n      if (this.configuredColumnsOnly && !config) {\n        // This column is not selected.\n        continue;\n      } else {\n        const value = values[i];\n        let parsedValue = null;\n        if (value === '') {\n          // If default value is provided, use it. If default value is not\n          // provided, set as undefined.\n          if (config && config.default !== undefined) {\n            parsedValue = config.default;\n          } else if (config && (config.required || config.isLabel)) {\n            throw new Error(\n                `Required column ${key} is empty in this line: ${line}`);\n          } else {\n            parsedValue = undefined;\n          }\n        } else {\n          // A value is present, so parse it based on type\n          const valueAsNum = Number(value);\n          if (isNaN(valueAsNum)) {\n            // The value is a string and this column is declared as boolean\n            // in config, parse it as boolean.\n            if (config && config.dtype === 'bool') {\n              parsedValue = this.getBoolean(value);\n            } else {\n              // Set value as string\n              parsedValue = value as string;\n            }\n          } else if (!config || !config.dtype) {\n            // If this value is a number and no type config is provided, return\n            // it as number.\n            parsedValue = valueAsNum;\n          } else {\n            // If this value is a number and data type is provided, parse it\n            // according to provided data type.\n            switch (config.dtype) {\n              case 'float32':\n                parsedValue = valueAsNum;\n                break;\n              case 'int32':\n                parsedValue = Math.floor(valueAsNum);\n                break;\n              case 'bool':\n                parsedValue = this.getBoolean(value);\n                break;\n              default:\n                parsedValue = valueAsNum;\n            }\n          }\n        }\n        // Check if this column is label.\n        (config && config.isLabel) ? labels[key] = parsedValue :\n                                     features[key] = parsedValue;\n      }\n    }\n    // If label exists, return an array of features and labels, otherwise\n    // return features only.\n    if (Object.keys(labels).length === 0) {\n      return features;\n\n    } else {\n      return [features, labels];\n    }\n  }\n\n  private getBoolean(value: string): number {\n    if (value === '1' || value.toLowerCase() === 'true') {\n      return 1;\n    } else {\n      return 0;\n    }\n  }\n\n  // adapted from https://beta.observablehq.com/@mbostock/streaming-csv\n  private parseRow(line: string): string[] {\n    const result: string[] = [];\n    let readOffset = 0;\n    const readLength = line.length;\n    let currentState = STATE_FIELD;\n    // Goes through the line to parse quote.\n    for (let i = 0; i < readLength; i++) {\n      switch (currentState) {\n        // Before enter a new field\n        case STATE_OUT:\n          switch (line.charAt(i)) {\n            // Enter a quoted field\n            case CODE_QUOTE:\n              readOffset = i + 1;\n              currentState = STATE_QUOTE;\n              break;\n            // Read an empty field\n            case this.delimiter:\n              result.push('');\n              currentState = STATE_OUT;\n              readOffset = i + 1;\n              break;\n            // Enter an unquoted field\n            default:\n              currentState = STATE_FIELD;\n              readOffset = i;\n              break;\n          }\n          break;\n        // In an unquoted field\n        case STATE_FIELD:\n          switch (line.charAt(i)) {\n            // Exit an unquoted field, add it to result\n            case this.delimiter:\n              result.push(line.substring(readOffset, i));\n              currentState = STATE_OUT;\n              readOffset = i + 1;\n              break;\n            default:\n          }\n          break;\n        // In a quoted field\n        case STATE_QUOTE:\n          switch (line.charAt(i)) {\n            // Read a quote after a quote\n            case CODE_QUOTE:\n              currentState = STATE_QUOTE_AFTER_QUOTE;\n              break;\n            default:\n          }\n          break;\n        // This state means it's right after a second quote in a field\n        case STATE_QUOTE_AFTER_QUOTE:\n          switch (line.charAt(i)) {\n            // Finished a quoted field\n            case this.delimiter:\n              result.push(line.substring(readOffset, i - 1));\n              currentState = STATE_OUT;\n              readOffset = i + 1;\n              break;\n            // Finished a quoted part in a quoted field\n            case CODE_QUOTE:\n              currentState = STATE_QUOTE;\n              break;\n            // In a quoted part in a quoted field\n            default:\n              currentState = STATE_WITHIN_QUOTE_IN_QUOTE;\n              break;\n          }\n          break;\n        case STATE_WITHIN_QUOTE_IN_QUOTE:\n          switch (line.charAt(i)) {\n            // Exit a quoted part in a quoted field\n            case CODE_QUOTE:\n              currentState = STATE_QUOTE;\n              break;\n            default:\n          }\n          break;\n        default:\n      }\n    }\n    // Adds last item based on if it is quoted.\n    if (currentState === STATE_QUOTE_AFTER_QUOTE) {\n      result.push(line.substring(readOffset, readLength - 1));\n    } else {\n      result.push(line.substring(readOffset));\n    }\n    return result;\n  }\n}\n\n// TODO(soergel): add more basic datasets for parity with tf.data\n// tf.data.FixedLengthRecordDataset()\n// tf.data.TFRecordDataset()\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport {ByteChunkIterator} from './iterators/byte_chunk_iterator';\n\n/**\n * Represents a data source readable as a stream of binary data chunks.\n *\n * Because `Dataset`s can be read repeatedly (via `Dataset.iterator()`), this\n * provides a means to repeatedly create streams from the underlying data\n * sources.\n */\nexport abstract class DataSource {\n  /**\n   * Obtain a new stream of binary data chunks.\n   *\n   * Starts the new stream from the beginning of the data source, even if other\n   * streams have been obtained previously.\n   */\n  abstract async iterator(): Promise<ByteChunkIterator>;\n\n  // TODO(soergel): consider chainable Dataset construction here\n}\n\n// TODO(soergel): consider convenience factory functions here\n// in combination with chainable source->dataset above, e.g.:\n// tf.data.url(...).asCsvDataset().shuffle().batch()\n","/*! https://mths.be/utf8js v2.1.2 by @mathias */\n;(function(root) {\n\n\t// Detect free variables `exports`\n\tvar freeExports = typeof exports == 'object' && exports;\n\n\t// Detect free variable `module`\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\n\t// Detect free variable `global`, from Node.js or Browserified code,\n\t// and use it as `root`\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar stringFromCharCode = String.fromCharCode;\n\n\t// Taken from https://mths.be/punycode\n\tfunction ucs2decode(string) {\n\t\tvar output = [];\n\t\tvar counter = 0;\n\t\tvar length = string.length;\n\t\tvar value;\n\t\tvar extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t// Taken from https://mths.be/punycode\n\tfunction ucs2encode(array) {\n\t\tvar length = array.length;\n\t\tvar index = -1;\n\t\tvar value;\n\t\tvar output = '';\n\t\twhile (++index < length) {\n\t\t\tvalue = array[index];\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t}\n\t\treturn output;\n\t}\n\n\tfunction checkScalarValue(codePoint) {\n\t\tif (codePoint >= 0xD800 && codePoint <= 0xDFFF) {\n\t\t\tthrow Error(\n\t\t\t\t'Lone surrogate U+' + codePoint.toString(16).toUpperCase() +\n\t\t\t\t' is not a scalar value'\n\t\t\t);\n\t\t}\n\t}\n\t/*--------------------------------------------------------------------------*/\n\n\tfunction createByte(codePoint, shift) {\n\t\treturn stringFromCharCode(((codePoint >> shift) & 0x3F) | 0x80);\n\t}\n\n\tfunction encodeCodePoint(codePoint) {\n\t\tif ((codePoint & 0xFFFFFF80) == 0) { // 1-byte sequence\n\t\t\treturn stringFromCharCode(codePoint);\n\t\t}\n\t\tvar symbol = '';\n\t\tif ((codePoint & 0xFFFFF800) == 0) { // 2-byte sequence\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 6) & 0x1F) | 0xC0);\n\t\t}\n\t\telse if ((codePoint & 0xFFFF0000) == 0) { // 3-byte sequence\n\t\t\tcheckScalarValue(codePoint);\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 12) & 0x0F) | 0xE0);\n\t\t\tsymbol += createByte(codePoint, 6);\n\t\t}\n\t\telse if ((codePoint & 0xFFE00000) == 0) { // 4-byte sequence\n\t\t\tsymbol = stringFromCharCode(((codePoint >> 18) & 0x07) | 0xF0);\n\t\t\tsymbol += createByte(codePoint, 12);\n\t\t\tsymbol += createByte(codePoint, 6);\n\t\t}\n\t\tsymbol += stringFromCharCode((codePoint & 0x3F) | 0x80);\n\t\treturn symbol;\n\t}\n\n\tfunction utf8encode(string) {\n\t\tvar codePoints = ucs2decode(string);\n\t\tvar length = codePoints.length;\n\t\tvar index = -1;\n\t\tvar codePoint;\n\t\tvar byteString = '';\n\t\twhile (++index < length) {\n\t\t\tcodePoint = codePoints[index];\n\t\t\tbyteString += encodeCodePoint(codePoint);\n\t\t}\n\t\treturn byteString;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tfunction readContinuationByte() {\n\t\tif (byteIndex >= byteCount) {\n\t\t\tthrow Error('Invalid byte index');\n\t\t}\n\n\t\tvar continuationByte = byteArray[byteIndex] & 0xFF;\n\t\tbyteIndex++;\n\n\t\tif ((continuationByte & 0xC0) == 0x80) {\n\t\t\treturn continuationByte & 0x3F;\n\t\t}\n\n\t\t// If we end up here, it’s not a continuation byte\n\t\tthrow Error('Invalid continuation byte');\n\t}\n\n\tfunction decodeSymbol() {\n\t\tvar byte1;\n\t\tvar byte2;\n\t\tvar byte3;\n\t\tvar byte4;\n\t\tvar codePoint;\n\n\t\tif (byteIndex > byteCount) {\n\t\t\tthrow Error('Invalid byte index');\n\t\t}\n\n\t\tif (byteIndex == byteCount) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Read first byte\n\t\tbyte1 = byteArray[byteIndex] & 0xFF;\n\t\tbyteIndex++;\n\n\t\t// 1-byte sequence (no continuation bytes)\n\t\tif ((byte1 & 0x80) == 0) {\n\t\t\treturn byte1;\n\t\t}\n\n\t\t// 2-byte sequence\n\t\tif ((byte1 & 0xE0) == 0xC0) {\n\t\t\tbyte2 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x1F) << 6) | byte2;\n\t\t\tif (codePoint >= 0x80) {\n\t\t\t\treturn codePoint;\n\t\t\t} else {\n\t\t\t\tthrow Error('Invalid continuation byte');\n\t\t\t}\n\t\t}\n\n\t\t// 3-byte sequence (may include unpaired surrogates)\n\t\tif ((byte1 & 0xF0) == 0xE0) {\n\t\t\tbyte2 = readContinuationByte();\n\t\t\tbyte3 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x0F) << 12) | (byte2 << 6) | byte3;\n\t\t\tif (codePoint >= 0x0800) {\n\t\t\t\tcheckScalarValue(codePoint);\n\t\t\t\treturn codePoint;\n\t\t\t} else {\n\t\t\t\tthrow Error('Invalid continuation byte');\n\t\t\t}\n\t\t}\n\n\t\t// 4-byte sequence\n\t\tif ((byte1 & 0xF8) == 0xF0) {\n\t\t\tbyte2 = readContinuationByte();\n\t\t\tbyte3 = readContinuationByte();\n\t\t\tbyte4 = readContinuationByte();\n\t\t\tcodePoint = ((byte1 & 0x07) << 0x12) | (byte2 << 0x0C) |\n\t\t\t\t(byte3 << 0x06) | byte4;\n\t\t\tif (codePoint >= 0x010000 && codePoint <= 0x10FFFF) {\n\t\t\t\treturn codePoint;\n\t\t\t}\n\t\t}\n\n\t\tthrow Error('Invalid UTF-8 detected');\n\t}\n\n\tvar byteArray;\n\tvar byteCount;\n\tvar byteIndex;\n\tfunction utf8decode(byteString) {\n\t\tbyteArray = ucs2decode(byteString);\n\t\tbyteCount = byteArray.length;\n\t\tbyteIndex = 0;\n\t\tvar codePoints = [];\n\t\tvar tmp;\n\t\twhile ((tmp = decodeSymbol()) !== false) {\n\t\t\tcodePoints.push(tmp);\n\t\t}\n\t\treturn ucs2encode(codePoints);\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar utf8 = {\n\t\t'version': '2.1.2',\n\t\t'encode': utf8encode,\n\t\t'decode': utf8decode\n\t};\n\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine(function() {\n\t\t\treturn utf8;\n\t\t});\n\t}\telse if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = utf8;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tvar object = {};\n\t\t\tvar hasOwnProperty = object.hasOwnProperty;\n\t\t\tfor (var key in utf8) {\n\t\t\t\thasOwnProperty.call(utf8, key) && (freeExports[key] = utf8[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.utf8 = utf8;\n\t}\n\n}(this));\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport {LazyIterator, OneToManyIterator} from './lazy_iterator';\n\nexport abstract class StringIterator extends LazyIterator<string> {\n  /**\n   * Splits a string stream on a given separator.\n   *\n   * It is assumed that the incoming chunk boundaries have no semantic meaning,\n   * so conceptually the incoming stream is treated simply as the concatenation\n   * of its elements.\n   *\n   * The outgoing stream provides chunks corresponding to the results of the\n   * standard string split() operation (even if such a chunk spanned incoming\n   * chunks).  The separators are not included.\n   *\n   * A typical usage is to split a text file (represented as a stream with\n   * arbitrary chunk boundaries) into lines.\n   *\n   * @param upstream A readable stream of strings that can be treated as\n   *   concatenated.\n   * @param separator A character to split on.\n   */\n  split(separator: string): StringIterator {\n    return new SplitIterator(this, separator);\n  }\n}\n\n// ============================================================================\n// The following private classes serve to implement the chainable methods\n// on StringIterator.  Unfortunately they can't be placed in separate files, due\n// to resulting trouble with circular imports.\n// ============================================================================\n\n// We wanted multiple inheritance, e.g.\n//   class SplitIterator extends QueueIterator<string>, StringIterator\n// but the TypeScript mixin approach is a bit hacky, so we take this adapter\n// approach instead.\n\nclass SplitIterator extends StringIterator {\n  private impl: SplitIteratorImpl;\n\n  constructor(protected upstream: LazyIterator<string>, separator: string) {\n    super();\n    this.impl = new SplitIteratorImpl(upstream, separator);\n  }\n\n  summary() {\n    return this.impl.summary();\n  }\n\n  async next() {\n    return this.impl.next();\n  }\n}\n\nclass SplitIteratorImpl extends OneToManyIterator<string> {\n  // A partial string at the end of an upstream chunk\n  carryover = '';\n\n  constructor(\n      protected upstream: LazyIterator<string>, protected separator: string) {\n    super();\n  }\n\n  summary() {\n    return `${this.upstream.summary()} -> Split('${this.separator}')`;\n  }\n\n  async pump(): Promise<boolean> {\n    const chunkResult = await this.upstream.next();\n    if (chunkResult.done) {\n      if (this.carryover === '') {\n        return false;\n      }\n\n      // Pretend that the pump succeeded in order to emit the small last batch.\n      // The next pump() call will actually fail.\n      this.outputQueue.push(this.carryover);\n      this.carryover = '';\n      return true;\n    }\n    const lines = chunkResult.value.split(this.separator);\n    // Note the behavior: \" ab \".split(' ') === ['', 'ab', '']\n    // Thus the carryover may be '' if the separator falls on a chunk\n    // boundary; this produces the correct result.\n\n    lines[0] = this.carryover + lines[0];\n    for (const line of lines.slice(0, -1)) {\n      this.outputQueue.push(line);\n    }\n    this.carryover = lines[lines.length - 1];\n\n    return true;\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport * as utf8 from 'utf8';\n\nimport {LazyIterator, OneToManyIterator} from './lazy_iterator';\nimport {StringIterator} from './string_iterator';\n\nexport abstract class ByteChunkIterator extends LazyIterator<Uint8Array> {\n  /**\n   * Decode a stream of UTF8-encoded byte arrays to a stream of strings.\n   *\n   * The byte arrays producetd from the ByteChunkIterator on which this is\n   * called will be interpreted as concatenated.  No assumptions are made about\n   * the boundaries of the incoming chunks, so a multi-byte UTF8 encoding of a\n   * character may span the boundary between chunks.  This naturally happens,\n   * for instance, when reading fixed-size byte arrays from a file.\n   */\n  decodeUTF8(): StringIterator {\n    return new Utf8Iterator(this);\n  }\n}\n\n// ============================================================================\n// The following private classes serve to implement the chainable methods\n// on ByteChunkIterator.  Unfortunately they can't be placed in separate files,\n// due to resulting trouble with circular imports.\n// ============================================================================\n\n// We wanted multiple inheritance, e.g.\n//   class Utf8Iterator extends QueueIterator<string>, StringIterator\n// but the TypeScript mixin approach is a bit hacky, so we take this adapter\n// approach instead.\n\nclass Utf8Iterator extends StringIterator {\n  private impl: Utf8IteratorImpl;\n\n  constructor(protected upstream: LazyIterator<Uint8Array>) {\n    super();\n    this.impl = new Utf8IteratorImpl(upstream);\n  }\n\n  summary() {\n    return this.impl.summary();\n  }\n\n  async next() {\n    return this.impl.next();\n  }\n}\n\n/**\n * Decode a stream of UTF8-encoded byte arrays to a stream of strings.\n *\n * This is tricky because the incoming byte array boundaries may disrupt a\n * multi-byte UTF8 character. Thus any incomplete character data at the end of\n * a chunk must be carried over and prepended to the next chunk before\n * decoding.\n *\n * In the context of an input pipeline for machine learning, UTF8 decoding is\n * needed to parse text files containing training examples or prediction\n * requests (e.g., formatted as CSV or JSON).  We cannot use the built-in\n * decoding provided by FileReader.readAsText() because here we are in a\n * streaming context, which FileReader does not support.\n *\n * @param upstream A `LazyIterator` of `Uint8Arrays` containing UTF8-encoded\n *   text, which should be interpreted as concatenated.  No assumptions are\n *   made about the boundaries of the incoming chunks, so a multi-byte UTF8\n *   encoding of a character may span the boundary between chunks.  This\n *   naturally happens, for instance, when reading fixed-size byte arrays from a\n *   file.\n */\nclass Utf8IteratorImpl extends OneToManyIterator<string> {\n  // An array of the full required width of the split character, if any.\n  partial: Uint8Array = new Uint8Array([]);\n  // The number of bytes of that array that are populated so far.\n  partialBytesValid = 0;\n\n  constructor(protected readonly upstream: LazyIterator<Uint8Array>) {\n    super();\n  }\n  summary() {\n    return `${this.upstream.summary()} -> Utf8`;\n  }\n\n  async pump(): Promise<boolean> {\n    const chunkResult = await this.upstream.next();\n    let chunk;\n    if (chunkResult.done) {\n      if (this.partial.length === 0) {\n        return false;\n      }\n      // Pretend that the pump succeeded in order to emit the small last batch.\n      // The next pump() call will actually fail.\n      chunk = new Uint8Array([]);\n    } else {\n      chunk = chunkResult.value;\n    }\n    const partialBytesRemaining = this.partial.length - this.partialBytesValid;\n    let nextIndex = partialBytesRemaining;\n    let okUpToIndex = nextIndex;\n    let splitUtfWidth = 0;\n\n    while (nextIndex < chunk.length) {\n      okUpToIndex = nextIndex;\n      splitUtfWidth = utfWidth(chunk[nextIndex]);\n      nextIndex = okUpToIndex + splitUtfWidth;\n    }\n    if (nextIndex === chunk.length) {\n      okUpToIndex = nextIndex;\n    }\n\n    // decode most of the chunk without copying it first\n    const bulk: string = utf8.decode(String.fromCharCode.apply(\n        null, chunk.slice(partialBytesRemaining, okUpToIndex)));\n\n    if (partialBytesRemaining > 0) {\n      // Reassemble the split character\n      this.partial.set(\n          chunk.slice(0, partialBytesRemaining), this.partialBytesValid);\n      // Too bad about the string concat.\n      const reassembled: string =\n          utf8.decode(String.fromCharCode.apply(null, this.partial));\n      this.outputQueue.push(reassembled + bulk);\n    } else {\n      this.outputQueue.push(bulk);\n    }\n\n    if (okUpToIndex === chunk.length) {\n      this.partial = new Uint8Array([]);\n      this.partialBytesValid = 0;\n    } else {\n      // prepare the next split character\n      this.partial = new Uint8Array(new ArrayBuffer(splitUtfWidth));\n      this.partial.set(chunk.slice(okUpToIndex), 0);\n      this.partialBytesValid = chunk.length - okUpToIndex;\n    }\n\n    return true;\n  }\n}\n\nfunction utfWidth(firstByte: number): number {\n  if (firstByte >= 252) {\n    return 6;\n  } else if (firstByte >= 248) {\n    return 5;\n  } else if (firstByte >= 240) {\n    return 4;\n  } else if (firstByte >= 224) {\n    return 3;\n  } else if (firstByte >= 192) {\n    return 2;\n  } else {\n    return 1;\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\n// inspired by https://github.com/maxogden/filereader-stream\nimport {ENV, util} from '@tensorflow/tfjs-core';\n\nimport {FileElement} from '../types';\n\nimport {ByteChunkIterator} from './byte_chunk_iterator';\n\nexport interface FileChunkIteratorOptions {\n  /** The byte offset at which to begin reading the File or Blob. Default 0. */\n  offset?: number;\n  /** The number of bytes to read at a time. Default 1MB. */\n  chunkSize?: number;\n}\n\n/**\n * Provide a stream of chunks from a File, Blob, or Uint8Array.\n * @param file The source File, Blob or Uint8Array.\n * @param options Optional settings controlling file reading.\n * @returns a lazy Iterator of Uint8Arrays containing sequential chunks of the\n *   input File, Blob or Uint8Array.\n */\nexport class FileChunkIterator extends ByteChunkIterator {\n  offset: number;\n  chunkSize: number;\n\n  constructor(\n      protected file: FileElement,\n      protected options: FileChunkIteratorOptions = {}) {\n    super();\n    util.assert(\n        (file instanceof Uint8Array) ||\n            (ENV.get('IS_BROWSER') ?\n                 (file instanceof File || file instanceof Blob) :\n                 false),\n        'FileChunkIterator only supports File, Blob and Uint8Array right now.');\n    this.offset = options.offset || 0;\n    // default 1MB chunk has tolerable perf on large files\n    this.chunkSize = options.chunkSize || 1024 * 1024;\n  }\n\n  summary() {\n    return `FileChunks ${this.file}`;\n  }\n\n  async next(): Promise<IteratorResult<Uint8Array>> {\n    if (this.offset >= ((this.file instanceof Uint8Array) ?\n                            this.file.byteLength :\n                            this.file.size)) {\n      return {value: null, done: true};\n    }\n    const chunk = new Promise<Uint8Array>((resolve, reject) => {\n      const end = this.offset + this.chunkSize;\n      if (this.file instanceof Uint8Array) {\n        // Note if end > this.uint8Array.byteLength, we just get a small last\n        // chunk.\n        resolve(new Uint8Array(this.file.slice(this.offset, end)));\n      } else {\n        // This branch assumes that this.file type is File or Blob, which\n        // means it is in the browser environment.\n\n        // TODO(soergel): is this a performance issue?\n        const fileReader = new FileReader();\n        fileReader.onload = (event) => {\n          let data: string|ArrayBuffer|Uint8Array = fileReader.result;\n          // Not sure we can trust the return type of\n          // FileReader.readAsArrayBuffer See e.g.\n          // https://github.com/node-file-api/FileReader/issues/2\n          if (data instanceof ArrayBuffer) {\n            data = new Uint8Array(data);\n          }\n          if (!(data instanceof Uint8Array)) {\n            return reject(new TypeError('FileReader returned unknown type.'));\n          }\n          resolve(data);\n        };\n        fileReader.onabort = (event) => {\n          return reject(new Error('Aborted'));\n        };\n        fileReader.onerror = (event) => {\n          return reject(new Error(event.type));\n        };\n        // TODO(soergel): better handle onabort, onerror\n        // Note if end > this.file.size, we just get a small last chunk.\n        const slice = this.file.slice(this.offset, end);\n        // We can't use readAsText here (even if we know the file is text)\n        // because the slice boundary may fall within a multi-byte character.\n        fileReader.readAsArrayBuffer(slice);\n      }\n      this.offset = end;\n    });\n    return {value: (await chunk), done: false};\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport {ENV} from '@tensorflow/tfjs-core';\nimport {FileChunkIterator, FileChunkIteratorOptions} from './file_chunk_iterator';\n\n/**\n * Provide a stream of chunks from a URL.\n *\n * Note this class first downloads the entire file into memory before providing\n * the first element from the stream.  This is because the Fetch API does not\n * yet reliably provide a reader stream for the response body.\n */\nexport async function urlChunkIterator(\n    url: RequestInfo, options: FileChunkIteratorOptions = {}) {\n  let response;\n  if (ENV.get('IS_BROWSER')) {\n    response = await fetch(url);\n    if (response.ok) {\n      const blob = await response.blob();\n      return new FileChunkIterator(blob, options);\n    } else {\n      throw new Error(response.statusText);\n    }\n  } else {\n    // TODO(kangyizhang): Provide argument for users to use http.request with\n    // headers in node.\n    // tslint:disable-next-line:no-require-imports\n    const nodeFetch = require('node-fetch');\n    if (typeof url !== 'string') {\n      throw new Error(\n          'URL must be a string. Request objects are not supported ' +\n          'in the node.js environment yet.');\n    }\n    response = await nodeFetch(url);\n    if (response.ok) {\n      const unitArray = await response.buffer();\n      return new FileChunkIterator(unitArray, options);\n    } else {\n      throw new Error(response.statusText);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport {DataSource} from '../datasource';\nimport {ByteChunkIterator} from '../iterators/byte_chunk_iterator';\nimport {FileChunkIteratorOptions} from '../iterators/file_chunk_iterator';\nimport {urlChunkIterator} from '../iterators/url_chunk_iterator';\n\n/*\n * Represents a URL readable as a stream of binary data chunks.\n */\nexport class URLDataSource extends DataSource {\n  /**\n   * Create a `URLDataSource`.\n   *\n   * @param url A source URL string, or a `Request` object.\n   * @param options Options passed to the underlying `FileChunkIterator`s,\n   *   such as {chunksize: 1024}.\n   */\n  constructor(\n      protected readonly url: RequestInfo,\n      protected readonly fileOptions: FileChunkIteratorOptions = {}) {\n    super();\n  }\n\n  // TODO(soergel): provide appropriate caching options.  Currently this\n  // will download the URL anew for each call to iterator().  Since we have\n  // to treat the downloaded file as a blob/buffer anyway, we may as well retain\n  // it-- but that raises GC issues.  Also we may want a persistent disk cache.\n  async iterator(): Promise<ByteChunkIterator> {\n    return urlChunkIterator(this.url, this.fileOptions);\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport {CSVDataset} from './datasets/csv_dataset';\nimport {URLDataSource} from './sources/url_data_source';\nimport {CSVConfig} from './types';\n\n/**\n * Create a `CSVDataset` by reading and decoding CSV file(s) from provided URLs.\n *\n * ```js\n * const csvUrl =\n * 'https://storage.googleapis.com/tfjs-examples/multivariate-linear-regression/data/boston-housing-train.csv';\n *\n * async function run() {\n *   // We want to predict the column \"medv\", which represents a median value of\n *   // a home (in $1000s), so we mark it as a label.\n *   const csvDataset = tf.data.csv(\n *     csvUrl, {\n *       columnConfigs: {\n *         medv: {\n *           isLabel: true\n *         }\n *       }\n *     });\n *\n *   // Number of features is the number of column names minus one for the label\n *   // column.\n *   const numOfFeatures = (await csvDataset.columnNames()).length - 1;\n *\n *   // Prepare the Dataset for training.\n *   const flattenedDataset =\n *     csvDataset\n *     .map(([rawFeatures, rawLabel]) =>\n *       // Convert rows from object form (keyed by column name) to array form.\n *       [Object.values(rawFeatures), Object.values(rawLabel)])\n *     .batch(10);\n *\n *   // Define the model.\n *   const model = tf.sequential();\n *   model.add(tf.layers.dense({\n *     inputShape: [numOfFeatures],\n *     units: 1\n *   }));\n *   model.compile({\n *     optimizer: tf.train.sgd(0.000001),\n *     loss: 'meanSquaredError'\n *   });\n *\n *   // Fit the model using the prepared Dataset\n *   return model.fitDataset(flattenedDataset, {\n *     epochs: 10,\n *     callbacks: {\n *       onEpochEnd: async (epoch, logs) => {\n *         console.log(epoch + ':' + logs.loss);\n *       }\n *     }\n *   });\n * }\n *\n * await run();\n * ```\n *\n * @param source URL to fetch CSV file.\n * @param csvConfig (Optional) A CSVConfig object that contains configurations\n *     of reading and decoding from CSV file(s).\n */\n/** @doc {\n *   heading: 'Data',\n *   subheading: 'Creation',\n *   namespace: 'data',\n *   configParamIndices: [1]\n *  }\n */\nexport function csv(source: string, csvConfig: CSVConfig = {}): CSVDataset {\n  return new CSVDataset(new URLDataSource(source), csvConfig);\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport {DataSource} from '../datasource';\nimport {ByteChunkIterator} from '../iterators/byte_chunk_iterator';\nimport {FileChunkIterator, FileChunkIteratorOptions} from '../iterators/file_chunk_iterator';\nimport {FileElement} from '../types';\n\n/**\n * Represents a file, blob, or Uint8Array readable as a stream of binary data\n * chunks.\n */\nexport class FileDataSource extends DataSource {\n  /**\n   * Create a `FileDataSource`.\n   *\n   * @param input A `File`, `Blob` or `Uint8Array` object to read.\n   * @param options Options passed to the underlying `FileChunkIterator`s,\n   *   such as {chunksize: 1024}.\n   */\n  constructor(\n      protected readonly input: FileElement,\n      protected readonly options: FileChunkIteratorOptions = {}) {\n    super();\n  }\n\n  async iterator(): Promise<ByteChunkIterator> {\n    return new FileChunkIterator(this.input, this.options);\n  }\n}\n","/** @license See the LICENSE file. */\n// This code is auto-generated, do not modify this file!\nconst version = '0.1.4';\nexport {version};\n"],"names":["global","module","define","copy","f","t","c","s0","s1","s2","impl","seed","opts","xg","n","me","this","mash","data","toString","i","length","h","charCodeAt","next","state","prng","int32","double","quick","exports","amd","alea","x","y","z","w","strseed","k","result","xor128","v","d","xorwow","slice","Date","X","j","push","init","xorshift7","limit","Math","max","xor4096","a","b","floor","tychei","pool","math","nodecrypto","eval","width","chunks","rngname","startdenom","pow","significance","overflow","mask","seedrandom","options","callback","key","shortseed","mixkey","flatten","obj","depth","prop","typ","e","entropy","tostring","out","randomBytes","Uint8Array","crypto","msCrypto","getRandomValues","browser","navigator","plugins","screen","autoseed","arc4","keylen","s","S","g","count","r","pass","is_math_call","smear","stringseed","String","fromCharCode","apply","random","require","ex","sr","shuffle","array","counter","temp","index","assert","expr","msg","Error","arr","ret","Array","isArray","isTypedArray","arraysEqual","n1","n2","checkConversionForNaN","vals","dtype","isNaN","Float32Array","Int32Array","isString","value","isBoolean","isNumber","makeZerosTypedArray","size","Object","defineProperty","min","val","sum","diff","Number","shapeA","shapeB","errorMessagePrefix","shape","tanh","Infinity","e2x","exp","sqrt","shuffledIndices","Uint32Array","repeat","checkFn","delayFn","maxCounter","Promise","resolve","reject","tryCount","tryFn","nextBackoff","setTimeout","shapeProd","implicitIdx","newShape","axis","keptDims","values","name","oldType","newType","bytes","forEach","inferDtype","constructor","call","start","rank","strides","debugMode","noConversionNeeded","bool","round","performance","now","process","time","hrtime","FORMAT_LIMIT_NUM_VALS","FORMAT_NUM_FIRST_LAST_VALS","FORMAT_NUM_SIG_DIGITS","valToString","pad","valStr","parseFloat","toFixed","util_1","rightPad","createComplexTuples","complexTuples","verbose","computeStrides","padPerCol","sizeFromShape","numCols","fill","valuesOrTuples","row","offset","computeMaxSizePerColumn","valsLines","subTensorToString","isLast","storagePerElement","complexTuple","firstValsSize","firstVals","from","lastVals","map","join","displayVals","subshape","substrides","stride","lines","end","sep","newLineSep","l","extendStatics","__extends","setPrototypeOf","__proto__","p","hasOwnProperty","__","prototype","create","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","rejected","done","then","__generator","body","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","op","TypeError","pop","util","TensorBuffer","getArrayFromDType","set","locs","_i","arguments","locToIndex","get","indexToLoc","enumerable","configurable","toTensor","Tensor","make","trackerFn","opHandler","fn","handler","dataId","isDisposedInternal","id","nextTensorId","rankType","registerTensor","write","throwIfDisposed","as1D","asScalar","reshape","as2D","rows","columns","as3D","as4D","depth2","as5D","depth3","asType","cast","dataSync","buffer","_a","read","readSync","dispose","isDisposed","disposeTensor","toFloat","toInt","toBool","print","reshapeAs","expandDims","cumsum","exclusive","reverse","squeeze","clone","tensor_format_1","tensorToString","tile","reps","gather","indices","matMul","transposeA","transposeB","dot","norm","ord","keepDims","begin","concat","split","numOrSizeSplits","stack","unstack","paddings","constantValue","batchNormalization","mean","variance","varianceEpsilon","scale","all","any","logSumExp","prod","argMin","argMax","add","addStrict","atan2","sub","subStrict","powStrict","mul","mulStrict","div","floorDiv","divStrict","minimum","minimumStrict","maximum","maximumStrict","mod","modStrict","squaredDifference","squaredDifferenceStrict","transpose","perm","notEqual","notEqualStrict","less","lessStrict","equal","equalStrict","lessEqual","lessEqualStrict","greater","greaterStrict","greaterEqual","greaterEqualStrict","logicalAnd","logicalOr","logicalNot","logicalXor","where","condition","neg","ceil","sign","expm1","log","log1p","rsqrt","square","reciprocal","abs","clipByValue","relu","elu","selu","leakyRelu","alpha","prelu","sigmoid","logSigmoid","softplus","zerosLike","onesLike","sin","cos","tan","asin","acos","atan","sinh","cosh","asinh","acosh","atanh","erf","softmax","dim","logSoftmax","resizeBilinear","newShape2D","alignCorners","image","resizeNearestNeighbor","conv1d","filter","dataFormat","dilation","dimRoundingMode","conv2d","dilations","conv2dTranspose","outputShape","depthwiseConv2D","depthwiseConv2d","separableConv2d","depthwiseFilter","pointwiseFilter","avgPool","filterSize","maxPool","localResponseNormalization","radius","bias","beta","windowShape","poolingType","padding","dilationRate","variable","trainable","Variable","unsortedSegmentSum","segmentIds","numSegments","batchToSpaceND","blockShape","crops","spaceToBatchND","topk","sorted","stridedSlice","beginMask","endMask","depthToSpace","blockSize","fft","spectral","ifft","hasInstance","instance","_super","initialValue","_this","nextVariableId","registerVariable","assign","newValue","Function","UpcastInt32AndMap","UpcastBoolAndMap","UpcastFloat32AndMap","UpcastComplex64AndMap","Rank","upcastTypeMap","float32","complex64","upcastType","typeA","typeB","type","types_1","tensor","tensorList","nameArrayMap","keys","xs","tensor_1","xMap","flatArrays","list","walkTensorContainer","container","seen","iterable","has","Set","input","mapFn","containedIn","Map","recurse","isIterable","mappedIterable","childResult","deepMapInternal","delete","inputs","zipFn","deepZipInternal","mappedValue","_b","tf.Tensor","capacity","RangeError","doubledCapacity","RingBuffer","isFull","wrap","values_1","isEmpty","undefined","relativeIndex","GrowingRingBuffer","INITIAL_CAPACITY","tslib_1.__extends","expand","unshift","newCapacity","newData","len","items","ArrayIterator","func","FunctionCallIterator","baseIterators","baseErrorHandler","ChainedIterator","iterators","mismatchMode","ZipMismatchMode","FAIL","ZipIterator","LazyIterator","maxItems","prefetch","stream","predicate","shouldContinue","ErrorHandlingLazyIterator","FilterIterator","transform","MapIterator","AsyncMapIterator","serial","FlatmapIterator","resolveFully","serialMapAsync","resolveWhile","batchSize","smallLastBatch","RowMajorBatchIterator","rowMajorBatch","deepZip","iteratorFromItems","TakeIterator","SkipIterator","bufferSize","PrefetchIterator","windowSize","ShuffleIterator","SerialIterator","trav","nextFn","message","upstream","lastRead","summary","serialNext","maxCount","skipped","tf.dispose","enableSmallLastBatch","batch","item","inputTensors","getTensorsInContainer","mapped","outputTensors","inputTensors_1","isTensorInList","e_1","inputTensors_2","outputQueue","OneToManyIterator","pump","shift","mappedArray","pushAll","inputTensors_3","moreIterators","upstreamSummaries","readFromChain","iteratorResult","handleErrors","itemResult","afterState","numIterators","iteratorsDone","deepMapAndAwaitAll","getNext","SHORTEST","LONGEST","currentPromise","nextState","refill","seedrandom.alea","tf.util","randomInt","upstreamExhausted","chosenIndex","chooseIndex","shuffleExcise","Dataset","base","datasetFromIteratorFn","tf.tidy","mapAsync","columnMajorBatch","deepBatchConcat","dataset","_c","concatenate","iteratorFromConcatenated","iteratorFromFunction","take","skip","reshuffleEachIteration","seed2","collect","iteratorFn","class_1","datasets","iteratorFromZipped","exampleRow","isNumericArray","batchConcat","arrays","elementShape","batchShape","resultVals","reduce","arrays_1","aShape","aVals","TextLineDataset","inputIterator","utf8Iterator","decodeUTF8","CODE_QUOTE","STATE_OUT","STATE_FIELD","STATE_QUOTE","STATE_QUOTE_AFTER_QUOTE","STATE_WITHIN_QUOTE_IN_QUOTE","csvConfig","hasHeader","fullColumnNames","columnNames","columnConfigs","configuredColumnsOnly","delimiter","CSVDataset","columnNamesValidated","setColumnNames","maybeReadHeaderLine","columnNamesFromFile","counts","countAcc","duplicateNames","indexOf","firstElement","makeDataElement","line","parseRow","features","labels","config","parsedValue","default","required","isLabel","valueAsNum","getBoolean","toLowerCase","readOffset","readLength","currentState","charAt","substring","root","freeExports","freeModule","freeGlobal","window","byteArray","byteCount","byteIndex","stringFromCharCode","ucs2decode","string","extra","output","checkScalarValue","codePoint","toUpperCase","createByte","encodeCodePoint","symbol","readContinuationByte","continuationByte","decodeSymbol","byte1","utf8","version","encode","codePoints","byteString","decode","tmp","ucs2encode","nodeType","StringIterator","separator","SplitIterator","SplitIteratorImpl","chunkResult","carryover","ByteChunkIterator","Utf8Iterator","Utf8IteratorImpl","partial","chunk","partialBytesRemaining","partialBytesValid","okUpToIndex","nextIndex","splitUtfWidth","utfWidth","bulk","utf8.decode","reassembled","ArrayBuffer","firstByte","file","ENV","File","Blob","chunkSize","FileChunkIterator","byteLength","fileReader_1","FileReader","onload","event","onabort","onerror","readAsArrayBuffer","url","fetch","response","ok","blob","statusText","nodeFetch","unitArray","fileOptions","URLDataSource","urlChunkIterator","DataSource","source","FileDataSource"],"mappings":"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"}